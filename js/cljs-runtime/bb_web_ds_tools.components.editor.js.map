{"version":3,"sources":["bb_web_ds_tools/components/editor.cljs"],"mappings":";;;;;;AAUA,GAAA,QAAAA,4CAAAC,uDAAAC,8DAAAC;AAAA;AAAA,AAAA,AAASC,sDACP,iBAAA,AACE,8EAAA,9EAACE,wFAEA,qBAAA,2CAAA,oDAAA,UAAA,4DAAA,KAAA,uDAAA,mFAAA,2CAAA,yJAAA,iLAAA,yDAAA,2CAAA,uKAAA,gLAAA,yLAAA,kMAAA,2LAAA,/qDAACC,qbAE8B,4BAAA,5BAACC,wJACD,4BAAA,5BAACA,oSACM,4BAAA,5BAACA,uKACD,4BAAA,5BAACA,4LACK,4BAAA,5BAACA,uMACM,4BAAA,5BAACA,0LACL,4BAAA,5BAACA,0MACO,4BAAA,5BAACA;;AAZ3D;gBAAA,GAAA,CAAAH,kBAcSI;AAdT,QAAAJ,JAckBK;AAdlB,AAeI,aAAA,bAACC,8CAAiDD;;AAftD;;AAAA,AAAA,MAAAL;;;;;AAkBF;;;;;;;;;;;;;;kDAAA,lDAAMO,4GAaHC;AAbH,AAcE,IAAMC,kBAAgB,gDAAA,hDAACC;IACjBC,eAAa,gDAAA,hDAACD;IACdE,gBAAc,6CAAA,7CAACC;IACfC,uBAAe,6CAAA,7CAACD;AAHtB,AAIE,+DAAA,2CAAA,mEAAA,gBAAA,tLAACE,0QAGC,WAAKC;AAAL,AACE,IAAA,AACE,IAAAE,aAC2C,AAACW,mBAAQb;IADpDE,iBAAA,AAAAC,4BAAAD;YAAA,AAAAE,4CAAAF,eAAA,nEAAcG;WAAd,AAAAD,4CAAAF,eAAA,lEAAoBI;eAApB,AAAAF,4CAAAF,eAAA,tEAAyBK;cAAzB,AAAAH,4CAAAF,eAAA,rEAAkCM;eAAlC,AAAAJ,4CAAAF,eAAA,tEAA0CO;cAA1C,AAAAL,4CAAAF,eAAA,rEACcQ;eADd,AAAAN,4CAAAF,eAAA,tEACsBS;gBADtB,AAAAP,4CAAAF,eAAA,vEAC+BU;IACzBE,OAAK,AAACC,gDAAsBf;IAC5BgB,OAAK,iBAAAC,mBAAIV;AAAJ,AAAA,oBAAAU;AAAAA;;AACI,IAAAC,WAAMZ;AAAN,AAAA,QAAAY;KAAA;AAAA;;;KAAA;AAAA;;;;AAAA;;;;;IAITC,SAAO,AAACC,yEACAN,KACA,AAAC5B,qBACA,uGAAA,wCAAA,4DAAA,sDAAA,qFAAA,0EAAA,wDAAA,iEAAA,8DAAA,kEAAA,8DAAA,2CAAA,2DAAA,7zBAACmC,20BACQ,iBAAAJ,mBAAIZ;AAAJ,AAAA,oBAAAY;AAAAA;;AAAA;;KADT,MAAA,KAAA,UAAA,+CAAA,MAAA,XAEYD,kBAQXR;AArBhB,AAuBE,AAACc,sBAAO7B,gBAAgB0B;;AACxB,AAACG,sBAAO1B,cAAcgB;;AAEtB,oBAAMD;AAAN,AACE,CAACA,yCAAAA,iDAAAA,VAASQ,6BAAAA;;AADZ;;AAGA,IAAMI,YAAI,AACCJ,+BACA;AAAA,AACE,2CAAA,3CAACG,sBAAOxB;;AACR,IAAM0B,gBAAQ,AAAWL;AAAzB,AACE,IAAAM,2BAAA,AAAAC,gBAAoB9B;AAApB,AAAA,oBAAA6B;AAAA,AAAA,oBAAAA,hBAAWE;AAAX,AACE,GAAI,AAACC,wBAAQD;AACX,AAACE,uBAAY,AAACC,6CAAKH,cAAQH;;AAC3B,CAACG,8CAAAA,6DAAAA,jBAAQH,yCAAAA;;;AAHb;;AAIF,kDAAA,3CAACF,sBAAOxB;;AATrB,AAUE,AAACwB,sBAAO3B,aAAa4B;;AAEvB,oBAAMd;AAAN,AACE,AAAuBU,4BAAOV;;AADhC;;AAEA,oBAAMC;AAAN,AACE,OAAsBS,2BAAOT;;AAD/B;;gBA5CJ,GAAA,CAAAT,kBA8CSb;AA9CT,QAAAa,JA8CkBZ;AA9ClB,AA+CI,qBAAA,dAAC0C,8CAAiD1C;;AA/CtD,AAAA,MAAAY;;;IAJJ,sFAsDE,iBAAA+B,NAAKhC;AAAL,AAAA,IAAAiC,aAAAD;YAAA,AAAAE,4CAAAD,WAAA,IAAA,nEAAWzC;gBAAX,AAAA0C,4CAAAD,WAAA,IAAA,vEAAaE;AAAb,AACE,IAAAC,aAAsD,AAACvB,mBAAQb;IAA/DoC,iBAAA,AAAAjC,4BAAAiC;YAAA,AAAAhC,4CAAAgC,eAAA,nEAAc/B;eAAd,AAAAD,4CAAAgC,eAAA,tEAAoB7B;WAApB,AAAAH,4CAAAgC,eAAA,lEAA6B9B;cAA7B,AAAAF,4CAAAgC,eAAA,rEAAkC5B;gBAAlC,AAAAJ,4CAAAgC,eAAA,vEAA0CxB;IACpCO,SAAO,AAAAO,gBAAKjC;AADlB,AAEE,AAAC6B,sBAAO1B,cAAcgB;;AACtB,oBAAMO;AAAN,AACE,GAAM,EAAK,cAAA,AAAAO,dAACW,8BAAKvC,4BACN,AAACwC,gDAAK,AAAWnB,kBAAQd;AADpC,AAEE,AAAWc,gBAAO,iBAAAF,mBAAIZ;AAAJ,AAAA,oBAAAY;AAAAA;;AAAA;;;;AAFpB;;AAIA,IAAMD,aAAK,iBAAAC,mBAAIV;AAAJ,AAAA,oBAAAU;AAAAA;;AACI,IAAAsB,WAAMjC;AAAN,AAAA,QAAAiC;KAAA;AAAA;;;KAAA;AAAA;;;;AAAA;;;;;IAITC,cAAM,AAAWrB;IACjBsB,qBAAa,+BAAA,4BAAA,zCAAMD,aAAM,AAAgBA;AAN/C,AAOE,oBAAM,iBAAAE,oBAAKF;AAAL,AAAA,oBAAAE;AAAA,IAAAA,wBAAW1B;AAAX,AAAA,oBAAA0B;AAAgB,OAACJ,gDAAKG,mBAAazB;;AAAnC0B;;;AAAAA;;;AAAN,AACE,AAACC,mFAA+BH,YAAMxB;;AADxC;;AAGF,GAAM,AAACsB,gDAAK,AAAA,uFAAUH,WAAW3B;AAAjC,AACE,OAAgBW,qBAAO,AAACjC,qBAAQsB;;AADlC;;;AAfF;;GA1DN,0FA6EE,WAAKR;AAAL,AACE,IAAAyB,2BAAA,AAAAC,gBAAgB/B;AAAhB,AAAA,oBAAA8B;AAAA,AAAA,gBAAAA,ZAAWF;AAAX,AACE,AAAUA;;AADZ;;AAEA,IAAAE,qBAAA,AAAAC,gBAAmBjC;AAAnB,AAAA,oBAAAgC;AAAA,AAAA,aAAAA,TAAWN;AAAX,AACE,OAAUA;;AADZ;;GAhFJ,yEAoFE,WAAKyB;AAAL,AACE,IAAAC,aAA4BD;IAA5BC,iBAAA,AAAA1C,4BAAA0C;YAAA,AAAAzC,4CAAAyC,eAAA,nEAAcC;aAAd,AAAA1C,4CAAAyC,eAAA,pEAAoBE;AAApB,AAAA,0FAAA,iFAAA,2CAAA,+DAAA,PAEWA,8DACA,uGAAA,2CAAA,uDAAA,OAAA,yDAAA,zQAAC1B,wRAAqCyB;;;AAIzD;;;;;;;;;qDAAA,rDAAME,kHAQC7B;AARP,AASE,IAAM8B,YAAU,AAAe9B;IACzBqB,QAAM,AAAWrB;AADvB,AAEE,oBAAI,iBAAAuB,oBAAKO;AAAL,AAAA,oBAAAP;AAAe,OAACL,cAAI,AAAUY;;AAA9BP;;;AACF,OAAkBF,sBAAMS;;AACxB,OAAW9B;;;AAEjB;;;;;;;;;iDAAA,jDAAM+B,0GAQHC;AARH,AAAA;AAUE,oBAAIA;AACF,OAAWC;;AACX,OAAWA;;;AAEf;;;;;;;;;;;yDAAA,zDAAMC,0HAUClC,OAAOgC,cAAQG;AAVtB,AAWE,IAAMC,WAAS,AAACL,+CAAaC;AAA7B,AACE,OAAYhC,iBAAO,qBAAA,2CAAA,kDAAA,cAAA,uDAAA,kBAAA,kEAAA,iLAAA,5bAACjC,8VAEuB,CAAQqE,WAAS,AAASC,sIACnC,WAASC;AAAT,AAAa,IAAAC,WAAa,AAACV,mDAAiBS;AAA/B,AAAA,8FAAAC,kCAAAA,xHAACJ,4CAAAA,sDAAAA;;;AAEpD;;;;;;;;;kDAAA,lDAAMK,4GAQHC;AARH,AASE,oDAAA,mFAAA,hIAACC,2LACK,iBAAAC,qBAAA,wEAAAC;AAAA,AAAA,YAAAC,kBAAA,KAAA;AAAA,AAAA,IAAAD,eAAAA;;AAAA,AAAA,IAAAtC,qBAAA,AAAAwC,cAAAF;AAAA,AAAA,GAAAtC;AAAA,AAAA,IAAAsC,eAAAtC;AAAA,AAAA,GAAA,AAAAyC,6BAAAH;AAAA,IAAAI,kBAkxE2C,AAAAyB,sBAAA7B;IAlxE3CK,qBAAA,AAAAC,gBAAAF;IAAAG,WAAA,AAAAC,uBAAAH;AAAA,AAAA,GAAA,AAAA,iBAAAI,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAJ;AAAA,IAAAK,aAAA,AAAAC,eAAAP,gBAAAK;IAAAC,iBAAA,AAAAtE,4BAAAsE;WAAA,AAAArE,4CAAAqE,eAAA,lEAAcW;WAAd,AAAAhF,4CAAAqE,eAAA,lEAAmBY;AAAnB,AAAA,AAAA,AAAAV,uBAAAL,SAAA,oBAAA,mFAAA,mDAAA,2CAAA,wDAEgB,iBAAAiB,WAAMH;IAANG,eAAA,EAAA,CAAAA,oBAAAC,oBAAA,AAAAD,aAAA;AAAA,AAAA,QAAAA;KAAA;AACUG;;;KADV;AAEUA;;;KAFV;AAGUC;;;KAHV;AAISA;;;;AAJT,MAAA,KAAAvG,MAAA,CAAA,mEAAAmG;;;0BAFhB,2CAAA,oDACS,AAACD,5GAMPD;;AAPH,eAAA,CAAAb,WAAA;;;;AAAA;;;;;AAAA,OAAAI,qBAAA,AAAAC,gBAAAP,UAAA,AAAAQ,8DAAA,AAAAC,qBAAAhB;;AAAA,OAAAa,qBAAA,AAAAC,gBAAAP,UAAA;;;AAAA,IAAAU,aAAA,AAAAC,gBAAAlB;IAAAiB,iBAAA,AAAA7E,4BAAA6E;WAAA,AAAA5E,4CAAA4E,eAAA,lEAAcI;WAAd,AAAAhF,4CAAA4E,eAAA,lEAAmBK;AAAnB,AAAA,OAAAH,eAAA,oBAAA,mFAAA,mDAAA,2CAAA,wDAEgB,iBAAAO,WAAML;IAANK,eAAA,EAAA,CAAAA,oBAAAD,oBAAA,AAAAC,aAAA;AAAA,AAAA,QAAAA;KAAA;AACUC;;;KADV;AAEUA;;;KAFV;AAGUC;;;KAHV;AAISA;;;;AAJT,MAAA,KAAAvG,MAAA,CAAA,mEAAAqG;;;0BAFhB,2CAAA,qFAAA,AAAAX,8DAAA,AAAAK,eAAApB,9GACS,AAACuB,5GAMPD;;;AAPH;;;;GAAA,KAAA;;AAAA,AAAA,OAAAvB,mBAA0BF","names":["js/bb-web-ds-tools","js/bb-web-ds-tools.components","js/bb-web-ds-tools.components.editor","js/bb-web-ds-tools.components.editor.theme-initialized","bb-web-ds-tools.components.editor/theme-initialized","e21957","js/module$node_modules$monaco_editor$esm$vs$editor$editor_api.editor.defineTheme","cljs.core/clj->js","bb-web-ds-tools.theme/color","js/Error","e","js/console.warn","bb-web-ds-tools.components.editor/monaco-editor","_","editor-instance","reagent.core.atom","subscription","on-change-ref","cljs.core.atom","ignore-change?","reagent.core.create_class","this","e21966","map__21967","cljs.core/--destructure-map","cljs.core.get","value","mode","language","options","on-focus","on-blur","on-mount","on-change","reagent.core/props","node","js/module$node_modules$react_dom$index.findDOMNode","lang","or__5025__auto__","G__21968","editor","js/module$node_modules$monaco_editor$esm$vs$editor$editor_api.editor.create","cljs.core.merge","cljs.core/reset!","sub","new-val","temp__5825__auto__","cljs.core/deref","handler","cljs.core/vector?","re-frame.core/dispatch","cljs.core.conj","js/console.error","p__21994","vec__21995","cljs.core.nth","old-props","map__21998","cljs.core/not","cljs.core.not_EQ_","G__22005","model","current-lang","and__5023__auto__","js/module$node_modules$monaco_editor$esm$vs$editor$editor_api.editor.setModelLanguage","props","map__22043","style","class","bb-web-ds-tools.components.editor/get-code-to-eval","selection","bb-web-ds-tools.components.editor/get-ctrl-key","mac-os?","js/module$node_modules$monaco_editor$esm$vs$editor$editor_api.KeyMod","bb-web-ds-tools.components.editor/setup-editor-actions","eval-action","ctrl-key","js/module$node_modules$monaco_editor$esm$vs$editor$editor_api.KeyCode","ed","G__22064","bb-web-ds-tools.components.editor/render-output","output","cljs.core.into","iter__5503__auto__","s__22066","cljs.core/LazySeq","cljs.core/seq","cljs.core/chunked-seq?","c__5501__auto__","size__5502__auto__","cljs.core/count","b__22068","cljs.core/chunk-buffer","i__22067","map__22081","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__22065","cljs.core/chunk-rest","map__22090","cljs.core/first","cljs.core/cons","cljs.core/rest","type","text","cljs.core/random-uuid","G__22082","cljs.core/Keyword","G__22091","bb-web-ds-tools.theme/text-primary","bb-web-ds-tools.theme/text-danger","cljs.core/chunk-first"],"sourcesContent":["(ns bb-web-ds-tools.components.editor\n  (:require [reagent.core :as r]\n            [re-frame.core :as rf]\n            [\"react-dom\" :as react-dom]\n            [\"monaco-editor/esm/vs/editor/editor.api.js\" :as monaco :refer [KeyMod KeyCode]]\n            [\"monaco-editor/esm/vs/basic-languages/clojure/clojure.contribution.js\"]\n            [\"monaco-editor/esm/vs/basic-languages/python/python.contribution.js\"]\n            [\"monaco-editor/esm/vs/basic-languages/r/r.contribution.js\"]\n            [bb-web-ds-tools.theme :as t]))\n\n(defonce theme-initialized\n  (try\n    (monaco/editor.defineTheme\n     \"zenburn\"\n     (clj->js {:base \"vs-dark\"\n               :inherit true\n               :rules [{:background (t/color :bg-page)\n                        :foreground (t/color :text-primary)}]\n               :colors {:editor.background (t/color :bg-page)\n                        :editor.foreground (t/color :text-primary)\n                        :editorCursor.foreground (t/color :text-muted)\n                        :editor.lineHighlightBackground (t/color :bg-card)\n                        :editor.selectionBackground (t/color :bg-button)\n                        :editor.inactiveSelectionBackground (t/color :bg-card)}}))\n    true\n    (catch js/Error e\n      (js/console.warn \"Failed to define Zenburn theme\" e)\n      false)))\n\n(defn monaco-editor\n  \"Renders a Monaco Editor component.\n\n  Args:\n    props (map): Props for the editor. Keys:\n      - :value (string): Code content.\n      - :language (string): Language mode.\n      - :options (map): Monaco editor options.\n      - :on-change (fn/vec): Callback or event vector.\n      - :on-mount (fn): Callback(editor-instance).\n\n  Returns:\n    vector: A hiccup vector.\"\n  [_]\n  (let [editor-instance (r/atom nil)\n        subscription (r/atom nil)\n        on-change-ref (atom nil)\n        ignore-change? (atom false)]\n    (r/create-class\n     {:displayName \"monaco-editor\"\n      :component-did-mount\n      (fn [this]\n        (try\n          (let [{:keys [value mode language options on-focus\n                        on-blur on-mount on-change]} (r/props this)\n                node (react-dom/findDOMNode this)\n                lang (or language\n                         (case mode\n                           \"application/json\" \"json\"\n                           \"markdown\" \"markdown\"\n                           \"clojure\"))\n                editor (monaco/editor.create\n                        node\n                        (clj->js\n                         (merge\n                          {:value (or value \"\")\n                           :language lang\n                           :linenumber \"off\"\n                           :theme \"zenburn\"\n                           :automaticLayout true\n                           :minimap {:enabled false}\n                           :scrollBeyondLastLine false\n                           :fontFamily \"Menlo, Monaco, 'Courier New', monospace\"\n                           :fontSize 14}\n                          options)))]\n\n            (reset! editor-instance editor)\n            (reset! on-change-ref on-change)\n\n            (when on-mount\n              (on-mount editor))\n\n            (let [sub (.onDidChangeModelContent\n                       editor\n                       (fn []\n                         (reset! ignore-change? true)\n                         (let [new-val (.getValue editor)]\n                           (when-let [handler @on-change-ref]\n                             (if (vector? handler)\n                               (rf/dispatch (conj handler new-val))\n                               (handler new-val))))\n                         (reset! ignore-change? false)))]\n              (reset! subscription sub))\n\n            (when on-focus\n              (.onDidFocusEditorText editor on-focus))\n            (when on-blur\n              (.onDidBlurEditorText editor on-blur)))\n          (catch js/Error e\n            (js/console.error \"Monaco initialization failed:\" e))))\n\n      :component-did-update\n      (fn [this [_ old-props]]\n        (let [{:keys [value language mode options on-change]} (r/props this)\n              editor ^js @editor-instance]\n          (reset! on-change-ref on-change)\n          (when editor\n            (when (and (not @ignore-change?)\n                       (not= (.getValue editor) value))\n              (.setValue editor (or value \"\")))\n\n            (let [lang (or language\n                           (case mode\n                             \"application/json\" \"json\"\n                             \"markdown\" \"markdown\"\n                             \"clojure\"))\n                  model (.getModel editor)\n                  current-lang (when model (.getLanguageId model))]\n              (when (and model lang (not= current-lang lang))\n                (monaco/editor.setModelLanguage model lang)))\n\n            (when (not= (:options old-props) options)\n              (.updateOptions editor (clj->js options))))))\n\n      :component-will-unmount\n      (fn [this]\n        (when-let [sub @subscription]\n          (.dispose sub))\n        (when-let [editor @editor-instance]\n          (.dispose editor)))\n\n      :reagent-render\n      (fn [props]\n        (let [{:keys [style class]} props]\n          [:div.editor-wrapper\n           {:class class\n            :style (merge {:width \"100%\" :height \"100%\"} style)}]))})))\n\n;; Shared Editor Utilities\n\n(defn get-code-to-eval\n  \"Gets the code to evaluate from the editor (selected text or full content).\n\n  Args:\n    editor (object): The Monaco editor instance.\n\n  Returns:\n    string: The code string.\"\n  [^js editor]\n  (let [selection (.getSelection editor)\n        model (.getModel editor)]\n    (if (and selection (not (.isEmpty selection)))\n      (.getValueInRange model selection)\n      (.getValue editor))))\n\n(defn get-ctrl-key\n  \"Gets the Control key constant for the current platform.\n\n  Args:\n    mac-os? (boolean): Whether running on macOS.\n\n  Returns:\n    number: The KeyMod constant.\"\n  [mac-os?]\n  \"Use Ctrl on all platforms for consistent keyboard shortcuts.\"\n  (if mac-os?\n    (.-WinCtrl KeyMod)\n    (.-CtrlCmd KeyMod)))\n\n(defn setup-editor-actions\n  \"Sets up standard actions (like Evaluate Buffer) for the editor.\n\n  Args:\n    editor (object): The editor instance.\n    mac-os? (boolean): Platform flag.\n    eval-action (fn): Callback(code) to execute.\n\n  Returns:\n    nil.\"\n  [^js editor mac-os? eval-action]\n  (let [ctrl-key (get-ctrl-key mac-os?)]\n    (.addAction editor (clj->js {:id \"eval-buffer\"\n                                 :label \"Evaluate Buffer\"\n                                 :keybindings [(bit-or ctrl-key (.-Enter KeyCode))]\n                                 :run (fn [^js ed] (eval-action (get-code-to-eval ed)))}))))\n\n(defn render-output\n  \"Renders a list of output messages.\n\n  Args:\n    output (seq): List of message maps {:type :text}.\n\n  Returns:\n    vector: A hiccup vector.\"\n  [output]\n  (into [:div]\n        (for [{:keys [type text]} output]\n          ^{:key (random-uuid)}\n          [:pre {:class (case type\n                          :result t/text-primary\n                          :stdout t/text-primary\n                          :stderr t/text-danger\n                          :error t/text-danger)}\n           text])))\n"],"x_google_ignoreList":[0]}