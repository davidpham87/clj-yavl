{"version":3,"sources":["clj_yavl/webapp/subs.cljc"],"mappings":";AAQA,qCAAA,rCAAMA,kFACHC,GAAGC;AADN,AAEE,OAACC,eAAK,kDAAA,mFAAA,iEAAA,tMAACC,+CAAOH;;AAEhB,iCAAA,4CAAAI,7EAAMG,0EACHP;AADH,AAAA,IAAAK,aAAAD;QAAA,AAAAE,4CAAAD,WAAA,IAAA,/DACOJ;SADP,AAAAK,4CAAAD,WAAA,IAAA,hEACSG;AADT,AAEE,yDAAA,mFAAA,iEAAA,tMAACL,+CAAOH,wNAA4BQ;;AAEtC,sCAAA,tCAAMC,oFACHT,GAAGC;AADN,AAEE,yDAAA,mFAAA,iEAAA,tMAACE,+CAAOH;;AAEV,6CAAA,7CAAMU,kGACHC,KAAKV;AADR,AAEE,oBAAMU;AAAN,AACE,IAAAC,aAA2BD;IAA3BC,iBAAA,AAAAC,4BAAAD;WAAA,AAAAE,4CAAAF,eAAA,lEAAcG;YAAd,AAAAD,4CAAAF,eAAA,nEAAmBI;AAAnB,AACE,IAAA,AACE,OAACE,yDAAkB,oDAAA,pDAACC,8CAAMH,2DAAYD;gBADxC,QAAAE,JAE2CG;AAF3C,AAAA,kDAAA,uDAGY,CAAA,qEAA8BA;;AAL9C;;;AAOF,uCAAA,vCAAMC,sFACHrB,GAAGC;AADN,AAEE,yDAAA,mFAAA,iEAAA,+DAAA,rQAACE,+CAAOH;;AAEV,oCAAA,pCAAMsB,gFACHC;AADH,AAEE,OAAA,0IAAqBA;;AAEvB,mCAAA,nCAAMC,8EACHD;AADH,AAEE,OAAA,wIAAoBA;;AAEtB,qCAAA,6CAAAE,lFAAME,2FACU1B;AADhB,AAAA,IAAAyB,aAAAD;YAAA,AAAAnB,4CAAAoB,WAAA,IAAA,nEACIV;WADJ,AAAAV,4CAAAoB,WAAA,IAAA,lEACUE;AADV,AAEE,IAAA,AACE,GAAI,kDAAA,lDAACE,6CAAEF;AACL,qEAAA,2CAAA,zGAACG,wDAAiBf,0GAAegB;;AACjC,OAACC,sDAAgBjB;;gBAHrB,YAAAa,RAI2C5B;AAJ3C,AAAA;;AAMF,sCAAA,qDAAAiC,3FAAME,oFACHC;AADH,AAAA,IAAAF,aAAAD;QAAA,AAAA5B,4CAAA6B,WAAA,IAAA,/DACWlC;eADX,AAAAK,4CAAA6B,WAAA,IAAA,tEACaG;AADb,AAEE,OAACxB,4CAAIuB,OAAOC;;AAId,6BAAA,7BAAMC,kEACHvC,GAAGC;AADN,AAEE,yDAAA,mFAAA,iEAAA,+DAAA,4DAAA,jUAACE,+CAAOH;;AAEV,4BAAA,5BAAMwC,gEACHC,MAAMxC;AADT,AAEE,oBAAMwC;AAAN,AACE,IAAMC,IAAE,uBAAA,mFAAA,4DAAA,mEAAA,mFAAA,qDAAA,jXAACC,iBAAQF;AAAjB,AAGE,IAAMlB,OAAK,uBAAA,mFAAA,2CAAA,wDAAA,mFAAA,4DAAA,mFAAA,mFAAA,qDAAA,vjBAACoB,iBAAQF;AAApB,AACE,2DAAA,mFAAA,wDAAA,/LAACtC,+CAAOoB;;AALd;;;AAOF,gCAAA,hCAAMqB,wEACHH,MAAMxC;AADT,AAEE,oBAAMwC;AAAN,AACE,IAAMlB,OAAK,uBAAA,mFAAA,2CAAA,gEAAA,mFAAA,2CAAA,4EAAA,mFAAA,mEAAA,mEAAA,iEAAA,yGAAA,mFAAA,qDAAA,16BAACoB,iBAAQF;AAApB,AACE,oDAAA,7CAACI,gFAAQ,AAACC,4CAAI,WAAKC;AAAL,AAAA,0FACG,AAAA,iGAAeA,GAAG,AAACC,uGAAM,AAAA,+FAAcD,GACd,wBAAA,mFAAA,mEAAA,9KAACE,sBAAYF;GACzC,oDAAA,mFAAA,gEAAA,vMAAC5C,+CAAOoB;;AAL1B;;;AAOF,+BAAA,/BAAM2B,sEACHT,MAAMxC;AADT,AAEE,oBAAMwC;AAAN,AACE,OAAA,6FAAa,uBAAA,mFAAA,uEAAA,mFAAA,qDAAA,zTAACE,iBAAQF;;AADxB;;;AAGF,2DAAA,3DAACU,kOAEA,WAAKnD,GAAGC;AAAR,AACE,yDAAA,mFAAA,iEAAA,uFAAA,7RAACE,+CAAOH;;AAEX,2DAAA,3DAACmD,wNAEA,WAAKnD,GAAGC;AAAR,AACE,yDAAA,mFAAA,iEAAA,4EAAA,lRAACE,+CAAOH;;AAEX,2DAAA,3DAACmD,8NAEA,WAAKnD,GAAGC;AAAR,AACE,yDAAA,mFAAA,sGAAA,3OAACE,+CAAOH;;AAEX,2DAAA,3DAACmD,kOAEA,WAAKnD,GAAGC;AAAR,AACE,yDAAA,mFAAA,iEAAA,iEAAA,0EAAA,jVAACE,+CAAOH;;AAEX,2DAAA,3DAACmD,+NAEA,WAAKnD,GAAGC;AAAR,AACE,yDAAA,mFAAA,iEAAA,iEAAA,4DAAA,nUAACE,+CAAOH","names":["clj-yavl.webapp.subs/unit-spec-ids","db","_","cljs.core/keys","cljs.core.get_in","p__29677","vec__29678","cljs.core.nth","clj-yavl.webapp.subs/unit-spec","id","clj-yavl.webapp.subs/all-unit-specs","clj-yavl.webapp.subs/compiled-unit-spec-fn","spec","map__29682","cljs.core/--destructure-map","cljs.core.get","type","input","e29684","clj-yavl.presets/unit-spec","cljs.core.assoc","e","clj-yavl.webapp.subs/user-input-root","clj-yavl.webapp.subs/config-input","root","clj-yavl.webapp.subs/config-mode","p__29689","vec__29690","clj-yavl.webapp.subs/parsed-config","mode","e29693","cljs.core._EQ_","clj_yavl.io.read_json_str","cljs.core/keyword","clojure.edn.read_string","p__29698","vec__29699","clj-yavl.webapp.subs/top-level-prop","config","prop-key","clj-yavl.webapp.subs/ds-db","clj-yavl.webapp.subs/mark","ds-db","m","clj-yavl.db/pull","clj-yavl.webapp.subs/encoding","cljs.core.into","cljs.core.map","c","cljs.core.merge","cljs.core/select-keys","clj-yavl.webapp.subs/tooltip","re_frame.core.reg_sub"],"sourcesContent":["(ns clj-yavl.webapp.subs\n  (:require [clj-yavl.presets :as presets]\n            [clojure.edn :as edn]\n            [clj-yavl.io :as io]\n            [re-frame.core :as rf]\n            [clj-yavl.webapp.core :as-alias core]\n            [clj-yavl.db :as db]))\n\n(defn unit-spec-ids\n  [db _]\n  (keys (get-in db [:user-input :unit-specs])))\n\n(defn unit-spec\n  [db [_ id]]\n  (get-in db [:user-input :unit-specs id]))\n\n(defn all-unit-specs\n  [db _]\n  (get-in db [:user-input :unit-specs]))\n\n(defn compiled-unit-spec-fn\n  [spec _]\n  (when spec\n    (let [{:keys [type input]} spec]\n      (try\n        (presets/unit-spec (assoc input :type type))\n        (catch #?(:clj Exception :cljs :default) e\n          {:error (str \"Error compiling spec: \" e)})))))\n\n(defn user-input-root\n  [db _]\n  (get-in db [:user-input :vega-lite :default]))\n\n(defn config-input\n  [root]\n  (::core/config-input root))\n\n(defn config-mode\n  [root]\n  (::core/config-mode root))\n\n(defn parsed-config\n  [[input mode] _]\n  (try\n    (if (= mode :json)\n      (io/read-json-str input {:key-fn keyword})\n      (edn/read-string input))\n    (catch #?(:clj Exception :cljs :default) _ nil)))\n\n(defn top-level-prop\n  [config [_ prop-key]]\n  (get config prop-key))\n\n;; DataScript Subscriptions\n\n(defn ds-db\n  [db _]\n  (get-in db [:user-input :vega-lite :default ::core/ds-db]))\n\n(defn mark\n  [ds-db _]\n  (when ds-db\n    (let [m (db/pull ds-db [:mark/type :mark/def] [:vl/id \"default\"])]\n      ;; Wait, :vl/mark is a ref. We need to follow it.\n      ;; Or pull from the root.\n      (let [root (db/pull ds-db [{:vl/mark [:mark/type :mark/def]}] [:vl/id \"default\"])]\n        (get-in root [:vl/mark :mark/type])))))\n\n(defn encoding\n  [ds-db _]\n  (when ds-db\n    (let [root (db/pull ds-db [{:vl/encoding [{:encoding/channels [:channel/name :channel/field :channel/type :channel/def]}]}] [:vl/id \"default\"])]\n      (into {} (map (fn [c]\n                      [(:channel/name c) (merge (:channel/def c)\n                                                (select-keys c [:channel/field :channel/type]))])\n                    (get-in root [:vl/encoding :encoding/channels]))))))\n\n(defn tooltip\n  [ds-db _]\n  (when ds-db\n    (:vl/tooltip (db/pull ds-db [:vl/tooltip] [:vl/id \"default\"]))))\n\n(rf/reg-sub\n ::dataset-url-input\n (fn [db _]\n   (get-in db [:user-input :dataset-url-input] \"\")))\n\n(rf/reg-sub\n ::dataset-list\n (fn [db _]\n   (get-in db [:user-input :dataset-list] [])))\n\n(rf/reg-sub\n ::inferred-schema\n (fn [db _]\n   (get-in db [::core/vega-lite ::core/inferred-schema])))\n\n(rf/reg-sub\n ::ui-builder-preset\n (fn [db _]\n   (get-in db [:user-input :ui-builder :preset-key] :xyplot)))\n\n(rf/reg-sub\n ::ui-builder-opts\n (fn [db _]\n   (get-in db [:user-input :ui-builder :opts] {})))\n"]}