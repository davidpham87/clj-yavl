shadow$provide.module$node_modules$monaco_editor$esm$vs$editor$common$services$languageFeatureDebounce = function(require, module, exports) {
  Object.defineProperties(exports, {__esModule:{enumerable:!0, value:!0}, ILanguageFeatureDebounceService:{enumerable:!0, get:function() {
    return ILanguageFeatureDebounceService;
  }}, LanguageFeatureDebounceService:{enumerable:!0, get:function() {
    return LanguageFeatureDebounceService;
  }}});
  var require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_hash_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$hash"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_map_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$map"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_numbers_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$numbers");
  module = require("module$node_modules$monaco_editor$esm$vs$platform$environment$common$environment");
  exports = require("module$node_modules$monaco_editor$esm$vs$platform$instantiation$common$extensions");
  var require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_platform_SLASH_instantiation_SLASH_common_SLASH_instantiation_DOT_js = require("module$node_modules$monaco_editor$esm$vs$platform$instantiation$common$instantiation"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_platform_SLASH_log_SLASH_common_SLASH_log_DOT_js = require("module$node_modules$monaco_editor$esm$vs$platform$log$common$log"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_network_DOT_js = 
  require("module$node_modules$monaco_editor$esm$vs$base$common$network");
  require = this && this.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") {
      r = Reflect.decorate(decorators, target, key, desc);
    } else {
      for (var i = decorators.length - 1; i >= 0; i--) {
        if (d = decorators[i]) {
          r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
        }
      }
    }
    return c > 3 && r && Object.defineProperty(target, key, r), r;
  };
  var __param = this && this.__param || function(paramIndex, decorator) {
    return function(target, key) {
      decorator(target, key, paramIndex);
    };
  };
  const ILanguageFeatureDebounceService = (0,require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_platform_SLASH_instantiation_SLASH_common_SLASH_instantiation_DOT_js.createDecorator)("ILanguageFeatureDebounceService");
  var IdentityHash;
  (function(IdentityHash) {
    const _hashes = new WeakMap();
    let pool = 0;
    IdentityHash.of = function(obj) {
      let value = _hashes.get(obj);
      value === void 0 && (value = ++pool, _hashes.set(obj, value));
      return value;
    };
  })(IdentityHash ||= {});
  class NullDebounceInformation {
    constructor(_default) {
      this._default = _default;
    }
    get(_model) {
      return this._default;
    }
    update(_model, _value) {
      return this._default;
    }
    default() {
      return this._default;
    }
  }
  class FeatureDebounceInformation {
    constructor(_logService, _name, _registry, _default, _min, _max) {
      this._logService = _logService;
      this._name = _name;
      this._registry = _registry;
      this._default = _default;
      this._min = _min;
      this._max = _max;
      this._cache = new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_map_DOT_js.LRUCache(50, 0.7);
    }
    _key(model) {
      return model.id + this._registry.all(model).reduce((hashVal, obj) => (0,require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_hash_DOT_js.doHash)(IdentityHash.of(obj), hashVal), 0);
    }
    get(model) {
      model = this._key(model);
      return (model = this._cache.get(model)) ? (0,require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_numbers_DOT_js.clamp)(model.value, this._min, this._max) : this.default();
    }
    update(model, value) {
      const key = this._key(model);
      let avg = this._cache.get(key);
      avg || (avg = new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_numbers_DOT_js.SlidingWindowAverage(6), this._cache.set(key, avg));
      value = (0,require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_numbers_DOT_js.clamp)(avg.update(value), this._min, this._max);
      (0,require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_network_DOT_js.matchesScheme)(model.uri, "output") || this._logService.trace(`[DEBOUNCE: ${this._name}] for ${model.uri.toString()} is ${value}ms`);
      return value;
    }
    _overall() {
      const result = new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_numbers_DOT_js.MovingAverage();
      for (const [, avg] of this._cache) {
        result.update(avg.value);
      }
      return result.value;
    }
    default() {
      const value = this._overall() | 0 || this._default;
      return (0,require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_numbers_DOT_js.clamp)(value, this._min, this._max);
    }
  }
  let LanguageFeatureDebounceService = class {
    constructor(_logService, envService) {
      this._logService = _logService;
      this._data = new Map();
      this._isDev = envService.isExtensionDevelopment || !envService.isBuilt;
    }
    for(feature, name, config) {
      var _a, _b, _c;
      const min = (_a = config === null || config === void 0 ? void 0 : config.min) !== null && _a !== void 0 ? _a : 50;
      _a = (_b = config === null || config === void 0 ? void 0 : config.max) !== null && _b !== void 0 ? _b : min ** 2;
      config = (_c = config === null || config === void 0 ? void 0 : config.key) !== null && _c !== void 0 ? _c : void 0;
      _c = `${IdentityHash.of(feature)},${min}${config ? "," + config : ""}`;
      config = this._data.get(_c);
      config || (this._isDev ? config = new FeatureDebounceInformation(this._logService, name, feature, this._overallAverage() | 0 || min * 1.5, min, _a) : (this._logService.debug(`[DEBOUNCE: ${name}] is disabled in developed mode`), config = new NullDebounceInformation(min * 1.5)), this._data.set(_c, config));
      return config;
    }
    _overallAverage() {
      const result = new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_numbers_DOT_js.MovingAverage();
      for (const info of this._data.values()) {
        result.update(info.default());
      }
      return result.value;
    }
  };
  LanguageFeatureDebounceService = require([__param(0, require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_platform_SLASH_log_SLASH_common_SLASH_log_DOT_js.ILogService), __param(1, module.IEnvironmentService)], LanguageFeatureDebounceService);
  (0,exports.registerSingleton)(ILanguageFeatureDebounceService, LanguageFeatureDebounceService, 1);
};

//# sourceMappingURL=module$node_modules$monaco_editor$esm$vs$editor$common$services$languageFeatureDebounce.js.map
