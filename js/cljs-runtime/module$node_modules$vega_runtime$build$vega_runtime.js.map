{
"version":3,
"file":"module$node_modules$vega_runtime$build$vega_runtime.js",
"lineCount":262,
"mappings":"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",
"sources":["node_modules/vega-runtime/build/vega-runtime.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$vega_runtime$build$vega_runtime\"] = function(require,module,exports) {\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('vega-util'), require('vega-dataflow')) :\n  typeof define === 'function' && define.amd ? define(['exports', 'vega-util', 'vega-dataflow'], factory) :\n  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.vega = {}, global.vega, global.vega));\n})(this, (function (exports, vegaUtil, vegaDataflow) { 'use strict';\n\n  /**\n   * Parse a serialized dataflow specification.\n   */\n  function parse (spec) {\n    const ctx = this,\n      operators = spec.operators || [];\n\n    // parse background\n    if (spec.background) {\n      ctx.background = spec.background;\n    }\n\n    // parse event configuration\n    if (spec.eventConfig) {\n      ctx.eventConfig = spec.eventConfig;\n    }\n\n    // parse locale configuration\n    if (spec.locale) {\n      ctx.locale = spec.locale;\n    }\n\n    // parse operators\n    operators.forEach(entry => ctx.parseOperator(entry));\n\n    // parse operator parameters\n    operators.forEach(entry => ctx.parseOperatorParameters(entry));\n\n    // parse streams\n    (spec.streams || []).forEach(entry => ctx.parseStream(entry));\n\n    // parse updates\n    (spec.updates || []).forEach(entry => ctx.parseUpdate(entry));\n    return ctx.resolve();\n  }\n\n  const Skip = vegaUtil.toSet(['rule']),\n    Swap = vegaUtil.toSet(['group', 'image', 'rect']);\n  function adjustSpatial(encode, marktype) {\n    let code = '';\n    if (Skip[marktype]) return code;\n    if (encode.x2) {\n      if (encode.x) {\n        if (Swap[marktype]) {\n          code += 'if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;';\n        }\n        code += 'o.width=o.x2-o.x;';\n      } else {\n        code += 'o.x=o.x2-(o.width||0);';\n      }\n    }\n    if (encode.xc) {\n      code += 'o.x=o.xc-(o.width||0)/2;';\n    }\n    if (encode.y2) {\n      if (encode.y) {\n        if (Swap[marktype]) {\n          code += 'if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;';\n        }\n        code += 'o.height=o.y2-o.y;';\n      } else {\n        code += 'o.y=o.y2-(o.height||0);';\n      }\n    }\n    if (encode.yc) {\n      code += 'o.y=o.yc-(o.height||0)/2;';\n    }\n    return code;\n  }\n  function canonicalType(type) {\n    return (type + '').toLowerCase();\n  }\n  function isOperator(type) {\n    return canonicalType(type) === 'operator';\n  }\n  function isCollect(type) {\n    return canonicalType(type) === 'collect';\n  }\n\n  function expression(ctx, args, code) {\n    // wrap code in return statement if expression does not terminate\n    if (!code.endsWith(';')) {\n      code = 'return(' + code + ');';\n    }\n    const fn = Function(...args.concat(code));\n    return ctx && ctx.functions ? fn.bind(ctx.functions) : fn;\n  }\n\n  // generate code for comparing a single field\n  function _compare(u, v, lt, gt) {\n    return `((u = ${u}) < (v = ${v}) || u == null) && v != null ? ${lt}\n  : (u > v || v == null) && u != null ? ${gt}\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${lt}\n  : v !== v && u === u ? ${gt} : `;\n  }\n  var expressionCodegen = {\n    /**\n     * Parse an expression used to update an operator value.\n     */\n    operator: (ctx, expr) => expression(ctx, ['_'], expr.code),\n    /**\n     * Parse an expression provided as an operator parameter value.\n     */\n    parameter: (ctx, expr) => expression(ctx, ['datum', '_'], expr.code),\n    /**\n     * Parse an expression applied to an event stream.\n     */\n    event: (ctx, expr) => expression(ctx, ['event'], expr.code),\n    /**\n     * Parse an expression used to handle an event-driven operator update.\n     */\n    handler: (ctx, expr) => {\n      const code = `var datum=event.item&&event.item.datum;return ${expr.code};`;\n      return expression(ctx, ['_', 'event'], code);\n    },\n    /**\n     * Parse an expression that performs visual encoding.\n     */\n    encode: (ctx, encode) => {\n      const {\n        marktype,\n        channels\n      } = encode;\n      let code = 'var o=item,datum=o.datum,m=0,$;';\n      for (const name in channels) {\n        const o = 'o[' + vegaUtil.stringValue(name) + ']';\n        code += `$=${channels[name].code};if(${o}!==$)${o}=$,m=1;`;\n      }\n      code += adjustSpatial(channels, marktype);\n      code += 'return m;';\n      return expression(ctx, ['item', '_'], code);\n    },\n    /**\n     * Optimized code generators for access and comparison.\n     */\n    codegen: {\n      get(path) {\n        const ref = `[${path.map(vegaUtil.stringValue).join('][')}]`;\n        const get = Function('_', `return _${ref};`);\n        get.path = ref;\n        return get;\n      },\n      comparator(fields, orders) {\n        let t;\n        const map = (f, i) => {\n          const o = orders[i];\n          let u, v;\n          if (f.path) {\n            u = `a${f.path}`;\n            v = `b${f.path}`;\n          } else {\n            (t = t || {})['f' + i] = f;\n            u = `this.f${i}(a)`;\n            v = `this.f${i}(b)`;\n          }\n          return _compare(u, v, -o, o);\n        };\n        const fn = Function('a', 'b', 'var u, v; return ' + fields.map(map).join('') + '0;');\n        return t ? fn.bind(t) : fn;\n      }\n    }\n  };\n\n  /**\n   * Parse a dataflow operator.\n   */\n  function parseOperator(spec) {\n    const ctx = this;\n    if (isOperator(spec.type) || !spec.type) {\n      ctx.operator(spec, spec.update ? ctx.operatorExpression(spec.update) : null);\n    } else {\n      ctx.transform(spec, spec.type);\n    }\n  }\n\n  /**\n   * Parse and assign operator parameters.\n   */\n  function parseOperatorParameters(spec) {\n    const ctx = this;\n    if (spec.params) {\n      const op = ctx.get(spec.id);\n      if (!op) vegaUtil.error('Invalid operator id: ' + spec.id);\n      ctx.dataflow.connect(op, op.parameters(ctx.parseParameters(spec.params), spec.react, spec.initonly));\n    }\n  }\n\n  /**\n   * Parse a set of operator parameters.\n   */\n  function parseParameters(spec, params) {\n    params = params || {};\n    const ctx = this;\n    for (const key in spec) {\n      const value = spec[key];\n      params[key] = vegaUtil.isArray(value) ? value.map(v => parseParameter(v, ctx, params)) : parseParameter(value, ctx, params);\n    }\n    return params;\n  }\n\n  /**\n   * Parse a single parameter.\n   */\n  function parseParameter(spec, ctx, params) {\n    if (!spec || !vegaUtil.isObject(spec)) return spec;\n    for (let i = 0, n = PARSERS.length, p; i < n; ++i) {\n      p = PARSERS[i];\n      if (vegaUtil.hasOwnProperty(spec, p.key)) {\n        return p.parse(spec, ctx, params);\n      }\n    }\n    return spec;\n  }\n\n  /** Reference parsers. */\n  var PARSERS = [{\n    key: '$ref',\n    parse: getOperator\n  }, {\n    key: '$key',\n    parse: getKey\n  }, {\n    key: '$expr',\n    parse: getExpression\n  }, {\n    key: '$field',\n    parse: getField\n  }, {\n    key: '$encode',\n    parse: getEncode\n  }, {\n    key: '$compare',\n    parse: getCompare\n  }, {\n    key: '$context',\n    parse: getContext\n  }, {\n    key: '$subflow',\n    parse: getSubflow\n  }, {\n    key: '$tupleid',\n    parse: getTupleId\n  }];\n\n  /**\n   * Resolve an operator reference.\n   */\n  function getOperator(_, ctx) {\n    return ctx.get(_.$ref) || vegaUtil.error('Operator not defined: ' + _.$ref);\n  }\n\n  /**\n   * Resolve an expression reference.\n   */\n  function getExpression(_, ctx, params) {\n    if (_.$params) {\n      // parse expression parameters\n      ctx.parseParameters(_.$params, params);\n    }\n    const k = 'e:' + _.$expr.code;\n    return ctx.fn[k] || (ctx.fn[k] = vegaUtil.accessor(ctx.parameterExpression(_.$expr), _.$fields));\n  }\n\n  /**\n   * Resolve a key accessor reference.\n   */\n  function getKey(_, ctx) {\n    const k = 'k:' + _.$key + '_' + !!_.$flat;\n    return ctx.fn[k] || (ctx.fn[k] = vegaUtil.key(_.$key, _.$flat, ctx.expr.codegen));\n  }\n\n  /**\n   * Resolve a field accessor reference.\n   */\n  function getField(_, ctx) {\n    if (!_.$field) return null;\n    const k = 'f:' + _.$field + '_' + _.$name;\n    return ctx.fn[k] || (ctx.fn[k] = vegaUtil.field(_.$field, _.$name, ctx.expr.codegen));\n  }\n\n  /**\n   * Resolve a comparator function reference.\n   */\n  function getCompare(_, ctx) {\n    // As of Vega 5.5.3, $tupleid sort is no longer used.\n    // Keep here for now for backwards compatibility.\n    const k = 'c:' + _.$compare + '_' + _.$order,\n      c = vegaUtil.array(_.$compare).map(_ => _ && _.$tupleid ? vegaDataflow.tupleid : _);\n    return ctx.fn[k] || (ctx.fn[k] = vegaUtil.compare(c, _.$order, ctx.expr.codegen));\n  }\n\n  /**\n   * Resolve an encode operator reference.\n   */\n  function getEncode(_, ctx) {\n    const spec = _.$encode,\n      encode = {};\n    for (const name in spec) {\n      const enc = spec[name];\n      encode[name] = vegaUtil.accessor(ctx.encodeExpression(enc.$expr), enc.$fields);\n      encode[name].output = enc.$output;\n    }\n    return encode;\n  }\n\n  /**\n   * Resolve a context reference.\n   */\n  function getContext(_, ctx) {\n    return ctx;\n  }\n\n  /**\n   * Resolve a recursive subflow specification.\n   */\n  function getSubflow(_, ctx) {\n    const spec = _.$subflow;\n    return function (dataflow, key, parent) {\n      const subctx = ctx.fork().parse(spec),\n        op = subctx.get(spec.operators[0].id),\n        p = subctx.signals.parent;\n      if (p) p.set(parent);\n      op.detachSubflow = () => ctx.detach(subctx);\n      return op;\n    };\n  }\n\n  /**\n   * Resolve a tuple id reference.\n   */\n  function getTupleId() {\n    return vegaDataflow.tupleid;\n  }\n\n  /**\n   * Parse an event stream specification.\n   */\n  function parseStream (spec) {\n    var ctx = this,\n      filter = spec.filter != null ? ctx.eventExpression(spec.filter) : undefined,\n      stream = spec.stream != null ? ctx.get(spec.stream) : undefined,\n      args;\n    if (spec.source) {\n      stream = ctx.events(spec.source, spec.type, filter);\n    } else if (spec.merge) {\n      args = spec.merge.map(_ => ctx.get(_));\n      stream = args[0].merge.apply(args[0], args.slice(1));\n    }\n    if (spec.between) {\n      args = spec.between.map(_ => ctx.get(_));\n      stream = stream.between(args[0], args[1]);\n    }\n    if (spec.filter) {\n      stream = stream.filter(filter);\n    }\n    if (spec.throttle != null) {\n      stream = stream.throttle(+spec.throttle);\n    }\n    if (spec.debounce != null) {\n      stream = stream.debounce(+spec.debounce);\n    }\n    if (stream == null) {\n      vegaUtil.error('Invalid stream definition: ' + JSON.stringify(spec));\n    }\n    if (spec.consume) stream.consume(true);\n    ctx.stream(spec, stream);\n  }\n\n  /**\n   * Parse an event-driven operator update.\n   */\n  function parseUpdate (spec) {\n    var ctx = this,\n      srcid = vegaUtil.isObject(srcid = spec.source) ? srcid.$ref : srcid,\n      source = ctx.get(srcid),\n      target = null,\n      update = spec.update,\n      params = undefined;\n    if (!source) vegaUtil.error('Source not defined: ' + spec.source);\n    target = spec.target && spec.target.$expr ? ctx.eventExpression(spec.target.$expr) : ctx.get(spec.target);\n    if (update && update.$expr) {\n      if (update.$params) {\n        params = ctx.parseParameters(update.$params);\n      }\n      update = ctx.handlerExpression(update.$expr);\n    }\n    ctx.update(spec, source, target, update, params);\n  }\n\n  const SKIP = {\n    skip: true\n  };\n  function getState(options) {\n    var ctx = this,\n      state = {};\n    if (options.signals) {\n      var signals = state.signals = {};\n      Object.keys(ctx.signals).forEach(key => {\n        const op = ctx.signals[key];\n        if (options.signals(key, op)) {\n          signals[key] = op.value;\n        }\n      });\n    }\n    if (options.data) {\n      var data = state.data = {};\n      Object.keys(ctx.data).forEach(key => {\n        const dataset = ctx.data[key];\n        if (options.data(key, dataset)) {\n          data[key] = dataset.input.value;\n        }\n      });\n    }\n    if (ctx.subcontext && options.recurse !== false) {\n      state.subcontext = ctx.subcontext.map(ctx => ctx.getState(options));\n    }\n    return state;\n  }\n  function setState(state) {\n    var ctx = this,\n      df = ctx.dataflow,\n      data = state.data,\n      signals = state.signals;\n    Object.keys(signals || {}).forEach(key => {\n      df.update(ctx.signals[key], signals[key], SKIP);\n    });\n    Object.keys(data || {}).forEach(key => {\n      df.pulse(ctx.data[key].input, df.changeset().remove(vegaUtil.truthy).insert(data[key]));\n    });\n    (state.subcontext || []).forEach((substate, i) => {\n      const subctx = ctx.subcontext[i];\n      if (subctx) subctx.setState(substate);\n    });\n  }\n\n  /**\n   * Context objects store the current parse state.\n   * Enables lookup of parsed operators, event streams, accessors, etc.\n   * Provides a 'fork' method for creating child contexts for subflows.\n   */\n  function context (df, transforms, functions, expr) {\n    return new Context(df, transforms, functions, expr);\n  }\n  function Context(df, transforms, functions, expr) {\n    this.dataflow = df;\n    this.transforms = transforms;\n    this.events = df.events.bind(df);\n    this.expr = expr || expressionCodegen, this.signals = {};\n    this.scales = {};\n    this.nodes = {};\n    this.data = {};\n    this.fn = {};\n    if (functions) {\n      this.functions = Object.create(functions);\n      this.functions.context = this;\n    }\n  }\n  function Subcontext(ctx) {\n    this.dataflow = ctx.dataflow;\n    this.transforms = ctx.transforms;\n    this.events = ctx.events;\n    this.expr = ctx.expr;\n    this.signals = Object.create(ctx.signals);\n    this.scales = Object.create(ctx.scales);\n    this.nodes = Object.create(ctx.nodes);\n    this.data = Object.create(ctx.data);\n    this.fn = Object.create(ctx.fn);\n    if (ctx.functions) {\n      this.functions = Object.create(ctx.functions);\n      this.functions.context = this;\n    }\n  }\n  Context.prototype = Subcontext.prototype = {\n    fork() {\n      const ctx = new Subcontext(this);\n      (this.subcontext || (this.subcontext = [])).push(ctx);\n      return ctx;\n    },\n    detach(ctx) {\n      this.subcontext = this.subcontext.filter(c => c !== ctx);\n\n      // disconnect all nodes in the subcontext\n      // wipe out targets first for better efficiency\n      const keys = Object.keys(ctx.nodes);\n      for (const key of keys) ctx.nodes[key]._targets = null;\n      for (const key of keys) ctx.nodes[key].detach();\n      ctx.nodes = null;\n    },\n    get(id) {\n      return this.nodes[id];\n    },\n    set(id, node) {\n      return this.nodes[id] = node;\n    },\n    add(spec, op) {\n      const ctx = this,\n        df = ctx.dataflow,\n        data = spec.value;\n      ctx.set(spec.id, op);\n      if (isCollect(spec.type) && data) {\n        if (data.$ingest) {\n          df.ingest(op, data.$ingest, data.$format);\n        } else if (data.$request) {\n          df.preload(op, data.$request, data.$format);\n        } else {\n          df.pulse(op, df.changeset().insert(data));\n        }\n      }\n      if (spec.root) {\n        ctx.root = op;\n      }\n      if (spec.parent) {\n        let p = ctx.get(spec.parent.$ref);\n        if (p) {\n          df.connect(p, [op]);\n          op.targets().add(p);\n        } else {\n          (ctx.unresolved = ctx.unresolved || []).push(() => {\n            p = ctx.get(spec.parent.$ref);\n            df.connect(p, [op]);\n            op.targets().add(p);\n          });\n        }\n      }\n      if (spec.signal) {\n        ctx.signals[spec.signal] = op;\n      }\n      if (spec.scale) {\n        ctx.scales[spec.scale] = op;\n      }\n      if (spec.data) {\n        for (const name in spec.data) {\n          const data = ctx.data[name] || (ctx.data[name] = {});\n          spec.data[name].forEach(role => data[role] = op);\n        }\n      }\n    },\n    resolve() {\n      (this.unresolved || []).forEach(fn => fn());\n      delete this.unresolved;\n      return this;\n    },\n    operator(spec, update) {\n      this.add(spec, this.dataflow.add(spec.value, update));\n    },\n    transform(spec, type) {\n      this.add(spec, this.dataflow.add(this.transforms[canonicalType(type)]));\n    },\n    stream(spec, stream) {\n      this.set(spec.id, stream);\n    },\n    update(spec, stream, target, update, params) {\n      this.dataflow.on(stream, target, update, params, spec.options);\n    },\n    // expression parsing\n    operatorExpression(expr) {\n      return this.expr.operator(this, expr);\n    },\n    parameterExpression(expr) {\n      return this.expr.parameter(this, expr);\n    },\n    eventExpression(expr) {\n      return this.expr.event(this, expr);\n    },\n    handlerExpression(expr) {\n      return this.expr.handler(this, expr);\n    },\n    encodeExpression(encode) {\n      return this.expr.encode(this, encode);\n    },\n    // parse methods\n    parse,\n    parseOperator,\n    parseOperatorParameters,\n    parseParameters,\n    parseStream,\n    parseUpdate,\n    // state methods\n    getState,\n    setState\n  };\n\n  exports.context = context;\n\n}));\n\n};"],
"names":["shadow$provide","require","module","exports","global","factory","define","amd","globalThis","self","vega","vegaUtil","vegaDataflow","expression","ctx","args","code","endsWith","fn","Function","concat","functions","bind","parseParameter","spec","params","isObject","i","n","PARSERS","length","p","hasOwnProperty","key","parse","Context","df","transforms","expr","dataflow","events","expressionCodegen","signals","scales","nodes","data","Object","create","context","Subcontext","Skip","toSet","Swap","operator","parameter","event","handler","encode","marktype","channels","name","o","stringValue","x2","x","xc","y2","y","yc","codegen","get","path","ref","map","join","comparator","fields","orders","t","f","u","v","lt","getOperator","_","$ref","error","getKey","k","$key","$flat","getExpression","$params","parseParameters","$expr","accessor","parameterExpression","$fields","getField","$field","$name","field","getEncode","$encode","enc","encodeExpression","output","$output","getCompare","$compare","$order","c","array","$tupleid","tupleid","compare","getContext","getSubflow","$subflow","parent","subctx","fork","op","operators","id","set","detachSubflow","op.detachSubflow","detach","getTupleId","SKIP","skip","prototype","push","subcontext","filter","keys","_targets","node","add","value","toLowerCase","type","$ingest","ingest","$format","$request","preload","pulse","changeset","insert","root","connect","targets","unresolved","signal","scale","forEach","role","resolve","update","transform","stream","target","on","options","operatorExpression","eventExpression","handlerExpression","background","eventConfig","locale","entry","parseOperator","parseOperatorParameters","streams","parseStream","updates","parseUpdate","parameters","react","initonly","isArray","undefined","source","merge","apply","slice","between","throttle","debounce","JSON","stringify","consume","srcid","getState","state","dataset","input","recurse","setState","remove","truthy","substate"]
}
