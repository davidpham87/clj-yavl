{"version":3,"sources":["clj_yavl/db.cljc"],"mappings":"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yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,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","names":["clj-yavl.db/vega-lite-schema","var_args","G__31175","clj-yavl.db/init-db","js/Error","clj_yavl.db.init_db","schema","datascript.core/create-conn","clj-yavl.db/transact","conn","tx-data","datascript.core/transact!","clj-yavl.db/pull","db","selector","eid","datascript.core/pull","args__5755__auto__","len__5749__auto__","i__5750__auto__","argseq__5756__auto__","cljs.core/IndexedSeq","clj-yavl.db/q","seq31188","G__31190","cljs.core/first","cljs.core/next","G__31193","self__5734__auto__","query","args","cljs.core.apply","datascript.core/q","clj-yavl.db/with","datascript.core/with","clj-yavl.db/remove-nils","m","clojure.walk/postwalk","x","cljs.core/map?","cljs.core.into","cljs.core.remove","cljs.core.comp","cljs.core/nil?","cljs.core/val","clj-yavl.db/spec->tx-data","eid-or-ref","spec","map__31222","cljs.core/--destructure-map","cljs.core.get","mark","encoding","layer","hconcat","vconcat","resolve","title","width","height","background","padding","description","normalized-spec","clojure.walk/keywordize-keys","spec-name","concat-prop","repeat-prop","facet-prop","data-prop","params-prop","transform-prop","composition-tx","child-eids","cljs.core.repeatedly","cljs.core/count","datascript.core.tempid","cljs.core.mapcat","facet-eid","child-eid","G__31223","G__31224","repeat-eid","G__31225","G__31226","mark-tx","mark-eid","encoding-tx","cljs.core/not-empty","encoding-eid","channels","cljs.core/vec","cljs.core.map_indexed","p__31227","vec__31228","cljs.core.nth","i","k","v","cljs.core/name","cljs.core.conj","cljs.core.map","resolve-tx","resolve-eid","params-tx","cljs.core/seq","p","p-eid","transform-tx","t","t-eid","data-tx","data-eid","G__31231","cljs.core.assoc","title-tx","title-eid","cljs.core.merge","cljs.core/select-keys","props-tx","props","p__31232","vec__31233","cljs.core.keyword","cljs.core.concat","clj-yavl.db/config->tx-data","id","config","root-eid","tx","clj-yavl.db/entity->spec","entity","base-spec","cljs.core.reduce","acc","temp__5823__auto__","temp__5825__auto__","G__31236","and__5023__auto__","cljs.core/empty?","cljs.core.dissoc","clojure.walk/stringify-keys","map__31237","type","def","enc","p__31238","map__31239","name","field","G__31240","or__5025__auto__","r","params","ps","cljs.core.mapv","transform","ts","data","d","G__31241","composition","G__31242","G__31243","tt","clj-yavl.db/pull-config","G__31244","G__31245","G__31246"],"sourcesContent":["(ns clj-yavl.db\n  (:require [datascript.core :as d]\n            [clojure.walk :as walk]))\n\n(def vega-lite-schema\n  {;; Top Level\n   :vl/id          {:db/unique :db.unique/identity}\n   :vl/mark        {:db/valueType :db.type/ref}\n   :vl/encoding    {:db/valueType :db.type/ref}\n   :vl/data        {:db/valueType :db.type/ref}\n   :vl/transform   {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/projection  {:db/valueType :db.type/ref}\n   :vl/selection   {:db/valueType :db.type/ref}\n   :vl/config      {:db/valueType :db.type/ref}\n   :vl/resolve     {:db/valueType :db.type/ref}\n   :vl/facet       {:db/valueType :db.type/ref}\n   :vl/repeat      {:db/valueType :db.type/ref}\n   :vl/layer       {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/concat      {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/hconcat     {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/vconcat     {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/spec        {:db/valueType :db.type/ref}\n   :vl/title       {:db/valueType :db.type/ref}\n   :vl/params      {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/tooltip     {} ;; Keep existing scalar/blob behavior for compatibility\n\n   ;; Top Level Properties (Scalar/Blob)\n   :vl/align {} :vl/autosize {} :vl/background {} :vl/bounds {} :vl/center {}\n   :vl/columns {} :vl/datasets {} :vl/description {} :vl/height {} :vl/name {}\n   :vl/padding {} :vl/spacing {} :vl/usermeta {} :vl/view {} :vl/width {}\n\n   ;; Definitions for complex types stored as blobs or specific properties\n   :facet/def      {}\n   :repeat/def     {}\n   :resolve/def    {}\n   :params/def     {}\n   :transform/def  {}\n\n   ;; Title\n   :title/text     {}\n   :title/subtitle {}\n   :title/orient   {}\n   :title/anchor   {}\n   :title/offset   {}\n   :title/frame    {}\n\n   ;; Mark\n   :mark/type      {}\n   :mark/def       {} ;; Keep existing blob behavior\n   :mark/clip      {:db/valueType :db.type/ref} ;; ExprRef or boolean\n   :mark/color     {:db/valueType :db.type/ref} ;; Gradient/Color/ExprRef\n   :mark/fill      {:db/valueType :db.type/ref}\n   :mark/stroke    {:db/valueType :db.type/ref}\n   :mark/tooltip   {:db/valueType :db.type/ref} ;; TooltipContent\n\n   ;; Mark Properties (Scalar/Blob)\n   :mark/align {} :mark/angle {} :mark/aria {} :mark/ariaRole {}\n   :mark/ariaRoleDescription {} :mark/aspect {} :mark/baseline {} :mark/blend {}\n   :mark/cornerRadius {} :mark/cornerRadiusBottomLeft {} :mark/cornerRadiusBottomRight {}\n   :mark/cornerRadiusTopLeft {} :mark/cornerRadiusTopRight {} :mark/cursor {}\n   :mark/description {} :mark/dir {} :mark/dx {} :mark/dy {} :mark/ellipsis {}\n   :mark/endAngle {} :mark/fillOpacity {} :mark/filled {} :mark/font {} :mark/fontSize {}\n   :mark/fontStyle {} :mark/fontWeight {} :mark/height {} :mark/href {} :mark/innerRadius {}\n   :mark/interpolate {} :mark/invalid {} :mark/limit {} :mark/line {} :mark/lineBreak {}\n   :mark/lineHeight {} :mark/opacity {} :mark/order {} :mark/orient {} :mark/outerRadius {}\n   :mark/padAngle {} :mark/point {} :mark/radius {} :mark/radius2 {} :mark/radius2Offset {}\n   :mark/radiusOffset {} :mark/shape {} :mark/size {} :mark/smooth {} :mark/startAngle {}\n   :mark/strokeCap {} :mark/strokeDash {} :mark/strokeDashOffset {} :mark/strokeJoin {}\n   :mark/strokeMiterLimit {} :mark/strokeOffset {} :mark/strokeOpacity {} :mark/strokeWidth {}\n   :mark/style {} :mark/tension {} :mark/text {} :mark/theta {} :mark/theta2 {}\n   :mark/theta2Offset {} :mark/thetaOffset {} :mark/timeUnitBandPosition {}\n   :mark/timeUnitBandSize {} :mark/url {} :mark/width {} :mark/x {} :mark/x2 {}\n   :mark/x2Offset {} :mark/xOffset {} :mark/y {} :mark/y2 {} :mark/y2Offset {} :mark/yOffset {}\n\n   ;; Encoding\n   :encoding/channels {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n\n   ;; Channel\n   :channel/name   {}\n   :channel/field  {}\n   :channel/type   {}\n   :channel/def    {} ;; Keep existing blob behavior\n   :channel/axis   {:db/valueType :db.type/ref}\n   :channel/scale  {:db/valueType :db.type/ref}\n   :channel/legend {:db/valueType :db.type/ref}\n   :channel/bin    {:db/valueType :db.type/ref}\n   :channel/sort   {:db/valueType :db.type/ref}\n   :channel/condition {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :channel/impute {:db/valueType :db.type/ref}\n   :channel/header {:db/valueType :db.type/ref}\n\n   ;; Channel Properties (Scalar/Blob)\n   :channel/aggregate {} :channel/band {} :channel/format {} :channel/formatType {}\n   :channel/stack {} :channel/timeUnit {} :channel/title {} :channel/value {}\n\n   ;; Axis\n   :axis/title     {:db/valueType :db.type/ref} ;; Title object\n   :axis/labelAlign {:db/valueType :db.type/ref} ;; Conditional\n   :axis/labelBaseline {:db/valueType :db.type/ref}\n   :axis/labelColor {:db/valueType :db.type/ref}\n   :axis/labelFont {:db/valueType :db.type/ref}\n   :axis/labelFontSize {:db/valueType :db.type/ref}\n   :axis/labelFontStyle {:db/valueType :db.type/ref}\n   :axis/labelFontWeight {:db/valueType :db.type/ref}\n   :axis/gridColor {:db/valueType :db.type/ref}\n   :axis/gridDash {:db/valueType :db.type/ref}\n   :axis/gridDashOffset {:db/valueType :db.type/ref}\n   :axis/gridOpacity {:db/valueType :db.type/ref}\n   :axis/gridWidth {:db/valueType :db.type/ref}\n   :axis/tickColor {:db/valueType :db.type/ref}\n   :axis/tickDash {:db/valueType :db.type/ref}\n   :axis/tickDashOffset {:db/valueType :db.type/ref}\n   :axis/tickOpacity {:db/valueType :db.type/ref}\n   :axis/tickSize {:db/valueType :db.type/ref}\n   :axis/tickWidth {:db/valueType :db.type/ref}\n\n   ;; Axis Properties (Scalar/Blob)\n   :axis/aria {} :axis/bandPosition {} :axis/description {} :axis/domain {} :axis/domainCap {}\n   :axis/domainColor {} :axis/domainDash {} :axis/domainDashOffset {} :axis/domainOpacity {}\n   :axis/domainWidth {} :axis/format {} :axis/formatType {} :axis/grid {} :axis/gridCap {}\n   :axis/labelAngle {} :axis/labelBound {} :axis/labelExpr {} :axis/labelFlush {}\n   :axis/labelFlushOffset {} :axis/labelLimit {} :axis/labelLineHeight {} :axis/labelOffset {}\n   :axis/labelOpacity {} :axis/labelOverlap {} :axis/labelPadding {} :axis/labelSeparation {}\n   :axis/labels {} :axis/maxExtent {} :axis/minExtent {} :axis/offset {} :axis/orient {}\n   :axis/position {} :axis/style {} :axis/tickBand {} :axis/tickCap {} :axis/tickCount {}\n   :axis/tickExtra {} :axis/tickMinStep {} :axis/tickOffset {} :axis/tickRound {} :axis/ticks {}\n   :axis/titleAlign {} :axis/titleAnchor {} :axis/titleAngle {} :axis/titleBaseline {}\n   :axis/titleColor {} :axis/titleFont {} :axis/titleFontSize {} :axis/titleFontStyle {}\n   :axis/titleFontWeight {} :axis/titleLimit {} :axis/titleLineHeight {} :axis/titleOpacity {}\n   :axis/titlePadding {} :axis/titleX {} :axis/titleY {} :axis/translate {} :axis/values {}\n   :axis/zindex {}\n\n   ;; Scale\n   :scale/domain   {:db/valueType :db.type/ref} ;; ParameterExtent or DomainUnionWith\n   :scale/bins     {:db/valueType :db.type/ref}\n   :scale/interpolate {:db/valueType :db.type/ref}\n   :scale/scheme   {:db/valueType :db.type/ref}\n\n   ;; Scale Properties (Scalar/Blob)\n   :scale/align {} :scale/base {} :scale/clamp {} :scale/constant {} :scale/domainMax {}\n   :scale/domainMid {} :scale/domainMin {} :scale/domainRaw {} :scale/exponent {}\n   :scale/nice {} :scale/padding {} :scale/paddingInner {} :scale/paddingOuter {}\n   :scale/range {} :scale/rangeMax {} :scale/rangeMin {} :scale/reverse {} :scale/round {}\n   :scale/type {} :scale/zero {}\n\n   ;; Legend\n   :legend/title   {:db/valueType :db.type/ref}\n   :legend/tickCount {:db/valueType :db.type/ref}\n\n   ;; Legend Properties (Scalar/Blob)\n   :legend/aria {} :legend/clipHeight {} :legend/columnPadding {} :legend/columns {}\n   :legend/cornerRadius {} :legend/description {} :legend/direction {} :legend/fillColor {}\n   :legend/format {} :legend/formatType {} :legend/gradientLength {} :legend/gradientOpacity {}\n   :legend/gradientStrokeColor {} :legend/gradientStrokeWidth {} :legend/gradientThickness {}\n   :legend/gridAlign {} :legend/labelAlign {} :legend/labelBaseline {} :legend/labelColor {}\n   :legend/labelExpr {} :legend/labelFont {} :legend/labelFontSize {} :legend/labelFontStyle {}\n   :legend/labelFontWeight {} :legend/labelLimit {} :legend/labelOffset {} :legend/labelOpacity {}\n   :legend/labelOverlap {} :legend/labelPadding {} :legend/labelSeparation {} :legend/legendX {}\n   :legend/legendY {} :legend/offset {} :legend/orient {} :legend/padding {} :legend/rowPadding {}\n   :legend/strokeColor {} :legend/symbolDash {} :legend/symbolDashOffset {}\n   :legend/symbolFillColor {} :legend/symbolLimit {} :legend/symbolOffset {}\n   :legend/symbolOpacity {} :legend/symbolSize {} :legend/symbolStrokeColor {}\n   :legend/symbolStrokeWidth {} :legend/symbolType {} :legend/tickMinStep {}\n   :legend/titleAlign {} :legend/titleAnchor {} :legend/titleBaseline {} :legend/titleColor {}\n   :legend/titleFont {} :legend/titleFontSize {} :legend/titleFontStyle {}\n   :legend/titleFontWeight {} :legend/titleLimit {} :legend/titleLineHeight {}\n   :legend/titleOpacity {} :legend/titleOrient {} :legend/titlePadding {} :legend/type {}\n   :legend/values {} :legend/zindex {}\n\n   ;; Data\n   :data/format    {:db/valueType :db.type/ref}\n   :data/format-blob {} ;; Blob for format definition\n   :data/values    {} ;; Blob\n   :data/url       {}\n   :data/name      {}\n   :data/generator {}\n\n   ;; Transform (Common Container Props)\n   :transform/aggregate    {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :transform/bin          {:db/valueType :db.type/ref}\n   :transform/calculate    {}\n   :transform/filter       {:db/valueType :db.type/ref} ;; PredicateComposition\n   :transform/flatten      {}\n   :transform/fold         {}\n   :transform/impute       {:db/valueType :db.type/ref}\n   :transform/joinaggregate {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :transform/loess        {:db/valueType :db.type/ref}\n   :transform/lookup       {}\n   :transform/pivot        {}\n   :transform/quantile     {:db/valueType :db.type/ref}\n   :transform/regression   {:db/valueType :db.type/ref}\n   :transform/sample       {:db/valueType :db.type/ref}\n   :transform/stack        {:db/valueType :db.type/ref}\n   :transform/timeUnit     {:db/valueType :db.type/ref}\n   :transform/window       {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :transform/as           {}\n   :transform/groupby      {}\n   :transform/on           {}\n   })\n\n(defn init-db\n  ([] (init-db vega-lite-schema))\n  ([schema] (d/create-conn schema)))\n\n(defn transact [conn tx-data]\n  (d/transact! conn tx-data))\n\n(defn pull [db selector eid]\n  (d/pull db selector eid))\n\n(defn q [query db & args]\n  (apply d/q query db args))\n\n(defn with [db tx-data]\n  (d/with db tx-data))\n\n(defn- remove-nils [m]\n  (walk/postwalk\n   (fn [x]\n     (if (map? x)\n       (into {} (remove (comp nil? val)) x)\n       x))\n   m))\n\n(defn- spec->tx-data\n  \"Recursively converts a spec map into transaction data.\n   eid-or-ref: the entity ID or lookup ref for this spec.\"\n  [eid-or-ref spec]\n  (let [{:keys [mark encoding layer hconcat vconcat resolve title\n                width height background padding description] :as normalized-spec} (walk/keywordize-keys spec)\n        ;; Retrieve properties explicitly to avoid shadowing clojure.core functions\n        spec-name (:name normalized-spec)\n        concat-prop (:concat normalized-spec)\n        repeat-prop (:repeat normalized-spec)\n        facet-prop (:facet normalized-spec) ;; Not shadowing, but consistent style\n        data-prop (:data normalized-spec)\n        params-prop (:params normalized-spec)\n        transform-prop (:transform normalized-spec)\n\n        ;; Composition\n        composition-tx\n        (cond\n          layer\n          (let [child-eids (repeatedly (count layer) #(d/tempid :db.part/user))]\n            (into [{:db/id eid-or-ref :vl/layer child-eids}]\n                  (mapcat spec->tx-data child-eids layer)))\n\n          hconcat\n          (let [child-eids (repeatedly (count hconcat) #(d/tempid :db.part/user))]\n            (into [{:db/id eid-or-ref :vl/hconcat child-eids}]\n                  (mapcat spec->tx-data child-eids hconcat)))\n\n          vconcat\n          (let [child-eids (repeatedly (count vconcat) #(d/tempid :db.part/user))]\n            (into [{:db/id eid-or-ref :vl/vconcat child-eids}]\n                  (mapcat spec->tx-data child-eids vconcat)))\n\n          concat-prop\n          (let [child-eids (repeatedly (count concat-prop) #(d/tempid :db.part/user))]\n            (into [{:db/id eid-or-ref :vl/concat child-eids}]\n                  (mapcat spec->tx-data child-eids concat-prop)))\n\n          facet-prop\n          (let [facet-eid (d/tempid :db.part/user)\n                child-eid (d/tempid :db.part/user)]\n            (into [{:db/id eid-or-ref\n                    :vl/facet facet-eid\n                    :vl/spec child-eid}\n                   {:db/id facet-eid :facet/def facet-prop}]\n                  (spec->tx-data child-eid (:spec spec))))\n\n          repeat-prop\n          (let [repeat-eid (d/tempid :db.part/user)\n                child-eid (d/tempid :db.part/user)]\n            (into [{:db/id eid-or-ref\n                    :vl/repeat repeat-eid\n                    :vl/spec child-eid}\n                   {:db/id repeat-eid :repeat/def repeat-prop}]\n                  (spec->tx-data child-eid (:spec spec)))))\n\n        ;; Mark\n        mark-tx\n        (when mark\n          (let [mark-eid (d/tempid :db.part/user)]\n            [{:db/id eid-or-ref :vl/mark mark-eid}\n             {:db/id mark-eid\n              :mark/type (if (map? mark) (:type mark) mark)\n              :mark/def (when (map? mark) mark)}]))\n\n        ;; Encoding\n        encoding-tx\n        (when (not-empty encoding)\n          (let [encoding-eid (d/tempid :db.part/user)\n                channels (vec (map-indexed\n                               (fn [i [k v]]\n                                 {:db/id (d/tempid :db.part/user)\n                                  :channel/name (name k)\n                                  :channel/field (:field v)\n                                  :channel/type (:type v)\n                                  :channel/def v})\n                               encoding))]\n            (conj channels\n                  {:db/id encoding-eid\n                   :encoding/channels (map :db/id channels)}\n                  {:db/id eid-or-ref :vl/encoding encoding-eid})))\n\n        ;; Resolve\n        resolve-tx\n        (when resolve\n          (let [resolve-eid (d/tempid :db.part/user)]\n            [{:db/id eid-or-ref :vl/resolve resolve-eid}\n             {:db/id resolve-eid :resolve/def resolve}]))\n\n        ;; Params\n        params-tx\n        (when (seq params-prop)\n          (mapcat (fn [p]\n                    (let [p-eid (d/tempid :db.part/user)]\n                      [{:db/id eid-or-ref :vl/params p-eid}\n                       {:db/id p-eid :params/def p}]))\n                  params-prop))\n\n        ;; Transform\n        transform-tx\n        (when (seq transform-prop)\n          (mapcat (fn [t]\n                    (let [t-eid (d/tempid :db.part/user)]\n                      [{:db/id eid-or-ref :vl/transform t-eid}\n                       {:db/id t-eid :transform/def t}]))\n                  transform-prop))\n\n        ;; Data\n        data-tx\n        (when data-prop\n          (let [data-eid (d/tempid :db.part/user)]\n            [{:db/id eid-or-ref :vl/data data-eid}\n             (cond-> {:db/id data-eid}\n               (:values data-prop) (assoc :data/values (:values data-prop))\n               (:url data-prop) (assoc :data/url (:url data-prop))\n               (:name data-prop) (assoc :data/name (:name data-prop))\n               (:format data-prop) (assoc :data/format-blob (:format data-prop))\n               (:generator data-prop) (assoc :data/generator (:generator data-prop)))]))\n\n        ;; Title\n        title-tx\n        (when title\n          (let [title-eid (d/tempid :db.part/user)]\n            (if (map? title)\n              [{:db/id eid-or-ref :vl/title title-eid}\n               (merge {:db/id title-eid}\n                      (select-keys title [:text :subtitle :orient :anchor :offset :frame]))]\n              [{:db/id eid-or-ref :vl/title title-eid}\n               {:db/id title-eid :title/text title}])))\n\n        ;; Top Level Props\n        props-tx\n        (let [props (select-keys normalized-spec [:width :height :background :padding :description :name])]\n          (when (seq props)\n            (map (fn [[k v]]\n                   {:db/id eid-or-ref (keyword \"vl\" (name k)) v})\n                 props)))]\n\n    (concat\n     ;; Base entity creation (needed if it's not the top level existing ref)\n     ;; For nested specs, eid-or-ref is a tempid, so we just use it in other datoms.\n     ;; But if it's the root spec, it's passed as [:vl/id id], which exists.\n\n     composition-tx\n     mark-tx\n     encoding-tx\n     resolve-tx\n     params-tx\n     transform-tx\n     data-tx\n     title-tx\n     props-tx)))\n\n(defn config->tx-data\n  \"Converts a Vega-Lite config map to transaction data.\n   'id' identifies the top-level config entity.\"\n  [id config]\n  (let [root-eid (d/tempid :db.part/user)\n        tx (spec->tx-data root-eid (assoc config :id id))]\n    (conj (vec (remove-nils tx))\n          {:db/id root-eid :vl/id id}))) ;; Ensure root exists and binds to tempid\n\n(defn- entity->spec\n  \"Recursively converts an entity to a spec map.\"\n  [entity]\n  (when entity\n    (let [;; Top Level Props\n          base-spec (reduce (fn [acc k]\n                              (if-let [v (get entity (keyword \"vl\" (name k)))]\n                                (assoc acc (name k) v)\n                                acc))\n                            {}\n                            [:width :height :background :padding :description :name])\n\n          ;; Title\n          title (when-let [t (:vl/title entity)]\n                  (if (:title/text t)\n                     (cond-> {\"text\" (:title/text t)}\n                       (:title/subtitle t) (assoc \"subtitle\" (:title/subtitle t))\n                       (:title/orient t) (assoc \"orient\" (:title/orient t))\n                       (:title/anchor t) (assoc \"anchor\" (:title/anchor t))\n                       (:title/offset t) (assoc \"offset\" (:title/offset t))\n                       (:title/frame t) (assoc \"frame\" (:title/frame t)))\n                     (if (and (:title/text t) (empty? (dissoc t :db/id :title/text)))\n                       (:title/text t)\n                       (walk/stringify-keys (dissoc t :db/id)))))\n\n          ;; Mark\n          mark (when-let [m (:vl/mark entity)]\n                 (let [{:keys [mark/type mark/def]} m]\n                   (if def\n                     (assoc (walk/stringify-keys def) \"type\" type)\n                     type)))\n\n          ;; Encoding\n          encoding (when-let [enc (:vl/encoding entity)]\n                     (into {} (map (fn [{:keys [channel/name channel/def channel/field channel/type]}]\n                                     [name (cond-> (walk/stringify-keys (or def {}))\n                                             field (assoc \"field\" field)\n                                             type (assoc \"type\" type))])\n                                   (:encoding/channels enc))))\n\n          ;; Resolve\n          resolve (when-let [r (:vl/resolve entity)]\n                    (walk/stringify-keys (:resolve/def r)))\n\n          ;; Params\n          params (when-let [ps (:vl/params entity)]\n                   (mapv (comp walk/stringify-keys :params/def) ps))\n\n          ;; Transform\n          transform (when-let [ts (:vl/transform entity)]\n                      (mapv (comp walk/stringify-keys :transform/def) ts))\n\n          ;; Data\n          data (when-let [d (:vl/data entity)]\n                 (cond-> {}\n                   (:data/values d) (assoc \"values\" (:data/values d))\n                   (:data/url d) (assoc \"url\" (:data/url d))\n                   (:data/name d) (assoc \"name\" (:data/name d))\n                   (:data/format-blob d) (assoc \"format\" (walk/stringify-keys (:data/format-blob d)))\n                   (:data/generator d) (assoc \"generator\" (:data/generator d))))\n\n          ;; Layers/Composition\n          composition\n          (cond\n            (:vl/layer entity)\n            {\"layer\" (mapv entity->spec (:vl/layer entity))}\n\n            (:vl/hconcat entity)\n            {\"hconcat\" (mapv entity->spec (:vl/hconcat entity))}\n\n            (:vl/vconcat entity)\n            {\"vconcat\" (mapv entity->spec (:vl/vconcat entity))}\n\n            (:vl/concat entity)\n            {\"concat\" (mapv entity->spec (:vl/concat entity))}\n\n            (:vl/facet entity)\n            {\"facet\" (walk/stringify-keys (:facet/def (:vl/facet entity)))\n             \"spec\" (entity->spec (:vl/spec entity))}\n\n            (:vl/repeat entity)\n            {\"repeat\" (if (map? (:repeat/def (:vl/repeat entity)))\n                        (walk/stringify-keys (:repeat/def (:vl/repeat entity)))\n                        (:repeat/def (:vl/repeat entity)))\n             \"spec\" (entity->spec (:vl/spec entity))})\n\n          spec (merge base-spec\n                      composition\n                      (when (not-empty data) {\"data\" data})\n                      (when (seq params) {\"params\" params})\n                      (when (seq transform) {\"transform\" transform})\n                      (when title {\"title\" title})\n                      (when mark {\"mark\" mark})\n                      (when encoding {\"encoding\" encoding})\n                      (when resolve {\"resolve\" resolve})\n                      (when-let [tt (:vl/tooltip entity)] {\"tooltip\" tt}))]\n\n      spec)))\n\n(defn pull-config\n  \"Reconstructs the Vega-Lite config map from the DB.\"\n  [db id]\n  (let [selector '[*\n                   {:vl/mark [*]}\n                   {:vl/mark [*]}\n                   {:vl/encoding [{:encoding/channels [*]}]}\n                   {:vl/resolve [*]}\n                   {:vl/data [*]}\n                   {:vl/params [*]}\n                   {:vl/transform [*]}\n                   {:vl/facet [*]}\n                   {:vl/repeat [*]}\n                   {:vl/title [*]}\n                   {:vl/spec ...} ;; Recursive\n                   {:vl/layer ...}\n                   {:vl/hconcat ...}\n                   {:vl/vconcat ...}\n                   {:vl/concat ...}]]\n    (let [entity (d/pull db selector [:vl/id id])]\n      (entity->spec entity))))\n"]}