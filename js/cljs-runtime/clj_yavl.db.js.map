{"version":3,"sources":["clj_yavl/db.cljc"],"mappings":"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yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,2CAAA,kEAAA,yEAAA,mCAAA,2CAAA,kEAAA,iEAAA,sEAAA,uFAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,2CAAA,kEAAA,yEAAA,mCAAA,mCAAA,mCAAA,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","names":["clj-yavl.db/vega-lite-schema","var_args","G__31133","clj-yavl.db/init-db","js/Error","clj_yavl.db.init_db","schema","datascript.core/create-conn","clj-yavl.db/transact","conn","tx-data","datascript.core/transact!","clj-yavl.db/pull","db","selector","eid","datascript.core/pull","args__5755__auto__","len__5749__auto__","i__5750__auto__","argseq__5756__auto__","cljs.core/IndexedSeq","clj-yavl.db/q","seq31135","G__31136","cljs.core/first","cljs.core/next","G__31137","self__5734__auto__","query","args","cljs.core.apply","datascript.core/q","clj-yavl.db/remove-nils","m","clojure.walk/postwalk","x","cljs.core/map?","cljs.core.into","cljs.core.remove","cljs.core.comp","cljs.core/nil?","cljs.core/val","clj-yavl.db/config->tx-data","id","config","mark","cljs.core.get","encoding","tooltip","mark-eid","encoding-eid","tx","G__31165","cljs.core.conj","channels","cljs.core/vec","cljs.core.map_indexed","p__31166","vec__31167","cljs.core.nth","i","k","v","cljs.core/name","cljs.core.map","clj-yavl.db/pull-config","entity","G__31171","G__31172","G__31173","G__31174","cljs.core.assoc","map__31175","cljs.core/--destructure-map","type","def","p__31176","map__31177","name","field","G__31178","or__5025__auto__","cljs.core.get_in"],"sourcesContent":["(ns clj-yavl.db\n  (:require [datascript.core :as d]\n            [clojure.walk :as walk]))\n\n(def vega-lite-schema\n  {;; Top Level\n   :vl/id          {:db/unique :db.unique/identity}\n   :vl/mark        {:db/valueType :db.type/ref}\n   :vl/encoding    {:db/valueType :db.type/ref}\n   :vl/data        {:db/valueType :db.type/ref}\n   :vl/transform   {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/projection  {:db/valueType :db.type/ref}\n   :vl/selection   {:db/valueType :db.type/ref}\n   :vl/config      {:db/valueType :db.type/ref}\n   :vl/resolve     {:db/valueType :db.type/ref}\n   :vl/facet       {:db/valueType :db.type/ref}\n   :vl/repeat      {:db/valueType :db.type/ref}\n   :vl/layer       {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/concat      {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/hconcat     {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/vconcat     {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/spec        {:db/valueType :db.type/ref}\n   :vl/title       {:db/valueType :db.type/ref}\n   :vl/params      {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :vl/tooltip     {} ;; Keep existing scalar/blob behavior for compatibility\n\n   ;; Top Level Properties (Scalar/Blob)\n   :vl/align {} :vl/autosize {} :vl/background {} :vl/bounds {} :vl/center {}\n   :vl/columns {} :vl/datasets {} :vl/description {} :vl/height {} :vl/name {}\n   :vl/padding {} :vl/spacing {} :vl/usermeta {} :vl/view {} :vl/width {}\n\n   ;; Mark\n   :mark/type      {}\n   :mark/def       {} ;; Keep existing blob behavior\n   :mark/clip      {:db/valueType :db.type/ref} ;; ExprRef or boolean\n   :mark/color     {:db/valueType :db.type/ref} ;; Gradient/Color/ExprRef\n   :mark/fill      {:db/valueType :db.type/ref}\n   :mark/stroke    {:db/valueType :db.type/ref}\n   :mark/tooltip   {:db/valueType :db.type/ref} ;; TooltipContent\n\n   ;; Mark Properties (Scalar/Blob)\n   :mark/align {} :mark/angle {} :mark/aria {} :mark/ariaRole {}\n   :mark/ariaRoleDescription {} :mark/aspect {} :mark/baseline {} :mark/blend {}\n   :mark/cornerRadius {} :mark/cornerRadiusBottomLeft {} :mark/cornerRadiusBottomRight {}\n   :mark/cornerRadiusTopLeft {} :mark/cornerRadiusTopRight {} :mark/cursor {}\n   :mark/description {} :mark/dir {} :mark/dx {} :mark/dy {} :mark/ellipsis {}\n   :mark/endAngle {} :mark/fillOpacity {} :mark/filled {} :mark/font {} :mark/fontSize {}\n   :mark/fontStyle {} :mark/fontWeight {} :mark/height {} :mark/href {} :mark/innerRadius {}\n   :mark/interpolate {} :mark/invalid {} :mark/limit {} :mark/line {} :mark/lineBreak {}\n   :mark/lineHeight {} :mark/opacity {} :mark/order {} :mark/orient {} :mark/outerRadius {}\n   :mark/padAngle {} :mark/point {} :mark/radius {} :mark/radius2 {} :mark/radius2Offset {}\n   :mark/radiusOffset {} :mark/shape {} :mark/size {} :mark/smooth {} :mark/startAngle {}\n   :mark/strokeCap {} :mark/strokeDash {} :mark/strokeDashOffset {} :mark/strokeJoin {}\n   :mark/strokeMiterLimit {} :mark/strokeOffset {} :mark/strokeOpacity {} :mark/strokeWidth {}\n   :mark/style {} :mark/tension {} :mark/text {} :mark/theta {} :mark/theta2 {}\n   :mark/theta2Offset {} :mark/thetaOffset {} :mark/timeUnitBandPosition {}\n   :mark/timeUnitBandSize {} :mark/url {} :mark/width {} :mark/x {} :mark/x2 {}\n   :mark/x2Offset {} :mark/xOffset {} :mark/y {} :mark/y2 {} :mark/y2Offset {} :mark/yOffset {}\n\n   ;; Encoding\n   :encoding/channels {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n\n   ;; Channel\n   :channel/name   {}\n   :channel/field  {}\n   :channel/type   {}\n   :channel/def    {} ;; Keep existing blob behavior\n   :channel/axis   {:db/valueType :db.type/ref}\n   :channel/scale  {:db/valueType :db.type/ref}\n   :channel/legend {:db/valueType :db.type/ref}\n   :channel/bin    {:db/valueType :db.type/ref}\n   :channel/sort   {:db/valueType :db.type/ref}\n   :channel/condition {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :channel/impute {:db/valueType :db.type/ref}\n   :channel/header {:db/valueType :db.type/ref}\n\n   ;; Channel Properties (Scalar/Blob)\n   :channel/aggregate {} :channel/band {} :channel/format {} :channel/formatType {}\n   :channel/stack {} :channel/timeUnit {} :channel/title {} :channel/value {}\n\n   ;; Axis\n   :axis/title     {:db/valueType :db.type/ref} ;; Title object\n   :axis/labelAlign {:db/valueType :db.type/ref} ;; Conditional\n   :axis/labelBaseline {:db/valueType :db.type/ref}\n   :axis/labelColor {:db/valueType :db.type/ref}\n   :axis/labelFont {:db/valueType :db.type/ref}\n   :axis/labelFontSize {:db/valueType :db.type/ref}\n   :axis/labelFontStyle {:db/valueType :db.type/ref}\n   :axis/labelFontWeight {:db/valueType :db.type/ref}\n   :axis/gridColor {:db/valueType :db.type/ref}\n   :axis/gridDash {:db/valueType :db.type/ref}\n   :axis/gridDashOffset {:db/valueType :db.type/ref}\n   :axis/gridOpacity {:db/valueType :db.type/ref}\n   :axis/gridWidth {:db/valueType :db.type/ref}\n   :axis/tickColor {:db/valueType :db.type/ref}\n   :axis/tickDash {:db/valueType :db.type/ref}\n   :axis/tickDashOffset {:db/valueType :db.type/ref}\n   :axis/tickOpacity {:db/valueType :db.type/ref}\n   :axis/tickSize {:db/valueType :db.type/ref}\n   :axis/tickWidth {:db/valueType :db.type/ref}\n\n   ;; Axis Properties (Scalar/Blob)\n   :axis/aria {} :axis/bandPosition {} :axis/description {} :axis/domain {} :axis/domainCap {}\n   :axis/domainColor {} :axis/domainDash {} :axis/domainDashOffset {} :axis/domainOpacity {}\n   :axis/domainWidth {} :axis/format {} :axis/formatType {} :axis/grid {} :axis/gridCap {}\n   :axis/labelAngle {} :axis/labelBound {} :axis/labelExpr {} :axis/labelFlush {}\n   :axis/labelFlushOffset {} :axis/labelLimit {} :axis/labelLineHeight {} :axis/labelOffset {}\n   :axis/labelOpacity {} :axis/labelOverlap {} :axis/labelPadding {} :axis/labelSeparation {}\n   :axis/labels {} :axis/maxExtent {} :axis/minExtent {} :axis/offset {} :axis/orient {}\n   :axis/position {} :axis/style {} :axis/tickBand {} :axis/tickCap {} :axis/tickCount {}\n   :axis/tickExtra {} :axis/tickMinStep {} :axis/tickOffset {} :axis/tickRound {} :axis/ticks {}\n   :axis/titleAlign {} :axis/titleAnchor {} :axis/titleAngle {} :axis/titleBaseline {}\n   :axis/titleColor {} :axis/titleFont {} :axis/titleFontSize {} :axis/titleFontStyle {}\n   :axis/titleFontWeight {} :axis/titleLimit {} :axis/titleLineHeight {} :axis/titleOpacity {}\n   :axis/titlePadding {} :axis/titleX {} :axis/titleY {} :axis/translate {} :axis/values {}\n   :axis/zindex {}\n\n   ;; Scale\n   :scale/domain   {:db/valueType :db.type/ref} ;; ParameterExtent or DomainUnionWith\n   :scale/bins     {:db/valueType :db.type/ref}\n   :scale/interpolate {:db/valueType :db.type/ref}\n   :scale/scheme   {:db/valueType :db.type/ref}\n\n   ;; Scale Properties (Scalar/Blob)\n   :scale/align {} :scale/base {} :scale/clamp {} :scale/constant {} :scale/domainMax {}\n   :scale/domainMid {} :scale/domainMin {} :scale/domainRaw {} :scale/exponent {}\n   :scale/nice {} :scale/padding {} :scale/paddingInner {} :scale/paddingOuter {}\n   :scale/range {} :scale/rangeMax {} :scale/rangeMin {} :scale/reverse {} :scale/round {}\n   :scale/type {} :scale/zero {}\n\n   ;; Legend\n   :legend/title   {:db/valueType :db.type/ref}\n   :legend/tickCount {:db/valueType :db.type/ref}\n\n   ;; Legend Properties (Scalar/Blob)\n   :legend/aria {} :legend/clipHeight {} :legend/columnPadding {} :legend/columns {}\n   :legend/cornerRadius {} :legend/description {} :legend/direction {} :legend/fillColor {}\n   :legend/format {} :legend/formatType {} :legend/gradientLength {} :legend/gradientOpacity {}\n   :legend/gradientStrokeColor {} :legend/gradientStrokeWidth {} :legend/gradientThickness {}\n   :legend/gridAlign {} :legend/labelAlign {} :legend/labelBaseline {} :legend/labelColor {}\n   :legend/labelExpr {} :legend/labelFont {} :legend/labelFontSize {} :legend/labelFontStyle {}\n   :legend/labelFontWeight {} :legend/labelLimit {} :legend/labelOffset {} :legend/labelOpacity {}\n   :legend/labelOverlap {} :legend/labelPadding {} :legend/labelSeparation {} :legend/legendX {}\n   :legend/legendY {} :legend/offset {} :legend/orient {} :legend/padding {} :legend/rowPadding {}\n   :legend/strokeColor {} :legend/symbolDash {} :legend/symbolDashOffset {}\n   :legend/symbolFillColor {} :legend/symbolLimit {} :legend/symbolOffset {}\n   :legend/symbolOpacity {} :legend/symbolSize {} :legend/symbolStrokeColor {}\n   :legend/symbolStrokeWidth {} :legend/symbolType {} :legend/tickMinStep {}\n   :legend/titleAlign {} :legend/titleAnchor {} :legend/titleBaseline {} :legend/titleColor {}\n   :legend/titleFont {} :legend/titleFontSize {} :legend/titleFontStyle {}\n   :legend/titleFontWeight {} :legend/titleLimit {} :legend/titleLineHeight {}\n   :legend/titleOpacity {} :legend/titleOrient {} :legend/titlePadding {} :legend/type {}\n   :legend/values {} :legend/zindex {}\n\n   ;; Data\n   :data/format    {:db/valueType :db.type/ref}\n   :data/values    {} ;; Blob\n   :data/url       {}\n   :data/name      {}\n   :data/generator {}\n\n   ;; Transform (Common Container Props)\n   :transform/aggregate    {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :transform/bin          {:db/valueType :db.type/ref}\n   :transform/calculate    {}\n   :transform/filter       {:db/valueType :db.type/ref} ;; PredicateComposition\n   :transform/flatten      {}\n   :transform/fold         {}\n   :transform/impute       {:db/valueType :db.type/ref}\n   :transform/joinaggregate {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :transform/loess        {:db/valueType :db.type/ref}\n   :transform/lookup       {}\n   :transform/pivot        {}\n   :transform/quantile     {:db/valueType :db.type/ref}\n   :transform/regression   {:db/valueType :db.type/ref}\n   :transform/sample       {:db/valueType :db.type/ref}\n   :transform/stack        {:db/valueType :db.type/ref}\n   :transform/timeUnit     {:db/valueType :db.type/ref}\n   :transform/window       {:db/valueType :db.type/ref :db/cardinality :db.cardinality/many}\n   :transform/as           {}\n   :transform/groupby      {}\n   :transform/on           {}\n   })\n\n(defn init-db\n  ([] (init-db vega-lite-schema))\n  ([schema] (d/create-conn schema)))\n\n(defn transact [conn tx-data]\n  (d/transact! conn tx-data))\n\n(defn pull [db selector eid]\n  (d/pull db selector eid))\n\n(defn q [query db & args]\n  (apply d/q query db args))\n\n(defn- remove-nils [m]\n  (walk/postwalk\n   (fn [x]\n     (if (map? x)\n       (into {} (remove (comp nil? val)) x)\n       x))\n   m))\n\n(defn config->tx-data\n  \"Converts a Vega-Lite config map to transaction data.\n   'id' identifies the top-level config entity.\"\n  [id config]\n  (let [mark (get config \"mark\" (get config :mark))\n        encoding (get config \"encoding\" (get config :encoding))\n        tooltip (get config \"tooltip\" (get config :tooltip))\n\n        mark-eid -2\n        encoding-eid -3\n\n        tx (cond-> [{:vl/id id\n                     :vl/tooltip tooltip}]\n             ;; Mark\n             mark\n             (conj {:db/id mark-eid\n                    :mark/type (if (map? mark) (get mark \"type\" (get mark :type)) mark)\n                    :mark/def (when (map? mark) mark)})\n             mark\n             (conj {:db/id [:vl/id id] :vl/mark mark-eid})\n\n             ;; Encoding\n             encoding\n             (into (let [channels (vec (map-indexed\n                                        (fn [i [k v]]\n                                          {:db/id (- -10 i)\n                                           :channel/name (name k)\n                                           :channel/field (get v \"field\" (get v :field))\n                                           :channel/type (get v \"type\" (get v :type))\n                                           :channel/def v})\n                                        encoding))]\n                     (conj channels\n                           {:db/id encoding-eid\n                            :encoding/channels (map :db/id channels)}\n                           {:db/id [:vl/id id] :vl/encoding encoding-eid}))))]\n    (remove-nils tx)))\n\n(defn pull-config\n  \"Reconstructs the Vega-Lite config map from the DB.\"\n  [db id]\n  (let [entity (d/pull db\n                       [:vl/tooltip\n                        {:vl/mark [:mark/type :mark/def]}\n                        {:vl/encoding [{:encoding/channels [:channel/name :channel/field :channel/type :channel/def]}]}]\n                       [:vl/id id])]\n    (when entity\n      (cond-> {}\n        (:vl/mark entity)\n        (assoc \"mark\" (let [{:keys [mark/type mark/def]} (:vl/mark entity)]\n                        (if def\n                          (assoc def \"type\" type)\n                          type)))\n\n        (:vl/encoding entity)\n        (assoc \"encoding\" (into {} (map (fn [{:keys [channel/name channel/def channel/field channel/type]}]\n                                          [name (cond-> (or def {})\n                                                  field (assoc \"field\" field)\n                                                  type (assoc \"type\" type))])\n                                        (get-in entity [:vl/encoding :encoding/channels]))))\n\n        (:vl/tooltip entity)\n        (assoc \"tooltip\" (:vl/tooltip entity))))))\n"]}