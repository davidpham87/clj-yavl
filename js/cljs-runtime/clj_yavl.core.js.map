{"version":3,"sources":["clj_yavl/core.cljs"],"mappings":"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","names":["re_frame.core.reg_event_db","clj-yavl.events/initialize-db","clj-yavl.events/set-config-input","clj-yavl.events/set-config-mode","clj-yavl.events/set-top-level-prop","clj-yavl.events/update-mark","clj-yavl.events/update-channel-field","clj-yavl.events/update-tooltip","clj-yavl.events/init-unit-spec","clj-yavl.events/remove-unit-spec","clj-yavl.events/update-unit-spec-input","clj-yavl.events/set-unit-spec-input","re_frame.core.reg_sub","clj-yavl.subs/unit-spec-ids","clj-yavl.subs/unit-spec","clj-yavl.subs/all-unit-specs","p__31298","vec__31299","cljs.core.nth","_","id","re_frame.core.subscribe","clj-yavl.subs/compiled-unit-spec-fn","clj-yavl.subs/user-input-root","clj-yavl.subs/config-input","clj-yavl.subs/config-mode","clj-yavl.subs/parsed-config","clj-yavl.subs/top-level-prop","clj-yavl.subs/ds-db","clj-yavl.subs/mark","clj-yavl.subs/encoding","clj-yavl.subs/tooltip","p__31302","vec__31303","input","mode","e31306","G__31307","cljs.core/Keyword","cljs.core.get","edn/read-string","cljs.core.js__GT_clj","js/JSON.parse","js/Error","p__31308","vec__31309","db","new-transform","user-input","cljs.core.get_in","new-input","e31312","G__31313","data","updated","cljs.core.assoc","sb__5670__auto__","goog.string/StringBuffer","*print-newline*-orig-val__31314","cljs.core/*print-newline*","*print-fn*-orig-val__31315","cljs.core/*print-fn*","*print-newline*-temp-val__31316","*print-fn*-temp-val__31317","x__5671__auto__","clj-yavl.core/pprint","js/JSON.stringify","cljs.core/clj->js","cljs.core/assoc-in","p__31318","vec__31319","op","cljs.core.update_in","cljs.core/conj","p__31322","vec__31323","index","path","ops","vec__31326","before","after","cljs.core/split-at","cljs.core/vec","cljs.core.concat","cljs.core/rest","p__31329","vec__31330","new-op","p__31333","vec__31334","from-index","to-index","item","removed","cljs.core.subvec","p__31337","vec__31338","clj-yavl.core/main-view","cljs.core/deref","p1__31341#","p1__31342#","config-input","parsed-config","config-mode","url-input","cljs.core._EQ_","re-frame.core/dispatch","bb-web-ds-tools.components.editor/monaco-editor","clj-yavl.viz/vega-lite-viz","js/clj-yavl","js/clj-yavl.core","js/clj-yavl.core.react-root","clj-yavl.core/react-root","reagent.dom.client.create_root","js/document","clj-yavl.core/run","reagent.dom.client.render","clj-yavl.core/init","re-frame.core/dispatch-sync"],"sourcesContent":["(ns clj-yavl.core\n  (:require [reagent.dom.client :as rdomc]\n            [re-frame.core :as rf]\n            [bb-web-ds-tools.components.editor :as editor]\n            [clj-yavl.events :as events]\n            [clj-yavl.subs :as subs]\n            [clj-yavl.viz :as viz]))\n\n;; --- State ---\n\n(rf/reg-event-db ::initialize events/initialize-db)\n(rf/reg-event-db ::set-config-input events/set-config-input)\n(rf/reg-event-db ::set-config-mode events/set-config-mode)\n(rf/reg-event-db ::set-top-level-prop events/set-top-level-prop)\n\n;; New DS Events\n(rf/reg-event-db ::update-mark events/update-mark)\n(rf/reg-event-db ::update-channel-field events/update-channel-field)\n(rf/reg-event-db ::update-tooltip events/update-tooltip)\n\n\n;; --- Unit Specs Events & Subs ---\n\n(rf/reg-event-db ::init-unit-spec events/init-unit-spec)\n(rf/reg-event-db ::remove-unit-spec events/remove-unit-spec)\n(rf/reg-event-db ::update-unit-spec-input events/update-unit-spec-input)\n(rf/reg-event-db ::set-unit-spec-input events/set-unit-spec-input)\n\n(rf/reg-sub ::unit-spec-ids subs/unit-spec-ids)\n(rf/reg-sub ::unit-spec subs/unit-spec)\n(rf/reg-sub ::all-unit-specs subs/all-unit-specs)\n\n(rf/reg-sub\n ::compiled-unit-spec\n (fn [[_ id]]\n   (rf/subscribe [::unit-spec id]))\n subs/compiled-unit-spec-fn)\n\n(rf/reg-sub ::user-input-root subs/user-input-root)\n(rf/reg-sub ::config-input :<- [::user-input-root] subs/config-input)\n(rf/reg-sub ::config-mode :<- [::user-input-root] subs/config-mode)\n\n(rf/reg-sub\n ::parsed-config\n :<- [::config-input]\n :<- [::config-mode]\n subs/parsed-config)\n\n(rf/reg-sub\n ::top-level-prop\n :<- [::parsed-config]\n subs/top-level-prop)\n\n;; DS Subs\n(rf/reg-sub ::ds-db subs/ds-db)\n(rf/reg-sub ::mark :<- [::ds-db] subs/mark)\n(rf/reg-sub ::encoding :<- [::ds-db] subs/encoding)\n(rf/reg-sub ::tooltip :<- [::ds-db] subs/tooltip)\n\n\n(rf/reg-sub\n ::config-transform-raw\n :<- [::config-input]\n :<- [::config-mode]\n (fn [[input mode] _]\n   (try\n     (case mode\n       :edn (get (edn/read-string input) :transform)\n       :json (get (js->clj (js/JSON.parse input) :keywordize-keys true) :transform)\n       nil)\n     (catch js/Error _ nil))))\n\n(rf/reg-event-db\n ::set-config-transform-raw\n (fn [db [_ new-transform]]\n   (let [user-input (get-in db [:user-input :vega-lite :default])\n         mode (::config-mode user-input)\n         input (::config-input user-input)\n         new-input (try\n                     (case mode\n                       :edn (let [data (edn/read-string input)\n                                  updated (assoc data :transform new-transform)]\n                              (with-out-str (pprint updated)))\n                       :json (let [data (js->clj (js/JSON.parse input) :keywordize-keys true)\n                                   updated (assoc data :transform new-transform)]\n                               (js/JSON.stringify (clj->js updated) nil 2))\n                       input)\n                     (catch js/Error _ input))]\n     (assoc-in db [:user-input :vega-lite :default ::config-input] new-input))))\n\n;; --- Transform Ops Events & Subs ---\n\n(rf/reg-sub\n ::transform-ops\n (fn [db _]\n   (get-in db [:user-input :vega-lite :default ::transform-ops])))\n\n(rf/reg-event-db\n ::add-transform-op\n (fn [db [_ op]]\n   (update-in db [:user-input :vega-lite :default ::transform-ops] conj op)))\n\n(rf/reg-event-db\n ::remove-transform-op\n (fn [db [_ index]]\n   (let [path [:user-input :vega-lite :default ::transform-ops]]\n     (update-in db path (fn [ops]\n                          (let [[before after] (split-at index ops)]\n                            (vec (concat before (rest after)))))))))\n\n(rf/reg-event-db\n ::update-transform-op\n (fn [db [_ index new-op]]\n   (assoc-in db [:user-input :vega-lite :default ::transform-ops index] new-op)))\n\n(rf/reg-event-db\n ::reorder-transform-ops\n (fn [db [_ from-index to-index]]\n   (let [path [:user-input :vega-lite :default ::transform-ops]]\n     (update-in db path (fn [ops]\n                          (let [item (nth ops from-index)\n                                removed (vec (concat (subvec ops 0 from-index)\n                                                     (subvec ops (inc from-index))))]\n                            (vec (concat (subvec removed 0 to-index)\n                                         [item]\n                                         (subvec removed to-index)))))))))\n\n(rf/reg-event-db\n ::set-transform-ops\n (fn [db [_ ops]]\n   (assoc-in db [:user-input :vega-lite :default ::transform-ops] ops)))\n\n\n;; --- View ---\n\n(defn main-view []\n  (let [config-input @(rf/subscribe [::config-input])\n        parsed-config @(rf/subscribe [::parsed-config])\n        config-mode @(rf/subscribe [::config-mode])\n        url-input (rf/subscribe [::dataset-url-input])]\n    [:div {:class \"flex h-screen w-screen overflow-hidden\"}\n     ;; Left Side: Editor\n     [:div {:class \"w-1/2 h-full border-r border-gray-700 flex flex-col bg-[#1e1e1e]\"}\n       ;; Toolbar\n       [:div {:class \"flex items-center justify-between p-2 bg-[#2d2d2d] border-b border-gray-700 text-gray-300\"}\n        [:span \"Vega-Lite Configuration\"]\n        [:div {:class \"flex space-x-2 text-xs\"}\n          [:label {:class \"cursor-pointer flex items-center space-x-1\"}\n           [:input {:type \"radio\" :name \"mode\" :checked (= config-mode :json)\n                    :on-change #(rf/dispatch [::set-config-mode :json])}]\n           [:span \"JSON\"]]\n          [:label {:class \"cursor-pointer flex items-center space-x-1\"}\n           [:input {:type \"radio\" :name \"mode\" :checked (= config-mode :edn)\n                    :on-change #(rf/dispatch [::set-config-mode :edn])}]\n           [:span \"EDN\"]]]]\n\n      ;; Editor\n      [:div {:class \"flex-grow relative\"}\n       [editor/monaco-editor\n        {:value config-input\n         :language (if (= config-mode :json) \"json\" \"clojure\")\n         :options {:fontSize 15\n                   :fontFamily \"monospace\"\n                   :rulers [80]\n                   :minimap {:enabled false}}\n         :on-change #(rf/dispatch [::set-config-input %])}]]]\n\n     ;; Right Side: Visualization\n     [:div {:class \"w-1/2 h-full bg-white flex flex-col\"}\n      [:div {:class \"p-2 bg-gray-100 border-b border-gray-300 flex items-center gap-2\"}\n       [:input {:type \"text\"\n                :placeholder \"Dataset URL (e.g. https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/cars.json)\"\n                :value @url-input\n                :on-change #(rf/dispatch [::set-dataset-url-input (-> % .-target .-value)])\n                :class \"border p-1 flex-grow text-sm\"}]\n       [:button {:on-click #(rf/dispatch [::fetch-dataset @url-input])\n                 :class \"bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600\"}\n        \"Load Data\"]]\n      [:div {:class \"flex-grow overflow-auto relative\"}\n       [viz/vega-lite-viz parsed-config]]]]))\n\n\n(defonce react-root (rdomc/create-root (.getElementById js/document \"app\")))\n(defn run [] (rdomc/render react-root [main-view]))\n\n(defn ^:export init []\n  (rf/dispatch-sync [::initialize])\n  (run))\n"]}