{"version":3,"sources":["clj_yavl/core.cljs"],"mappings":"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","names":["clj-yavl.core/default-config-json","re_frame.core.reg_event_db","db","_","user-input-exists?","cljs.core.get_in","component-state-exists?","unit-specs-exists?","G__26707","cljs.core/not","cljs.core/assoc-in","cljs.core.assoc","p__26709","vec__26710","cljs.core.nth","id","type","initial-input","or__5025__auto__","p__26713","vec__26714","cljs.core.update_in","cljs.core/dissoc","p__26717","vec__26718","field","value","p__26722","vec__26723","input","re_frame.core.reg_sub","cljs.core/keys","p__26726","vec__26727","p__26730","vec__26731","re_frame.core.subscribe","spec","map__26734","cljs.core/--destructure-map","cljs.core.get","e26736","clj-yavl.presets/unit-spec","e","root","p__26737","vec__26738","val","p__26741","vec__26742","new-mode","user-input","current-mode","current-input","new-input","cljs.core._EQ_","e26746","obj","js/JSON.parse","edn-data","cljs.core.js__GT_clj","sb__5670__auto__","goog.string/StringBuffer","*print-newline*-orig-val__26747","cljs.core/*print-newline*","*print-fn*-orig-val__26748","cljs.core/*print-fn*","*print-newline*-temp-val__26749","*print-fn*-temp-val__26750","x__5671__auto__","cljs.pprint.pprint","js/Error","e26752","clojure.edn.read_string","cljs.core/clj->js","js/JSON.stringify","clj-yavl.core/main-view","cljs.core/deref","p1__26753#","config-input","config-mode","re-frame.core/dispatch","bb-web-ds-tools.components.editor/monaco-editor","js/clj-yavl","js/clj-yavl.core","js/clj-yavl.core.react-root","clj-yavl.core/react-root","reagent.dom.client.create_root","js/document","clj-yavl.core/run","reagent.dom.client.render","clj-yavl.core/init","re-frame.core/dispatch-sync"],"sourcesContent":["(ns clj-yavl.core\n  (:require [reagent.dom.client :as rdomc]\n            [re-frame.core :as rf]\n            [bb-web-ds-tools.components.editor :as editor]\n            [cljs.pprint :refer [pprint]]\n            [clojure.edn :as edn]\n            [clj-yavl.presets :as presets]))\n\n;; --- State ---\n\n(def default-config-json \"{\\n  \\\"$schema\\\": \\\"https://vega.github.io/schema/vega-lite/v5.json\\\",\\n  \\\"mark\\\": \\\"bar\\\",\\n  \\\"encoding\\\": {\\n    \\\"x\\\": {\\\"field\\\": \\\"col1\\\", \\\"type\\\": \\\"ordinal\\\"},\\n    \\\"y\\\": {\\\"field\\\": \\\"col2\\\", \\\"type\\\": \\\"quantitative\\\"}\\n  }\\n}\")\n\n(rf/reg-event-db\n ::initialize\n (fn [db _]\n   (let [user-input-exists? (get-in db [:user-input :vega-lite])\n         component-state-exists? (::vega-lite db)\n         unit-specs-exists? (get-in db [:user-input :unit-specs])]\n     (cond-> db\n       (not user-input-exists?)\n       (assoc-in [:user-input :vega-lite]\n                 {:saved-configs {}\n                  :default {::data-input \"\"\n                            ::config-input default-config-json\n                            ::config-mode :json\n                            ::active-config-name nil}})\n\n       (not component-state-exists?)\n       (assoc ::vega-lite\n              {::format :csv\n               ::structure :columnar\n               ::parsed-data nil\n               ::inferred-schema nil\n               ::active-left-tab :config})\n\n       (not unit-specs-exists?)\n       (assoc-in [:user-input :unit-specs] {})))))\n\n;; --- Unit Specs Events & Subs ---\n\n(rf/reg-event-db\n ::init-unit-spec\n (fn [db [_ id type initial-input]]\n   (assoc-in db [:user-input :unit-specs id]\n             {:type type\n              :input (or initial-input {})})))\n\n(rf/reg-event-db\n ::remove-unit-spec\n (fn [db [_ id]]\n   (update-in db [:user-input :unit-specs] dissoc id)))\n\n(rf/reg-event-db\n ::update-unit-spec-input\n (fn [db [_ id field value]]\n   (assoc-in db [:user-input :unit-specs id :input field] value)))\n\n(rf/reg-event-db\n ::set-unit-spec-input\n (fn [db [_ id input]]\n   (assoc-in db [:user-input :unit-specs id :input] input)))\n\n(rf/reg-sub\n ::unit-spec-ids\n (fn [db _]\n   (keys (get-in db [:user-input :unit-specs]))))\n\n(rf/reg-sub\n ::unit-spec\n (fn [db [_ id]]\n   (get-in db [:user-input :unit-specs id])))\n\n(rf/reg-sub\n ::all-unit-specs\n (fn [db _]\n   (get-in db [:user-input :unit-specs])))\n\n(rf/reg-sub\n ::compiled-unit-spec\n (fn [[_ id]]\n   (rf/subscribe [::unit-spec id]))\n (fn [spec _]\n   (when spec\n     (let [{:keys [type input]} spec]\n       (try\n         (presets/unit-spec (assoc input :type type))\n         (catch :default e\n           {:error (str \"Error compiling spec: \" e)}))))))\n\n(rf/reg-sub\n ::user-input-root\n (fn [db _]\n   (get-in db [:user-input :vega-lite :default])))\n\n(rf/reg-sub\n ::config-input\n :<- [::user-input-root]\n (fn [root]\n   (::config-input root)))\n\n(rf/reg-sub\n ::config-mode\n :<- [::user-input-root]\n (fn [root]\n   (::config-mode root)))\n\n(rf/reg-event-db\n ::set-config-input\n (fn [db [_ val]]\n   (assoc-in db [:user-input :vega-lite :default ::config-input] val)))\n\n(rf/reg-event-db\n ::set-config-mode\n (fn [db [_ new-mode]]\n   (let [user-input (get-in db [:user-input :vega-lite :default])\n         current-mode (::config-mode user-input)\n         current-input (::config-input user-input)\n         new-input (cond\n                     (and (= current-mode :json) (= new-mode :edn))\n                     (try\n                       (let [obj (js/JSON.parse current-input)\n                             edn-data (js->clj obj :keywordize-keys true)]\n                         (with-out-str (pprint edn-data)))\n                       (catch js/Error _ current-input))\n\n                     (and (= current-mode :edn) (= new-mode :json))\n                     (try\n                       (let [edn-data (edn/read-string current-input)\n                             obj (clj->js edn-data)]\n                         (js/JSON.stringify obj nil 2))\n                       (catch js/Error _ current-input))\n\n                     :else current-input)]\n     (-> db\n         (assoc-in [:user-input :vega-lite :default ::config-mode] new-mode)\n         (assoc-in [:user-input :vega-lite :default ::config-input] new-input)))))\n\n\n;; --- View ---\n\n(defn main-view []\n  (let [config-input @(rf/subscribe [::config-input])\n        config-mode @(rf/subscribe [::config-mode])]\n    [:div {:class \"flex h-screen w-screen overflow-hidden\"}\n     ;; Left Side: Editor\n     [:div {:class \"w-1/2 h-full border-r border-gray-700 flex flex-col bg-[#1e1e1e]\"}\n       ;; Toolbar\n       [:div {:class \"flex items-center justify-between p-2 bg-[#2d2d2d] border-b border-gray-700 text-gray-300\"}\n        [:span \"Vega-Lite Configuration\"]\n        [:div {:class \"flex space-x-2 text-xs\"}\n          [:label {:class \"cursor-pointer flex items-center space-x-1\"}\n           [:input {:type \"radio\" :name \"mode\" :checked (= config-mode :json)\n                    :on-change #(rf/dispatch [::set-config-mode :json])}]\n           [:span \"JSON\"]]\n          [:label {:class \"cursor-pointer flex items-center space-x-1\"}\n           [:input {:type \"radio\" :name \"mode\" :checked (= config-mode :edn)\n                    :on-change #(rf/dispatch [::set-config-mode :edn])}]\n           [:span \"EDN\"]]]]\n\n      ;; Editor\n      [:div {:class \"flex-grow relative\"}\n       [editor/monaco-editor\n        {:value config-input\n         :language (if (= config-mode :json) \"json\" \"clojure\")\n         :options {:fontSize 15\n                   :fontFamily \"monospace\"\n                   :rulers [80]\n                   :minimap {:enabled false}}\n         :on-change #(rf/dispatch [::set-config-input %])}]]]\n\n     ;; Right Side: Portal Iframe\n     [:div {:class \"w-1/2 h-full bg-white\"}\n      [:iframe {:src \"http://localhost:5678\"\n                :class \"w-full h-full border-none\"}]]]))\n\n\n(defonce react-root (rdomc/create-root (.getElementById js/document \"app\")))\n(defn run [] (rdomc/render react-root [main-view]))\n\n(defn ^:export init []\n  (rf/dispatch-sync [::initialize])\n  (run))\n"]}