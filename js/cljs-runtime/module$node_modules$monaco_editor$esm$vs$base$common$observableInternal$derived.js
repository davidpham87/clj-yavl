shadow$provide.module$node_modules$monaco_editor$esm$vs$base$common$observableInternal$derived = function(require, module, exports) {
  function derived(computeFnOrOwner, computeFn) {
    return computeFn !== void 0 ? new Derived(computeFnOrOwner, void 0, computeFn, void 0, void 0, void 0, defaultEqualityComparer) : new Derived(void 0, void 0, computeFnOrOwner, void 0, void 0, void 0, defaultEqualityComparer);
  }
  function derivedOpts(options, computeFn) {
    var _a;
    return new Derived(options.owner, options.debugName, computeFn, void 0, void 0, void 0, (_a = options.equalityComparer) !== null && _a !== void 0 ? _a : defaultEqualityComparer);
  }
  function derivedHandleChanges(options, computeFn) {
    var _a;
    return new Derived(options.owner, options.debugName, computeFn, options.createEmptyChangeSummary, options.handleChange, void 0, (_a = options.equalityComparer) !== null && _a !== void 0 ? _a : defaultEqualityComparer);
  }
  function derivedWithStore(computeFnOrOwner, computeFnOrUndefined) {
    let computeFn;
    computeFnOrUndefined === void 0 ? (computeFn = computeFnOrOwner, computeFnOrOwner = void 0) : computeFn = computeFnOrUndefined;
    const store = new require$_DOT__DOT__SLASH_lifecycle_DOT_js.DisposableStore();
    return new Derived(computeFnOrOwner, () => {
      var _a;
      return (_a = (0,require$_DOT__SLASH_base_DOT_js.getFunctionName)(computeFn)) !== null && _a !== void 0 ? _a : "(anonymous)";
    }, r => {
      store.clear();
      return computeFn(r, store);
    }, void 0, void 0, () => store.dispose(), defaultEqualityComparer);
  }
  function derivedDisposable(computeFnOrOwner, computeFnOrUndefined) {
    let computeFn;
    computeFnOrUndefined === void 0 ? (computeFn = computeFnOrOwner, computeFnOrOwner = void 0) : computeFn = computeFnOrUndefined;
    const store = new require$_DOT__DOT__SLASH_lifecycle_DOT_js.DisposableStore();
    return new Derived(computeFnOrOwner, () => {
      var _a;
      return (_a = (0,require$_DOT__SLASH_base_DOT_js.getFunctionName)(computeFn)) !== null && _a !== void 0 ? _a : "(anonymous)";
    }, r => {
      store.clear();
      (r = computeFn(r)) && store.add(r);
      return r;
    }, void 0, void 0, () => store.dispose(), defaultEqualityComparer);
  }
  Object.defineProperties(exports, {__esModule:{enumerable:!0, value:!0}, Derived:{enumerable:!0, get:function() {
    return Derived;
  }}, derived:{enumerable:!0, get:function() {
    return derived;
  }}, derivedDisposable:{enumerable:!0, get:function() {
    return derivedDisposable;
  }}, derivedHandleChanges:{enumerable:!0, get:function() {
    return derivedHandleChanges;
  }}, derivedOpts:{enumerable:!0, get:function() {
    return derivedOpts;
  }}, derivedWithStore:{enumerable:!0, get:function() {
    return derivedWithStore;
  }}});
  var require$_DOT__DOT__SLASH_errors_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$errors"), require$_DOT__DOT__SLASH_lifecycle_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$lifecycle"), require$_DOT__SLASH_base_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$observableInternal$base"), require$_DOT__SLASH_logging_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$observableInternal$logging");
  const defaultEqualityComparer = (a, b) => a === b;
  (0,require$_DOT__SLASH_base_DOT_js._setDerivedOpts)(derivedOpts);
  class Derived extends require$_DOT__SLASH_base_DOT_js.BaseObservable {
    get debugName() {
      var _a;
      return (_a = (0,require$_DOT__SLASH_base_DOT_js.getDebugName)(this, this._debugName, this._computeFn, this._owner, this)) !== null && _a !== void 0 ? _a : "(anonymous)";
    }
    constructor(_owner, _debugName, _computeFn, createChangeSummary, _handleChange, _handleLastObserverRemoved, _equalityComparator) {
      var _a, _b;
      super();
      this._owner = _owner;
      this._debugName = _debugName;
      this._computeFn = _computeFn;
      this.createChangeSummary = createChangeSummary;
      this._handleChange = _handleChange;
      this._handleLastObserverRemoved = _handleLastObserverRemoved;
      this._equalityComparator = _equalityComparator;
      this.state = 0;
      this.value = void 0;
      this.updateCount = 0;
      this.dependencies = new Set();
      this.dependenciesToBeRemoved = new Set();
      this.changeSummary = void 0;
      this.changeSummary = (_a = this.createChangeSummary) === null || _a === void 0 ? void 0 : _a.call(this);
      (_b = (0,require$_DOT__SLASH_logging_DOT_js.getLogger)()) === null || _b === void 0 || _b.handleDerivedCreated(this);
    }
    onLastObserverRemoved() {
      var _a;
      this.state = 0;
      this.value = void 0;
      for (const d of this.dependencies) {
        d.removeObserver(this);
      }
      this.dependencies.clear();
      (_a = this._handleLastObserverRemoved) === null || _a === void 0 || _a.call(this);
    }
    get() {
      var _a;
      if (this.observers.size === 0) {
        var result = this._computeFn(this, (_a = this.createChangeSummary) === null || _a === void 0 ? void 0 : _a.call(this));
        this.onLastObserverRemoved();
        return result;
      }
      do {
        if (this.state === 1) {
          for (result of this.dependencies) {
            if (result.reportChanges(), this.state === 2) {
              break;
            }
          }
        }
        this.state === 1 && (this.state = 3);
        this._recomputeIfNeeded();
      } while (this.state !== 3);
      return this.value;
    }
    _recomputeIfNeeded() {
      var _a, _b;
      if (this.state !== 3) {
        var emptySet = this.dependenciesToBeRemoved;
        this.dependenciesToBeRemoved = this.dependencies;
        this.dependencies = emptySet;
        emptySet = this.state !== 0;
        var oldValue = this.value;
        this.state = 3;
        var changeSummary = this.changeSummary;
        this.changeSummary = (_a = this.createChangeSummary) === null || _a === void 0 ? void 0 : _a.call(this);
        try {
          this.value = this._computeFn(this, changeSummary);
        } finally {
          for (const o of this.dependenciesToBeRemoved) {
            o.removeObserver(this);
          }
          this.dependenciesToBeRemoved.clear();
        }
        _a = emptySet && !this._equalityComparator(oldValue, this.value);
        (_b = (0,require$_DOT__SLASH_logging_DOT_js.getLogger)()) === null || _b === void 0 || _b.handleDerivedRecomputed(this, {oldValue, newValue:this.value, change:void 0, didChange:_a, hadValue:emptySet});
        if (_a) {
          for (const r of this.observers) {
            r.handleChange(this, void 0);
          }
        }
      }
    }
    toString() {
      return `LazyDerived<${this.debugName}>`;
    }
    beginUpdate(_observable) {
      this.updateCount++;
      _observable = this.updateCount === 1;
      if (this.state === 3 && (this.state = 1, !_observable)) {
        for (const r of this.observers) {
          r.handlePossibleChange(this);
        }
      }
      if (_observable) {
        for (const r of this.observers) {
          r.beginUpdate(this);
        }
      }
    }
    endUpdate(_observable) {
      this.updateCount--;
      if (this.updateCount === 0) {
        _observable = [...this.observers];
        for (const r of _observable) {
          r.endUpdate(this);
        }
      }
      if (this.updateCount < 0) {
        throw new require$_DOT__DOT__SLASH_errors_DOT_js.BugIndicatingError();
      }
    }
    handlePossibleChange(observable) {
      if (this.state === 3 && this.dependencies.has(observable) && !this.dependenciesToBeRemoved.has(observable)) {
        this.state = 1;
        for (const r of this.observers) {
          r.handlePossibleChange(this);
        }
      }
    }
    handleChange(observable, change) {
      if (this.dependencies.has(observable) && !this.dependenciesToBeRemoved.has(observable)) {
        change = this._handleChange ? this._handleChange({changedObservable:observable, change, didChange:o => o === observable}, this.changeSummary) : !0;
        const wasUpToDate = this.state === 3;
        if (change && (this.state === 1 || wasUpToDate) && (this.state = 2, wasUpToDate)) {
          for (const r of this.observers) {
            r.handlePossibleChange(this);
          }
        }
      }
    }
    readObservable(observable) {
      observable.addObserver(this);
      const value = observable.get();
      this.dependencies.add(observable);
      this.dependenciesToBeRemoved.delete(observable);
      return value;
    }
    addObserver(observer) {
      const shouldCallBeginUpdate = !this.observers.has(observer) && this.updateCount > 0;
      super.addObserver(observer);
      shouldCallBeginUpdate && observer.beginUpdate(this);
    }
    removeObserver(observer) {
      const shouldCallEndUpdate = this.observers.has(observer) && this.updateCount > 0;
      super.removeObserver(observer);
      shouldCallEndUpdate && observer.endUpdate(this);
    }
  }
};

//# sourceMappingURL=module$node_modules$monaco_editor$esm$vs$base$common$observableInternal$derived.js.map
