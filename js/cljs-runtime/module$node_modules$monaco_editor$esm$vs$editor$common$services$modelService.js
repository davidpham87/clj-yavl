shadow$provide.module$node_modules$monaco_editor$esm$vs$editor$common$services$modelService = function(require, module, exports) {
  Object.defineProperties(exports, {__esModule:{enumerable:!0, value:!0}, DefaultModelSHA1Computer:{enumerable:!0, get:function() {
    return DefaultModelSHA1Computer;
  }}, ModelService:{enumerable:!0, get:function() {
    return ModelService;
  }}});
  var require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_event_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$event"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_lifecycle_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$lifecycle"), platform = require("module$node_modules$monaco_editor$esm$vs$base$common$platform"), require$_DOT__DOT__SLASH_model_SLASH_textModel_DOT_js = require("module$node_modules$monaco_editor$esm$vs$editor$common$model$textModel"), 
  require$_DOT__DOT__SLASH_core_SLASH_textModelDefaults_DOT_js = require("module$node_modules$monaco_editor$esm$vs$editor$common$core$textModelDefaults"), require$_DOT__DOT__SLASH_languages_SLASH_modesRegistry_DOT_js = require("module$node_modules$monaco_editor$esm$vs$editor$common$languages$modesRegistry");
  module = require("module$node_modules$monaco_editor$esm$vs$editor$common$languages$language");
  exports = require("module$node_modules$monaco_editor$esm$vs$editor$common$services$textResourceConfiguration");
  var require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_platform_SLASH_configuration_SLASH_common_SLASH_configuration_DOT_js = require("module$node_modules$monaco_editor$esm$vs$platform$configuration$common$configuration"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_platform_SLASH_undoRedo_SLASH_common_SLASH_undoRedo_DOT_js = require("module$node_modules$monaco_editor$esm$vs$platform$undoRedo$common$undoRedo"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_hash_DOT_js = 
  require("module$node_modules$monaco_editor$esm$vs$base$common$hash"), require$_DOT__DOT__SLASH_model_SLASH_editStack_DOT_js = require("module$node_modules$monaco_editor$esm$vs$editor$common$model$editStack"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_network_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$network"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_objects_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$objects");
  require = require("module$node_modules$monaco_editor$esm$vs$editor$common$languages$languageConfigurationRegistry");
  var __decorate = this && this.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") {
      r = Reflect.decorate(decorators, target, key, desc);
    } else {
      for (var i = decorators.length - 1; i >= 0; i--) {
        if (d = decorators[i]) {
          r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
        }
      }
    }
    return c > 3 && r && Object.defineProperty(target, key, r), r;
  }, __param = this && this.__param || function(paramIndex, decorator) {
    return function(target, key) {
      decorator(target, key, paramIndex);
    };
  }, ModelService_1;
  class ModelData {
    constructor(model, onWillDispose, onDidChangeLanguage) {
      this.model = model;
      this._modelEventListeners = new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_lifecycle_DOT_js.DisposableStore();
      this.model = model;
      this._modelEventListeners.add(model.onWillDispose(() => onWillDispose(model)));
      this._modelEventListeners.add(model.onDidChangeLanguage(e => onDidChangeLanguage(model, e)));
    }
    dispose() {
      this._modelEventListeners.dispose();
    }
  }
  const DEFAULT_EOL = platform.isLinux || platform.isMacintosh ? 1 : 2;
  class DisposedModelInfo {
    constructor(uri, initialUndoRedoSnapshot, time, sharesUndoRedoStack, heapSize, sha1, versionId, alternativeVersionId) {
      this.uri = uri;
      this.initialUndoRedoSnapshot = initialUndoRedoSnapshot;
      this.time = time;
      this.sharesUndoRedoStack = sharesUndoRedoStack;
      this.heapSize = heapSize;
      this.sha1 = sha1;
      this.versionId = versionId;
      this.alternativeVersionId = alternativeVersionId;
    }
  }
  let ModelService = ModelService_1 = class extends require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_lifecycle_DOT_js.Disposable {
    constructor(_configurationService, _resourcePropertiesService, _undoRedoService, _languageService, _languageConfigurationService) {
      super();
      this._configurationService = _configurationService;
      this._resourcePropertiesService = _resourcePropertiesService;
      this._undoRedoService = _undoRedoService;
      this._languageService = _languageService;
      this._languageConfigurationService = _languageConfigurationService;
      this._onModelAdded = this._register(new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_event_DOT_js.Emitter());
      this.onModelAdded = this._onModelAdded.event;
      this._onModelRemoved = this._register(new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_event_DOT_js.Emitter());
      this.onModelRemoved = this._onModelRemoved.event;
      this._onModelModeChanged = this._register(new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_event_DOT_js.Emitter());
      this.onModelLanguageChanged = this._onModelModeChanged.event;
      this._modelCreationOptionsByLanguageAndResource = Object.create(null);
      this._models = {};
      this._disposedModels = new Map();
      this._disposedModelsHeapSize = 0;
      this._register(this._configurationService.onDidChangeConfiguration(e => this._updateModelOptions(e)));
      this._updateModelOptions(void 0);
    }
    static _readModelOptions(config, isForSimpleWidget) {
      var _a;
      let tabSize = require$_DOT__DOT__SLASH_core_SLASH_textModelDefaults_DOT_js.EDITOR_MODEL_DEFAULTS.tabSize;
      if (config.editor && typeof config.editor.tabSize !== "undefined") {
        var parsedTabSize = parseInt(config.editor.tabSize, 10);
        isNaN(parsedTabSize) || (tabSize = parsedTabSize);
        tabSize < 1 && (tabSize = 1);
      }
      parsedTabSize = "tabSize";
      if (config.editor && typeof config.editor.indentSize !== "undefined" && config.editor.indentSize !== "tabSize") {
        var parsedIndentSize = parseInt(config.editor.indentSize, 10);
        isNaN(parsedIndentSize) || (parsedTabSize = Math.max(parsedIndentSize, 1));
      }
      parsedIndentSize = require$_DOT__DOT__SLASH_core_SLASH_textModelDefaults_DOT_js.EDITOR_MODEL_DEFAULTS.insertSpaces;
      config.editor && typeof config.editor.insertSpaces !== "undefined" && (parsedIndentSize = config.editor.insertSpaces === "false" ? !1 : !!config.editor.insertSpaces);
      let newDefaultEOL = DEFAULT_EOL;
      var eol = config.eol;
      eol === "\r\n" ? newDefaultEOL = 2 : eol === "\n" && (newDefaultEOL = 1);
      eol = require$_DOT__DOT__SLASH_core_SLASH_textModelDefaults_DOT_js.EDITOR_MODEL_DEFAULTS.trimAutoWhitespace;
      config.editor && typeof config.editor.trimAutoWhitespace !== "undefined" && (eol = config.editor.trimAutoWhitespace === "false" ? !1 : !!config.editor.trimAutoWhitespace);
      let detectIndentation = require$_DOT__DOT__SLASH_core_SLASH_textModelDefaults_DOT_js.EDITOR_MODEL_DEFAULTS.detectIndentation;
      config.editor && typeof config.editor.detectIndentation !== "undefined" && (detectIndentation = config.editor.detectIndentation === "false" ? !1 : !!config.editor.detectIndentation);
      let largeFileOptimizations = require$_DOT__DOT__SLASH_core_SLASH_textModelDefaults_DOT_js.EDITOR_MODEL_DEFAULTS.largeFileOptimizations;
      config.editor && typeof config.editor.largeFileOptimizations !== "undefined" && (largeFileOptimizations = config.editor.largeFileOptimizations === "false" ? !1 : !!config.editor.largeFileOptimizations);
      let bracketPairColorizationOptions = require$_DOT__DOT__SLASH_core_SLASH_textModelDefaults_DOT_js.EDITOR_MODEL_DEFAULTS.bracketPairColorizationOptions;
      ((_a = config.editor) === null || _a === void 0 ? 0 : _a.bracketPairColorization) && typeof config.editor.bracketPairColorization === "object" && (bracketPairColorizationOptions = {enabled:!!config.editor.bracketPairColorization.enabled, independentColorPoolPerBracketType:!!config.editor.bracketPairColorization.independentColorPoolPerBracketType});
      return {isForSimpleWidget, tabSize, indentSize:parsedTabSize, insertSpaces:parsedIndentSize, detectIndentation, defaultEOL:newDefaultEOL, trimAutoWhitespace:eol, largeFileOptimizations, bracketPairColorizationOptions};
    }
    _getEOL(resource, language) {
      return resource ? this._resourcePropertiesService.getEOL(resource, language) : (resource = this._configurationService.getValue("files.eol", {overrideIdentifier:language})) && typeof resource === "string" && resource !== "auto" ? resource : platform.OS === 3 || platform.OS === 2 ? "\n" : "\r\n";
    }
    _shouldRestoreUndoStack() {
      const result = this._configurationService.getValue("files.restoreUndoStack");
      return typeof result === "boolean" ? result : !0;
    }
    getCreationOptions(languageIdOrSelection, resource, isForSimpleWidget) {
      languageIdOrSelection = typeof languageIdOrSelection === "string" ? languageIdOrSelection : languageIdOrSelection.languageId;
      var creationOptions = this._modelCreationOptionsByLanguageAndResource[languageIdOrSelection + resource];
      if (!creationOptions) {
        creationOptions = this._configurationService.getValue("editor", {overrideIdentifier:languageIdOrSelection, resource});
        const eol = this._getEOL(resource, languageIdOrSelection);
        creationOptions = ModelService_1._readModelOptions({editor:creationOptions, eol}, isForSimpleWidget);
        this._modelCreationOptionsByLanguageAndResource[languageIdOrSelection + resource] = creationOptions;
      }
      return creationOptions;
    }
    _updateModelOptions(e) {
      const oldOptionsByLanguageAndResource = this._modelCreationOptionsByLanguageAndResource;
      this._modelCreationOptionsByLanguageAndResource = Object.create(null);
      const keys = Object.keys(this._models);
      for (let i = 0, len = keys.length; i < len; i++) {
        const modelData = this._models[keys[i]];
        var language = modelData.model.getLanguageId();
        const uri = modelData.model.uri;
        if (e && !e.affectsConfiguration("editor", {overrideIdentifier:language, resource:uri}) && !e.affectsConfiguration("files.eol", {overrideIdentifier:language, resource:uri})) {
          continue;
        }
        const oldOptions = oldOptionsByLanguageAndResource[language + uri];
        language = this.getCreationOptions(language, uri, modelData.model.isForSimpleWidget);
        ModelService_1._setModelOptionsForModel(modelData.model, language, oldOptions);
      }
    }
    static _setModelOptionsForModel(model, newOptions, currentOptions) {
      currentOptions && currentOptions.defaultEOL !== newOptions.defaultEOL && model.getLineCount() === 1 && model.setEOL(newOptions.defaultEOL === 1 ? 0 : 1);
      currentOptions && currentOptions.detectIndentation === newOptions.detectIndentation && currentOptions.insertSpaces === newOptions.insertSpaces && currentOptions.tabSize === newOptions.tabSize && currentOptions.indentSize === newOptions.indentSize && currentOptions.trimAutoWhitespace === newOptions.trimAutoWhitespace && (0,require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_objects_DOT_js.equals)(currentOptions.bracketPairColorizationOptions, newOptions.bracketPairColorizationOptions) || 
      (newOptions.detectIndentation ? (model.detectIndentation(newOptions.insertSpaces, newOptions.tabSize), model.updateOptions({trimAutoWhitespace:newOptions.trimAutoWhitespace, bracketColorizationOptions:newOptions.bracketPairColorizationOptions})) : model.updateOptions({insertSpaces:newOptions.insertSpaces, tabSize:newOptions.tabSize, indentSize:newOptions.indentSize, trimAutoWhitespace:newOptions.trimAutoWhitespace, bracketColorizationOptions:newOptions.bracketPairColorizationOptions}));
    }
    _insertDisposedModel(disposedModelData) {
      this._disposedModels.set(disposedModelData.uri.toString(), disposedModelData);
      this._disposedModelsHeapSize += disposedModelData.heapSize;
    }
    _removeDisposedModel(resource) {
      const disposedModelData = this._disposedModels.get(resource.toString());
      disposedModelData && (this._disposedModelsHeapSize -= disposedModelData.heapSize);
      this._disposedModels.delete(resource.toString());
      return disposedModelData;
    }
    _ensureDisposedModelsHeapSize(maxModelsHeapSize) {
      if (this._disposedModelsHeapSize > maxModelsHeapSize) {
        const disposedModels = [];
        this._disposedModels.forEach(entry => {
          entry.sharesUndoRedoStack || disposedModels.push(entry);
        });
        for (disposedModels.sort((a, b) => a.time - b.time); disposedModels.length > 0 && this._disposedModelsHeapSize > maxModelsHeapSize;) {
          const disposedModel = disposedModels.shift();
          this._removeDisposedModel(disposedModel.uri);
          disposedModel.initialUndoRedoSnapshot !== null && this._undoRedoService.restoreSnapshot(disposedModel.initialUndoRedoSnapshot);
        }
      }
    }
    _createModelData(value, languageIdOrSelection, resource, isForSimpleWidget) {
      isForSimpleWidget = this.getCreationOptions(languageIdOrSelection, resource, isForSimpleWidget);
      value = new require$_DOT__DOT__SLASH_model_SLASH_textModel_DOT_js.TextModel(value, languageIdOrSelection, isForSimpleWidget, resource, this._undoRedoService, this._languageService, this._languageConfigurationService);
      if (resource && this._disposedModels.has(resource.toString())) {
        languageIdOrSelection = this._removeDisposedModel(resource);
        isForSimpleWidget = this._undoRedoService.getElements(resource);
        var sha1Computer = this._getSHA1Computer();
        if ((sha1Computer = sha1Computer.canComputeSHA1(value) ? sha1Computer.computeSHA1(value) === languageIdOrSelection.sha1 : !1) || languageIdOrSelection.sharesUndoRedoStack) {
          for (var element of isForSimpleWidget.past) {
            (0,require$_DOT__DOT__SLASH_model_SLASH_editStack_DOT_js.isEditStackElement)(element) && element.matchesResource(resource) && element.setModel(value);
          }
          for (var element$jscomp$0 of isForSimpleWidget.future) {
            (0,require$_DOT__DOT__SLASH_model_SLASH_editStack_DOT_js.isEditStackElement)(element$jscomp$0) && element$jscomp$0.matchesResource(resource) && element$jscomp$0.setModel(value);
          }
          this._undoRedoService.setElementsValidFlag(resource, !0, element => (0,require$_DOT__DOT__SLASH_model_SLASH_editStack_DOT_js.isEditStackElement)(element) && element.matchesResource(resource));
          sha1Computer && (value._overwriteVersionId(languageIdOrSelection.versionId), value._overwriteAlternativeVersionId(languageIdOrSelection.alternativeVersionId), value._overwriteInitialUndoRedoSnapshot(languageIdOrSelection.initialUndoRedoSnapshot));
        } else {
          languageIdOrSelection.initialUndoRedoSnapshot !== null && this._undoRedoService.restoreSnapshot(languageIdOrSelection.initialUndoRedoSnapshot);
        }
      }
      element = value.uri.toString();
      if (this._models[element]) {
        throw Error("ModelService: Cannot add model because it already exists!");
      }
      element$jscomp$0 = new ModelData(value, model => this._onWillDispose(model), (model, e) => this._onDidChangeLanguage(model, e));
      return this._models[element] = element$jscomp$0;
    }
    createModel(value, languageSelection, resource, isForSimpleWidget = !1) {
      value = languageSelection ? this._createModelData(value, languageSelection, resource, isForSimpleWidget) : this._createModelData(value, require$_DOT__DOT__SLASH_languages_SLASH_modesRegistry_DOT_js.PLAINTEXT_LANGUAGE_ID, resource, isForSimpleWidget);
      this._onModelAdded.fire(value.model);
      return value.model;
    }
    getModels() {
      const ret = [], keys = Object.keys(this._models);
      for (let i = 0, len = keys.length; i < len; i++) {
        ret.push(this._models[keys[i]].model);
      }
      return ret;
    }
    getModel(resource) {
      return (resource = this._models[resource.toString()]) ? resource.model : null;
    }
    _schemaShouldMaintainUndoRedoElements(resource) {
      return resource.scheme === require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_network_DOT_js.Schemas.file || resource.scheme === require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_network_DOT_js.Schemas.vscodeRemote || resource.scheme === require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_network_DOT_js.Schemas.vscodeUserData || resource.scheme === require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_network_DOT_js.Schemas.vscodeNotebookCell || 
      resource.scheme === "fake-fs";
    }
    _onWillDispose(model) {
      const modelId = model.uri.toString(), modelData = this._models[modelId];
      var sharesUndoRedoStack = this._undoRedoService.getUriComparisonKey(model.uri) !== model.uri.toString();
      let maintainUndoRedoStack = !1, heapSize = 0;
      if (sharesUndoRedoStack || this._shouldRestoreUndoStack() && this._schemaShouldMaintainUndoRedoElements(model.uri)) {
        var elements = this._undoRedoService.getElements(model.uri);
        if (elements.past.length > 0 || elements.future.length > 0) {
          for (var element of elements.past) {
            (0,require$_DOT__DOT__SLASH_model_SLASH_editStack_DOT_js.isEditStackElement)(element) && element.matchesResource(model.uri) && (maintainUndoRedoStack = !0, heapSize += element.heapSize(model.uri), element.setModel(model.uri));
          }
          for (const element of elements.future) {
            (0,require$_DOT__DOT__SLASH_model_SLASH_editStack_DOT_js.isEditStackElement)(element) && element.matchesResource(model.uri) && (maintainUndoRedoStack = !0, heapSize += element.heapSize(model.uri), element.setModel(model.uri));
          }
        }
      }
      elements = ModelService_1.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK;
      element = this._getSHA1Computer();
      maintainUndoRedoStack ? sharesUndoRedoStack || !(heapSize > elements) && element.canComputeSHA1(model) ? (this._ensureDisposedModelsHeapSize(elements - heapSize), this._undoRedoService.setElementsValidFlag(model.uri, !1, element => (0,require$_DOT__DOT__SLASH_model_SLASH_editStack_DOT_js.isEditStackElement)(element) && element.matchesResource(model.uri)), this._insertDisposedModel(new DisposedModelInfo(model.uri, modelData.model.getInitialUndoRedoSnapshot(), Date.now(), sharesUndoRedoStack, 
      heapSize, element.computeSHA1(model), model.getVersionId(), model.getAlternativeVersionId()))) : (sharesUndoRedoStack = modelData.model.getInitialUndoRedoSnapshot(), sharesUndoRedoStack !== null && this._undoRedoService.restoreSnapshot(sharesUndoRedoStack)) : sharesUndoRedoStack || (sharesUndoRedoStack = modelData.model.getInitialUndoRedoSnapshot(), sharesUndoRedoStack !== null && this._undoRedoService.restoreSnapshot(sharesUndoRedoStack));
      delete this._models[modelId];
      modelData.dispose();
      delete this._modelCreationOptionsByLanguageAndResource[model.getLanguageId() + model.uri];
      this._onModelRemoved.fire(model);
    }
    _onDidChangeLanguage(model, e) {
      e = e.oldLanguage;
      var newLanguageId = model.getLanguageId();
      const oldOptions = this.getCreationOptions(e, model.uri, model.isForSimpleWidget);
      newLanguageId = this.getCreationOptions(newLanguageId, model.uri, model.isForSimpleWidget);
      ModelService_1._setModelOptionsForModel(model, newLanguageId, oldOptions);
      this._onModelModeChanged.fire({model, oldLanguageId:e});
    }
    _getSHA1Computer() {
      return new DefaultModelSHA1Computer();
    }
  };
  ModelService.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK = 20971520;
  ModelService = ModelService_1 = __decorate([__param(0, require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_platform_SLASH_configuration_SLASH_common_SLASH_configuration_DOT_js.IConfigurationService), __param(1, exports.ITextResourcePropertiesService), __param(2, require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_platform_SLASH_undoRedo_SLASH_common_SLASH_undoRedo_DOT_js.IUndoRedoService), __param(3, module.ILanguageService), __param(4, require.ILanguageConfigurationService)], ModelService);
  class DefaultModelSHA1Computer {
    canComputeSHA1(model) {
      return model.getValueLength() <= DefaultModelSHA1Computer.MAX_MODEL_SIZE;
    }
    computeSHA1(model) {
      const shaComputer = new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_hash_DOT_js.StringSHA1();
      model = model.createSnapshot();
      let text;
      for (; text = model.read();) {
        shaComputer.update(text);
      }
      return shaComputer.digest();
    }
  }
  DefaultModelSHA1Computer.MAX_MODEL_SIZE = 10485760;
};

//# sourceMappingURL=module$node_modules$monaco_editor$esm$vs$editor$common$services$modelService.js.map
