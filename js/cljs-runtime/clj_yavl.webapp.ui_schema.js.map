{"version":3,"sources":["clj_yavl/webapp/ui_schema.cljc"],"mappings":"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","names":["clj-yavl.webapp.ui-schema/get-fields","data-schema","schema","malli.core.schema","t","malli.core.type","map-schema","fexpr__29676","cljs.core/seq","malli.core.children","child","cljs.core/first","malli.core/schema?","e29681","js/Error","_","and__5023__auto__","cljs.core._EQ_","children","cljs.core.mapv","cljs.core/vector?","cljs.core/name","clj-yavl.webapp.ui-schema/extract-as-fields","transform","as","clj-yavl.webapp.ui-schema/get-transform-fields","opts","transforms","cljs.core.concat","cljs.core.reduce","acc","cljs.core.into","clj-yavl.webapp.ui-schema/field-select","fields","clj-yavl.webapp.ui-schema/type-select","current-type","or__5025__auto__","clj-yavl.webapp.ui-schema/encoding-def","current-field-opts","cljs.core.get","clj-yavl.webapp.ui-schema/presets","current-opts","clj-yavl.webapp.ui-schema/common-args","clj-yavl.webapp.ui-schema/common-def","var_args","args__5755__auto__","len__5749__auto__","i__5750__auto__","argseq__5756__auto__","cljs.core/IndexedSeq","clj-yavl.webapp.ui-schema/generate-ui-schema","p__29728","vec__29729","cljs.core.nth","seq29716","G__29717","cljs.core/next","G__29718","self__5734__auto__","preset-key","schema-fields","transform-fields","all-fields","cljs.core.distinct","preset","preset-def","fexpr__29737","common","cljs.core/vec","iter__5503__auto__","s__29744","cljs.core/LazySeq","temp__5825__auto__","cljs.core/chunked-seq?","c__5501__auto__","size__5502__auto__","cljs.core/count","b__29746","cljs.core/chunk-buffer","i__29745","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__29743","cljs.core/chunk-rest","cljs.core/cons","cljs.core/rest","arg","arg-opts","cljs.core.update","cljs.core/assoc","type-map","cljs.core.assoc","s__29757","b__29759","i__29758","iter__29756","cljs.core/chunk-first"],"sourcesContent":["(ns clj-yavl.webapp.ui-schema\n  (:require [malli.core :as m]))\n\n(defn- get-fields\n  [data-schema]\n  (let [schema (m/schema data-schema)\n        t (m/type schema)\n        map-schema (if (#{:vector :sequential :set :list} t)\n                     (if (seq (m/children schema))\n                       (let [child (first (m/children schema))]\n                         (if (m/schema? child)\n                           child\n                           (try (m/schema child)\n                                (catch #?(:clj Exception\n                                          :cljs js/Error)\n                                  _\n                                  nil))))\n                       nil)\n                     schema)]\n    (if (and map-schema (= (m/type map-schema) :map))\n      (let [children (m/children map-schema)]\n        (mapv (fn [child]\n                (if (vector? child)\n                  (name (first child))\n                  ;; Fallback if child format is unexpected\n                  (str child)))\n          children))\n      [])))\n\n(defn- extract-as-fields\n  [transform]\n  (let [as (:as transform)]\n    (cond (string? as) [as]\n          (vector? as) as\n          :else [])))\n\n(defn- get-transform-fields\n  [opts]\n  (let [transforms (concat (:transform opts)\n                           (if (vector? (:calculate opts))\n                             (:calculate opts)\n                             [(:calculate opts)]))]\n    (reduce (fn [acc t] (if t (into acc (extract-as-fields t)) acc))\n      []\n      transforms)))\n\n(defn- field-select [fields] {:property :field, :type :select, :options fields})\n\n(defn- type-select\n  [current-type]\n  {:property :type,\n   :type :select,\n   :options [\"quantitative\" \"nominal\" \"temporal\" \"ordinal\"],\n   :default (or current-type \"nominal\")})\n\n(defn- encoding-def\n  [fields current-field-opts]\n  {:field (field-select fields),\n   :type (type-select (get current-field-opts :type)),\n   :title {:property :title, :type :text-input}})\n\n(def presets\n  {:xyplot {:args [:x :y :mark :color :size],\n            :def (fn [fields current-opts]\n                   {:x (encoding-def fields (get current-opts :x)),\n                    :y (encoding-def fields (get current-opts :y)),\n                    :mark {:value {:property :value,\n                                   :type :select,\n                                   :options [\"point\" \"line\" \"area\" \"bar\"\n                                             \"circle\" \"square\" \"tick\" \"rect\"]}},\n                    :color (encoding-def fields (get current-opts :color)),\n                    :size (encoding-def fields (get current-opts :size))})},\n   :pie {:args [:category :value :inner-radius],\n         :def (fn [fields current-opts]\n                {:category (encoding-def fields (get current-opts :category)),\n                 :value (encoding-def fields (get current-opts :value)),\n                 :inner-radius {:value {:property :value,\n                                        :type :number-input}}})},\n   :bar {:args [:x :y :color :group :grouped? :orientation],\n         :def (fn [fields current-opts]\n                {:x (encoding-def fields (get current-opts :x)),\n                 :y (encoding-def fields (get current-opts :y)),\n                 :color (encoding-def fields (get current-opts :color)),\n                 :group (field-select fields),\n                 :grouped? {:value {:property :value, :type :boolean}},\n                 :orientation {:value {:property :value,\n                                       :type :select,\n                                       :options [:vertical :horizontal]}}})}})\n\n(def common-args [:title :width :height :facet :repeat :transform])\n\n(defn- common-def\n  [fields]\n  {:title {:value {:property :value, :type :text-input}},\n   :width {:value {:property :value, :type :number-input}},\n   :height {:value {:property :value, :type :number-input}},\n   :facet {:field (field-select fields),\n           :columns {:property :columns, :type :number-input}},\n   :repeat {:row {:property :row, :type :multi-select, :options fields},\n            :column {:property :column, :type :multi-select, :options fields}},\n   :transform {:value {:property :value, :type :json-editor}}})\n\n(defn generate-ui-schema\n  [preset-key data-schema & [current-opts]]\n  (let [schema-fields (get-fields data-schema)\n        transform-fields (get-transform-fields current-opts)\n        all-fields (distinct (concat schema-fields transform-fields))\n        preset (get presets preset-key)\n        preset-def ((:def preset) all-fields current-opts)\n        common (common-def all-fields)]\n    (vec\n      (concat\n        (for [arg (:args preset)]\n          (let [arg-opts (get current-opts arg)]\n            {:scope :preset,\n             :arg arg,\n             :main (-> (get preset-def arg)\n                       (update :field assoc :current-val (get arg-opts :field))\n                       (update :type\n                               (fn [type-map]\n                                 (assoc type-map\n                                   :current-type (get arg-opts :type)))))\n             :advanced {}}))\n        (for [arg common-args]\n          (let [arg-opts (get current-opts arg)]\n            {:scope :common,\n             :arg arg,\n             :main (-> (get common arg)\n                       (update :field assoc :current-val (get arg-opts :field))\n                       (update :type\n                               (fn [type-map]\n                                 (assoc type-map\n                                   :current-type (get arg-opts :type)))))\n             :advanced {}}))))))\n"]}