{"version":3,"sources":["clj_yavl/ui_schema.cljc"],"mappings":"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","names":["clj-yavl.ui-schema/get-fields","data-schema","schema","malli.core.schema","t","malli.core.type","map-schema","fexpr__31300","cljs.core/seq","malli.core.children","child","cljs.core/first","malli.core/schema?","e31301","js/Error","_","and__5023__auto__","cljs.core._EQ_","children","cljs.core.mapv","cljs.core/vector?","cljs.core/name","clj-yavl.ui-schema/extract-as-fields","transform","as","clj-yavl.ui-schema/get-transform-fields","opts","transforms","cljs.core.concat","cljs.core.reduce","acc","cljs.core.into","clj-yavl.ui-schema/field-select","fields","clj-yavl.ui-schema/type-select","clj-yavl.ui-schema/encoding-def","clj-yavl.ui-schema/presets","clj-yavl.ui-schema/common-args","clj-yavl.ui-schema/common-def","var_args","args__5755__auto__","len__5749__auto__","i__5750__auto__","argseq__5756__auto__","cljs.core/IndexedSeq","clj-yavl.ui-schema/generate-ui-schema","p__31322","vec__31323","cljs.core.nth","seq31319","G__31320","cljs.core/next","G__31321","self__5734__auto__","preset-key","current-opts","schema-fields","transform-fields","all-fields","cljs.core.distinct","preset","cljs.core.get","preset-def","fexpr__31330","common","cljs.core/vec","iter__5503__auto__","s__31338","cljs.core/LazySeq","temp__5825__auto__","cljs.core/chunked-seq?","c__5501__auto__","size__5502__auto__","cljs.core/count","b__31340","cljs.core/chunk-buffer","i__31339","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__31337","cljs.core/chunk-rest","cljs.core/cons","cljs.core/rest","arg","s__31343","b__31345","i__31344","iter__31342","cljs.core/chunk-first"],"sourcesContent":["(ns clj-yavl.ui-schema\n  (:require [malli.core :as m]\n            [clojure.string :as str]))\n\n(defn- get-fields [data-schema]\n  (let [schema (m/schema data-schema)\n        t (m/type schema)\n        map-schema (if (#{:vector :sequential :set :list} t)\n                     (if (seq (m/children schema))\n                       (let [child (first (m/children schema))]\n                         (if (m/schema? child)\n                           child\n                           (try (m/schema child) (catch #?(:clj Exception :cljs js/Error) _ nil))))\n                       nil)\n                     schema)]\n    (if (and map-schema (= (m/type map-schema) :map))\n      (let [children (m/children map-schema)]\n        (mapv (fn [child]\n                (if (vector? child)\n                  (name (first child))\n                  ;; Fallback if child format is unexpected\n                  (str child)))\n              children))\n      [])))\n\n(defn- extract-as-fields [transform]\n  (let [as (:as transform)]\n    (cond\n      (string? as) [as]\n      (vector? as) as\n      :else [])))\n\n(defn- get-transform-fields [opts]\n  (let [transforms (concat (:transform opts)\n                           (if (vector? (:calculate opts)) (:calculate opts) [(:calculate opts)]))]\n    (reduce (fn [acc t]\n              (if t\n                (into acc (extract-as-fields t))\n                acc))\n            []\n            transforms)))\n\n(defn- field-select [fields]\n  {:property :field :type :select :options fields})\n\n(defn- type-select []\n  {:property :type :type :select :options [\"quantitative\" \"nominal\" \"temporal\" \"ordinal\"]})\n\n(defn- encoding-def [fields]\n  {:field (field-select fields)\n   :type (type-select)\n   :title {:property :title :type :text-input}})\n\n(def presets\n  {:xyplot {:args [:x :y :mark :color :size]\n            :def (fn [fields]\n                   {:x (encoding-def fields)\n                    :y (encoding-def fields)\n                    :mark {:value {:property :value :type :select :options [\"point\" \"line\" \"area\" \"bar\" \"circle\" \"square\" \"tick\" \"rect\"]}}\n                    :color (encoding-def fields)\n                    :size (encoding-def fields)})}\n   :pie {:args [:category :value :inner-radius]\n         :def (fn [fields]\n                {:category (encoding-def fields)\n                 :value (encoding-def fields)\n                 :inner-radius {:value {:property :value :type :number-input}}})}\n   :bar {:args [:x :y :color :group :grouped? :orientation]\n         :def (fn [fields]\n                {:x (encoding-def fields)\n                 :y (encoding-def fields)\n                 :color (encoding-def fields)\n                 :group (field-select fields)\n                 :grouped? {:value {:property :value :type :boolean}}\n                 :orientation {:value {:property :value :type :select :options [:vertical :horizontal]}}})}})\n\n(def common-args [:title :width :height :facet :repeat :transform])\n\n(defn- common-def [fields]\n  {:title {:value {:property :value :type :text-input}}\n   :width {:value {:property :value :type :number-input}}\n   :height {:value {:property :value :type :number-input}}\n   :facet {:field (field-select fields) :columns {:property :columns :type :number-input}}\n   :repeat {:row {:property :row :type :multi-select :options fields}\n            :column {:property :column :type :multi-select :options fields}}\n   :transform {:value {:property :value :type :json-editor}}})\n\n(defn generate-ui-schema [preset-key data-schema & [current-opts]]\n  (let [schema-fields (get-fields data-schema)\n        transform-fields (get-transform-fields current-opts)\n        all-fields (distinct (concat schema-fields transform-fields))\n        preset (get presets preset-key)\n        preset-def ((:def preset) all-fields)\n        common (common-def all-fields)]\n    (vec\n     (concat\n      (for [arg (:args preset)]\n        {:scope :preset\n         :arg arg\n         :main (get preset-def arg)\n         :advanced {}})\n      (for [arg common-args]\n        {:scope :common\n         :arg arg\n         :main (get common arg)\n         :advanced {}})))))\n"]}