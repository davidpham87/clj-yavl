shadow$provide.module$node_modules$monaco_editor$esm$vs$editor$browser$widget$diffEditor$workerBasedDocumentDiffProvider = function(require, module, exports) {
  Object.defineProperties(exports, {__esModule:{enumerable:!0, value:!0}, WorkerBasedDocumentDiffProvider:{enumerable:!0, get:function() {
    return WorkerBasedDocumentDiffProvider;
  }}});
  var require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_event_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$event"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_stopwatch_DOT_js = require("module$node_modules$monaco_editor$esm$vs$base$common$stopwatch"), require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_common_SLASH_core_SLASH_lineRange_DOT_js = require("module$node_modules$monaco_editor$esm$vs$editor$common$core$lineRange"), 
  require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_common_SLASH_diff_SLASH_rangeMapping_DOT_js = require("module$node_modules$monaco_editor$esm$vs$editor$common$diff$rangeMapping");
  module = require("module$node_modules$monaco_editor$esm$vs$editor$common$services$editorWorker");
  require = require("module$node_modules$monaco_editor$esm$vs$platform$telemetry$common$telemetry");
  exports = this && this.__decorate || function(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") {
      r = Reflect.decorate(decorators, target, key, desc);
    } else {
      for (var i = decorators.length - 1; i >= 0; i--) {
        if (d = decorators[i]) {
          r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
        }
      }
    }
    return c > 3 && r && Object.defineProperty(target, key, r), r;
  };
  var __param = this && this.__param || function(paramIndex, decorator) {
    return function(target, key) {
      decorator(target, key, paramIndex);
    };
  }, WorkerBasedDocumentDiffProvider_1;
  let WorkerBasedDocumentDiffProvider = WorkerBasedDocumentDiffProvider_1 = class {
    constructor(options, editorWorkerService, telemetryService) {
      this.editorWorkerService = editorWorkerService;
      this.telemetryService = telemetryService;
      this.onDidChangeEventEmitter = new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_event_DOT_js.Emitter();
      this.onDidChange = this.onDidChangeEventEmitter.event;
      this.diffAlgorithm = "advanced";
      this.diffAlgorithmOnDidChangeSubscription = void 0;
      this.setOptions(options);
    }
    dispose() {
      var _a;
      (_a = this.diffAlgorithmOnDidChangeSubscription) === null || _a === void 0 || _a.dispose();
    }
    async computeDiff(original, modified, options, cancellationToken) {
      var _a, _b;
      if (typeof this.diffAlgorithm !== "string") {
        return this.diffAlgorithm.computeDiff(original, modified, options, cancellationToken);
      }
      if (original.getLineCount() === 1 && original.getLineMaxColumn(1) === 1) {
        return modified.getLineCount() === 1 && modified.getLineMaxColumn(1) === 1 ? {changes:[], identical:!0, quitEarly:!1, moves:[]} : {changes:[new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_common_SLASH_diff_SLASH_rangeMapping_DOT_js.DetailedLineRangeMapping(new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_common_SLASH_core_SLASH_lineRange_DOT_js.LineRange(1, 2), new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_common_SLASH_core_SLASH_lineRange_DOT_js.LineRange(1, 
        modified.getLineCount() + 1), [new require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_common_SLASH_diff_SLASH_rangeMapping_DOT_js.RangeMapping(original.getFullModelRange(), modified.getFullModelRange())])], identical:!1, quitEarly:!1, moves:[]};
      }
      const uriKey = JSON.stringify([original.uri.toString(), modified.uri.toString()]), context = JSON.stringify([original.id, modified.id, original.getAlternativeVersionId(), modified.getAlternativeVersionId(), JSON.stringify(options)]);
      var c = WorkerBasedDocumentDiffProvider_1.diffCache.get(uriKey);
      if (c && c.context === context) {
        return c.result;
      }
      c = require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_stopwatch_DOT_js.StopWatch.create();
      original = await this.editorWorkerService.computeDiff(original.uri, modified.uri, options, this.diffAlgorithm);
      modified = c.elapsed();
      this.telemetryService.publicLog2("diffEditor.computeDiff", {timeMs:modified, timedOut:(_a = original === null || original === void 0 ? void 0 : original.quitEarly) !== null && _a !== void 0 ? _a : !0, detectedMoves:options.computeMoves ? (_b = original === null || original === void 0 ? void 0 : original.moves.length) !== null && _b !== void 0 ? _b : 0 : -1});
      if (cancellationToken.isCancellationRequested) {
        return {changes:[], identical:!1, quitEarly:!0, moves:[]};
      }
      if (!original) {
        throw Error("no diff result available");
      }
      WorkerBasedDocumentDiffProvider_1.diffCache.size > 10 && WorkerBasedDocumentDiffProvider_1.diffCache.delete(WorkerBasedDocumentDiffProvider_1.diffCache.keys().next().value);
      WorkerBasedDocumentDiffProvider_1.diffCache.set(uriKey, {result:original, context});
      return original;
    }
    setOptions(newOptions) {
      var _a;
      let didChange = !1;
      newOptions.diffAlgorithm && this.diffAlgorithm !== newOptions.diffAlgorithm && ((_a = this.diffAlgorithmOnDidChangeSubscription) === null || _a === void 0 || _a.dispose(), this.diffAlgorithmOnDidChangeSubscription = void 0, this.diffAlgorithm = newOptions.diffAlgorithm, typeof newOptions.diffAlgorithm !== "string" && (this.diffAlgorithmOnDidChangeSubscription = newOptions.diffAlgorithm.onDidChange(() => this.onDidChangeEventEmitter.fire())), didChange = !0);
      didChange && this.onDidChangeEventEmitter.fire();
    }
  };
  WorkerBasedDocumentDiffProvider.diffCache = new Map();
  WorkerBasedDocumentDiffProvider = WorkerBasedDocumentDiffProvider_1 = exports([__param(1, module.IEditorWorkerService), __param(2, require.ITelemetryService)], WorkerBasedDocumentDiffProvider);
};

//# sourceMappingURL=module$node_modules$monaco_editor$esm$vs$editor$browser$widget$diffEditor$workerBasedDocumentDiffProvider.js.map
