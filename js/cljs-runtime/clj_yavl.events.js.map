{"version":3,"sources":["clj_yavl/events.cljc"],"mappings":"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","names":["clj-yavl.events/default-config-json","clj-yavl.events/initialize-db","db","_","cljs.core/deref","user-input-exists?","cljs.core.get_in","component-state-exists?","unit-specs-exists?","dataset-list-exists?","ds-conn","clj_yavl.db.init_db","default-config","clj_yavl.io.read_json_str","cljs.core/keyword","clj-yavl.db/transact","clj-yavl.db/config->tx-data","ds-db","G__28458","cljs.core/not","cljs.core/assoc-in","cljs.core.assoc","p__28460","vec__28461","cljs.core.nth","clj-yavl.events/init-unit-spec","id","type","initial-input","or__5025__auto__","p__28464","vec__28465","clj-yavl.events/remove-unit-spec","cljs.core.update_in","cljs.core/dissoc","p__28468","vec__28469","clj-yavl.events/update-unit-spec-input","field","value","p__28472","vec__28473","clj-yavl.events/set-unit-spec-input","input","p__28476","vec__28477","clj-yavl.events/set-config-input","val","mode","parsed","e28480","cljs.core._EQ_","clojure.edn.read_string","G__28481","old-db","conn","p__28482","vec__28483","clj-yavl.events/set-config-mode","new-mode","user-input","current-mode","current-input","new-input","e28486","obj","edn-data","sb__5670__auto__","goog.string/StringBuffer","*print-newline*-orig-val__28487","cljs.core/*print-newline*","*print-fn*-orig-val__28488","cljs.core/*print-fn*","*print-newline*-temp-val__28489","*print-fn*-temp-val__28490","x__5671__auto__","cljs.pprint.pprint","e28491","clj_yavl.io.write_json_str","p__28492","vec__28493","clj-yavl.events/set-top-level-prop","prop-key","e28496","updated","*print-newline*-orig-val__28497","*print-fn*-orig-val__28498","*print-newline*-temp-val__28499","*print-fn*-temp-val__28500","clj-yavl.events/sync-config-from-db","config","clj-yavl.db/pull-config","*print-newline*-orig-val__28501","*print-fn*-orig-val__28502","*print-newline*-temp-val__28503","*print-fn*-temp-val__28504","p__28505","vec__28506","clj-yavl.events/update-mark","mark-type","mark-eid","cljs.core/ffirst","clj-yavl.db/q","tx-data","new-mark-id","new-ds-db","clj-yavl.db/with","re_frame.core.reg_event_db","p__28509","vec__28510","re_frame.core.reg_event_fx","p__28513","p__28514","map__28515","cljs.core/--destructure-map","cljs.core.get","vec__28516","url","p__28519","vec__28520","data","e28523","inferred-schema","cljs.core/seq","cljs.core/map?","cljs.core/first","clj-yavl.infer/infer-schema","*print-newline*-orig-val__28524","*print-fn*-orig-val__28525","*print-newline*-temp-val__28526","*print-fn*-temp-val__28527","p__28528","vec__28529","err","js/console.error","re-frame.core/reg-fx","p__28532","map__28533","on-success","on-failure","is-csv","clojure.string/ends-with?","clojure.string/lower-case","clojure.string/starts-with?","js/fetch","resp","js/Promise.reject","result","js/module$node_modules$papaparse$papaparse_min.parse","re-frame.core/dispatch","cljs.core.conj","cljs.core.js__GT_clj","p__28534","vec__28535","clj-yavl.events/update-channel-field","channel","channel-eid","clj_yavl.db.q","cljs.core/name","enc-eid","new-chan-id","new-enc-id","p__28538","vec__28539","clj-yavl.events/update-tooltip","tooltip-def","p__28542","map__28543","p__28544","vec__28545","datapackage","p__28548","vec__28549"],"sourcesContent":["(ns clj-yavl.events\n  (:require [clj-yavl.presets :as presets]\n            [clojure.edn :as edn]\n            [clj-yavl.io :as io]\n            [clojure.pprint :refer [pprint]]\n            [clojure.string :as str]\n            [re-frame.core :as rf]\n            [clj-yavl.core :as-alias core]\n            [clj-yavl.db :as db]\n            [clj-yavl.infer :as infer]\n            [\"papaparse\" :as Papa]))\n\n(def default-config-json \"{\\n  \\\"$schema\\\": \\\"https://vega.github.io/schema/vega-lite/v5.json\\\",\\n  \\\"mark\\\": \\\"bar\\\",\\n  \\\"encoding\\\": {\\n    \\\"x\\\": {\\\"field\\\": \\\"col1\\\", \\\"type\\\": \\\"ordinal\\\"},\\n    \\\"y\\\": {\\\"field\\\": \\\"col2\\\", \\\"type\\\": \\\"quantitative\\\"}\\n  }\\n}\")\n\n(defn initialize-db\n  [db _]\n  (let [user-input-exists? (get-in db [:user-input :vega-lite])\n        component-state-exists? (::core/vega-lite db)\n        unit-specs-exists? (get-in db [:user-input :unit-specs])\n        dataset-list-exists? (get-in db [:user-input :dataset-list])\n\n        ;; Initialize DataScript\n        ds-conn (db/init-db)\n        ;; Load default config into DS\n        default-config (io/read-json-str default-config-json {:key-fn keyword})\n        _ (db/transact ds-conn (db/config->tx-data \"default\" default-config))\n        ds-db @ds-conn]\n\n    (cond-> db\n      (not user-input-exists?)\n      (assoc-in [:user-input :vega-lite]\n                {:saved-configs {}\n                 :default {::core/data-input \"\"\n                           ::core/config-input default-config-json\n                           ::core/config-mode :json\n                           ::core/active-config-name nil\n                           ::core/ds-db ds-db}}) ;; Store DB value\n\n      (not component-state-exists?)\n      (assoc ::core/vega-lite\n             {::core/format :csv\n              ::core/structure :columnar\n              ::core/parsed-data nil\n              ::core/inferred-schema nil\n              ::core/active-left-tab :config})\n\n      (not unit-specs-exists?)\n      (assoc-in [:user-input :unit-specs] {})\n\n      (not dataset-list-exists?)\n      (assoc-in [:user-input :dataset-list] []))))\n\n(defn init-unit-spec\n  [db [_ id type initial-input]]\n  (assoc-in db [:user-input :unit-specs id]\n            {:type type\n             :input (or initial-input {})}))\n\n(defn remove-unit-spec\n  [db [_ id]]\n  (update-in db [:user-input :unit-specs] dissoc id))\n\n(defn update-unit-spec-input\n  [db [_ id field value]]\n  (assoc-in db [:user-input :unit-specs id :input field] value))\n\n(defn set-unit-spec-input\n  [db [_ id input]]\n  (assoc-in db [:user-input :unit-specs id :input] input))\n\n(defn set-config-input\n  [db [_ val]]\n  ;; When text changes, update DS\n  ;; Note: This is a heavy operation for every keystroke.\n  ;; Ideally we debounce or only do it on blur/valid JSON.\n  ;; For now, we attempt to parse and if valid, update DS.\n  (let [mode (get-in db [:user-input :vega-lite :default ::core/config-mode])\n        parsed (try\n                 (if (= mode :json)\n                   (io/read-json-str val {:key-fn keyword})\n                   (edn/read-string val))\n                 (catch #?(:clj Exception :cljs :default) _ nil))]\n    (cond-> (assoc-in db [:user-input :vega-lite :default ::core/config-input] val)\n      parsed\n      (update-in [:user-input :vega-lite :default ::core/ds-db]\n                 (fn [old-db]\n                   ;; We need to re-create or update.\n                   ;; Since we don't have a smart diff yet, let's create a new DB for simplicity\n                   ;; or retract everything for \"default\" and re-insert.\n                   ;; Retracting recursively is hard without helper.\n                   ;; Let's just create a new DB for now to ensure consistency.\n                   (let [conn (db/init-db)]\n                     (db/transact conn (db/config->tx-data \"default\" parsed))\n                     @conn))))))\n\n(defn set-config-mode\n  [db [_ new-mode]]\n  (let [user-input (get-in db [:user-input :vega-lite :default])\n        current-mode (::core/config-mode user-input)\n        current-input (::core/config-input user-input)\n        new-input (cond\n                    (and (= current-mode :json) (= new-mode :edn))\n                    (try\n                      (let [obj (io/read-json-str current-input {:key-fn keyword})\n                            edn-data obj]\n                        (with-out-str (pprint edn-data)))\n                      (catch #?(:clj Exception :cljs :default) _ current-input))\n\n                    (and (= current-mode :edn) (= new-mode :json))\n                    (try\n                      (let [edn-data (edn/read-string current-input)]\n                        (io/write-json-str edn-data {:indent 2}))\n                      (catch #?(:clj Exception :cljs :default) _ current-input))\n\n                    :else current-input)]\n    (-> db\n        (assoc-in [:user-input :vega-lite :default ::core/config-mode] new-mode)\n        (assoc-in [:user-input :vega-lite :default ::core/config-input] new-input))))\n\n(defn set-top-level-prop\n  [db [_ prop-key value]]\n  ;; When setting a prop via UI (old way), we should probably use the new DS way.\n  ;; But to maintain backward compatibility or migrate, let's keep this but also update DS.\n  (let [user-input (get-in db [:user-input :vega-lite :default])\n        mode (::core/config-mode user-input)\n        input (::core/config-input user-input)]\n    (try\n      (let [parsed (if (= mode :json)\n                     (io/read-json-str input {:key-fn keyword})\n                     (edn/read-string input))\n            updated (assoc parsed prop-key value)\n            new-input (if (= mode :json)\n                        (io/write-json-str updated {:indent 2})\n                        (with-out-str (pprint updated)))]\n        (-> db\n            (assoc-in [:user-input :vega-lite :default ::core/config-input] new-input)\n            (update-in [:user-input :vega-lite :default ::core/ds-db]\n                       (fn [_]\n                         (let [conn (db/init-db)]\n                           (db/transact conn (db/config->tx-data \"default\" updated))\n                           @conn)))))\n      (catch #?(:clj Exception :cljs :default) _ db))))\n\n;; New Events for Granular Editing via DataScript\n\n(defn- sync-config-from-db\n  \"Helper to update text config from DS.\"\n  [db]\n  (let [ds-db (get-in db [:user-input :vega-lite :default ::core/ds-db])\n        config (db/pull-config ds-db \"default\")\n        mode (get-in db [:user-input :vega-lite :default ::core/config-mode])\n        new-input (if (= mode :json)\n                    (io/write-json-str config {:indent 2})\n                    (with-out-str (pprint config)))]\n    (assoc-in db [:user-input :vega-lite :default ::core/config-input] new-input)))\n\n(defn update-mark\n  [db [_ mark-type]]\n  ;; We need to transact into the DS DB stored in app-db.\n  ;; Since app-db stores the value, we need to 'edit' it.\n  ;; d/with works on db values.\n  (let [ds-db (get-in db [:user-input :vega-lite :default ::core/ds-db])\n        ;; We need to know the entity ID for the mark or create it.\n        ;; Since we don't have easy entity lookup here without query, let's use a standard query or assumption.\n        ;; Or better, re-transact the mark part using the same \"default\" id logic.\n        ;; But config->tx-data regenerates everything.\n\n        ;; Let's try to query for the mark entity.\n        mark-eid (ffirst (db/q '[:find ?e :where [?root :vl/mark ?e] [?root :vl/id \"default\"]] ds-db))\n\n        tx-data (if mark-eid\n                  [{:db/id mark-eid :mark/type mark-type}]\n                  (let [new-mark-id -1]\n                    [{:db/id [:vl/id \"default\"] :vl/mark new-mark-id}\n                     {:db/id new-mark-id :mark/type mark-type}]))\n\n        new-ds-db (db/with ds-db tx-data)]\n\n    (-> db\n        (assoc-in [:user-input :vega-lite :default ::core/ds-db] new-ds-db)\n        (sync-config-from-db))))\n\n(rf/reg-event-db\n ::set-dataset-url-input\n (fn [db [_ val]]\n   (assoc-in db [:user-input :dataset-url-input] val)))\n\n(rf/reg-event-fx\n ::fetch-dataset\n (fn [{:keys [db]} [_ url]]\n   {:promise/fetch {:url url\n                    :on-success [::fetch-dataset-success]\n                    :on-failure [::fetch-dataset-failure]}}))\n\n(rf/reg-event-db\n ::fetch-dataset-success\n (fn [db [_ data]]\n   (let [user-input (get-in db [:user-input :vega-lite :default])\n         mode (::core/config-mode user-input)\n         input (::core/config-input user-input)\n         parsed (try\n                  (if (= mode :json)\n                    (io/read-json-str input {:key-fn keyword})\n                    (edn/read-string input))\n                  (catch #?(:clj Exception :cljs :default) _ nil))\n\n         updated (when parsed (assoc parsed :data {:values data}))\n\n         ;; Infer schema from data\n         inferred-schema (when (and (seq data) (map? (first data)))\n                           (infer/infer-schema data))\n\n         new-input (when updated\n                     (if (= mode :json)\n                       (io/write-json-str updated {:indent 2})\n                       (with-out-str (pprint updated))))]\n     (if new-input\n       (-> db\n           (assoc-in [:user-input :vega-lite :default ::core/config-input] new-input)\n           (assoc-in [::core/vega-lite ::core/inferred-schema] inferred-schema)\n           (update-in [:user-input :vega-lite :default ::core/ds-db]\n                      (fn [_]\n                        (let [conn (db/init-db)]\n                          (db/transact conn (db/config->tx-data \"default\" updated))\n                          @conn))))\n       db))))\n\n(rf/reg-event-db\n ::fetch-dataset-failure\n (fn [db [_ err]]\n   (js/console.error \"Failed to fetch dataset:\" err)\n   db))\n\n;; Custom Effect for Fetching\n(rf/reg-fx\n :promise/fetch\n (fn [{:keys [url on-success on-failure]}]\n   (let [is-csv (or (str/ends-with? (str/lower-case url) \".csv\")\n                    (str/starts-with? url \"csv:\"))] ;; Handle specific prefix if needed, though url likely http\n     (-> (js/fetch url)\n         (.then (fn [resp]\n                  (if (.-ok resp)\n                    (if is-csv\n                      (.text resp)\n                      (.json resp))\n                    (js/Promise.reject (str \"Error: \" (.-statusText resp))))))\n         (.then (fn [result]\n                  (if is-csv\n                    (let [parsed (Papa/parse result #js {:header true :dynamicTyping true})]\n                      (rf/dispatch (conj on-success (js->clj (.-data parsed) :keywordize-keys true))))\n                    (rf/dispatch (conj on-success (js->clj result :keywordize-keys true))))))\n         (.catch (fn [err]\n                   (rf/dispatch (conj on-failure err))))))))\n\n(defn update-channel-field\n  [db [_ channel field]]\n  (let [ds-db (get-in db [:user-input :vega-lite :default ::core/ds-db])\n        ;; Find channel entity\n        channel-eid (ffirst (db/q '[:find ?c\n                                    :in $ ?channel-name\n                                    :where\n                                    [?root :vl/encoding ?enc]\n                                    [?root :vl/id \"default\"]\n                                    [?enc :encoding/channels ?c]\n                                    [?c :channel/name ?channel-name]]\n                                  ds-db (name channel)))\n\n        tx-data (if channel-eid\n                  [{:db/id channel-eid :channel/field field}]\n                  ;; If channel doesn't exist, we must create it and link to encoding\n                  (let [enc-eid (ffirst (db/q '[:find ?e :where [?root :vl/encoding ?e] [?root :vl/id \"default\"]] ds-db))\n                        new-chan-id -1]\n                     (if enc-eid\n                       [{:db/id enc-eid :encoding/channels new-chan-id}\n                        {:db/id new-chan-id :channel/name (name channel) :channel/field field}]\n                       ;; If encoding doesn't exist either\n                       (let [new-enc-id -2]\n                         [{:db/id [:vl/id \"default\"] :vl/encoding new-enc-id}\n                          {:db/id new-enc-id :encoding/channels new-chan-id}\n                          {:db/id new-chan-id :channel/name (name channel) :channel/field field}]))))\n\n        new-ds-db (db/with ds-db tx-data)]\n    (-> db\n        (assoc-in [:user-input :vega-lite :default ::core/ds-db] new-ds-db)\n        (sync-config-from-db))))\n\n(defn update-tooltip\n  [db [_ tooltip-def]]\n  (let [ds-db (get-in db [:user-input :vega-lite :default ::core/ds-db])\n        tx-data [{:db/id [:vl/id \"default\"] :vl/tooltip tooltip-def}]\n        new-ds-db (db/with ds-db tx-data)]\n    (-> db\n        (assoc-in [:user-input :vega-lite :default ::core/ds-db] new-ds-db)\n        (sync-config-from-db))))\n\n;; Dataset List Events\n\n(rf/reg-event-fx\n ::fetch-dataset-list\n (fn [{:keys [db]} _]\n   {:promise/fetch {:url \"https://cdn.jsdelivr.net/npm/vega-datasets/datapackage.json\"\n                    :on-success [::fetch-dataset-list-success]\n                    :on-failure [::fetch-dataset-list-failure]}}))\n\n(rf/reg-event-db\n ::fetch-dataset-list-success\n (fn [db [_ datapackage]]\n   (assoc-in db [:user-input :dataset-list] (:resources datapackage))))\n\n(rf/reg-event-db\n ::fetch-dataset-list-failure\n (fn [db [_ err]]\n   (js/console.error \"Failed to fetch dataset list:\" err)\n   db))\n"]}