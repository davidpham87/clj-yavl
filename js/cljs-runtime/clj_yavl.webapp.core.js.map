{"version":3,"sources":["clj_yavl/webapp/core.cljs"],"mappings":"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","names":["re_frame.core.reg_event_db","clj-yavl.webapp.events/initialize-db","clj-yavl.webapp.events/set-config-input","clj-yavl.webapp.events/set-config-mode","clj-yavl.webapp.events/set-top-level-prop","clj-yavl.webapp.events/update-mark","clj-yavl.webapp.events/update-channel-field","clj-yavl.webapp.events/update-tooltip","clj-yavl.webapp.events/init-unit-spec","clj-yavl.webapp.events/remove-unit-spec","clj-yavl.webapp.events/update-unit-spec-input","clj-yavl.webapp.events/set-unit-spec-input","re_frame.core.reg_sub","clj-yavl.webapp.subs/unit-spec-ids","clj-yavl.webapp.subs/unit-spec","clj-yavl.webapp.subs/all-unit-specs","p__29882","vec__29883","cljs.core.nth","_","id","re_frame.core.subscribe","clj-yavl.webapp.subs/compiled-unit-spec-fn","clj-yavl.webapp.subs/user-input-root","clj-yavl.webapp.subs/config-input","clj-yavl.webapp.subs/config-mode","clj-yavl.webapp.subs/parsed-config","clj-yavl.webapp.subs/top-level-prop","clj-yavl.webapp.subs/ds-db","clj-yavl.webapp.subs/mark","clj-yavl.webapp.subs/encoding","clj-yavl.webapp.subs/tooltip","p__29887","vec__29888","input","mode","e29891","G__29892","cljs.core/Keyword","cljs.core.get","clojure.edn.read_string","cljs.core.js__GT_clj","js/JSON.parse","js/Error","clj-yavl.webapp.core/update-transform-raw","new-transform","e29893","G__29894","data","updated","cljs.core.assoc","sb__5670__auto__","goog.string/StringBuffer","*print-newline*-orig-val__29895","cljs.core/*print-newline*","*print-fn*-orig-val__29896","cljs.core/*print-fn*","*print-newline*-temp-val__29897","*print-fn*-temp-val__29898","x__5671__auto__","cljs.pprint.pprint","js/JSON.stringify","cljs.core/clj->js","p__29899","vec__29900","db","user-input","cljs.core.get_in","new-input","cljs.core/assoc-in","p__29903","vec__29904","op","cljs.core.update_in","cljs.core/conj","p__29908","vec__29909","index","path","ops","vec__29912","before","after","cljs.core/split-at","cljs.core/vec","cljs.core.concat","cljs.core/rest","p__29915","vec__29916","new-op","p__29919","vec__29920","from-index","to-index","item","removed","cljs.core.subvec","p__29923","vec__29924","clj-yavl.webapp.core/toolbar","view-mode","config-mode","cljs.core/deref","cljs.core._EQ_","cljs.core/reset!","re-frame.core/dispatch","clj-yavl.webapp.core/left-panel","config-input","p1__29928#","bb-web-ds-tools.components.editor/monaco-editor","clj-yavl.webapp.ui-builder/ui-builder-view","clj-yavl.webapp.core/dataset-controls","with-let29931","reagent.ratom/with-let-values","temp__5829__auto__","reagent.ratom/*ratom-context*","c__20638__auto__","reagent.debug/has-console","reagent.debug/tracking","reagent.debug/track-console","js/console","init29932","cljs.core/not","res29933","p1__29930#","url-input","dataset-list","e","val","cljs.core/not-empty","dataset","p1__29929#","cljs.core/some","url","iter__5503__auto__","s__29940","cljs.core/LazySeq","temp__5825__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5501__auto__","size__5502__auto__","cljs.core/count","b__29942","cljs.core/chunk-buffer","i__29941","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__29939","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","ds","cljs.core.sort_by","clj-yavl.webapp.core/main-view","with-let29943","init29944","res29945","reagent.core.atom","parsed-config","clj-yavl.webapp.viz/vega-lite-viz","js/clj-yavl","js/clj-yavl.webapp","js/clj-yavl.webapp.core","js/clj-yavl.webapp.core.react-root","clj-yavl.webapp.core/react-root","reagent.dom.client.create_root","js/document","clj-yavl.webapp.core/run","reagent.dom.client.render","clj-yavl.webapp.core/init","re-frame.core/dispatch-sync","clj-yavl.webapp.core/reload!","cljs.core/chunk-first"],"sourcesContent":["(ns clj-yavl.webapp.core\n  (:require\n   [bb-web-ds-tools.components.editor :as editor]\n   [clj-yavl.webapp.events :as events]\n   [clj-yavl.presets :as presets]\n   [clj-yavl.webapp.subs :as subs]\n   [clj-yavl.webapp.ui-schema :as ui-schema]\n   [clj-yavl.webapp.viz :as viz]\n   [clj-yavl.webapp.ui-builder :as ui-builder]\n   [cljs.pprint :refer [pprint]]\n   [clojure.edn :as edn]\n   [re-frame.core :as rf]\n   [reagent.core :as r]\n   [reagent.dom.client :as rdomc]))\n\n;; --- State ---\n\n(rf/reg-event-db ::initialize events/initialize-db)\n(rf/reg-event-db ::set-config-input events/set-config-input)\n(rf/reg-event-db ::set-config-mode events/set-config-mode)\n(rf/reg-event-db ::set-top-level-prop events/set-top-level-prop)\n\n;; New DS Events\n(rf/reg-event-db ::update-mark events/update-mark)\n(rf/reg-event-db ::update-channel-field events/update-channel-field)\n(rf/reg-event-db ::update-tooltip events/update-tooltip)\n\n\n;; --- Unit Specs Events & Subs ---\n\n(rf/reg-event-db ::init-unit-spec events/init-unit-spec)\n(rf/reg-event-db ::remove-unit-spec events/remove-unit-spec)\n(rf/reg-event-db ::update-unit-spec-input events/update-unit-spec-input)\n(rf/reg-event-db ::set-unit-spec-input events/set-unit-spec-input)\n\n(rf/reg-sub ::unit-spec-ids subs/unit-spec-ids)\n(rf/reg-sub ::unit-spec subs/unit-spec)\n(rf/reg-sub ::all-unit-specs subs/all-unit-specs)\n\n(rf/reg-sub\n ::compiled-unit-spec\n (fn [[_ id]]\n   (rf/subscribe [::unit-spec id]))\n subs/compiled-unit-spec-fn)\n\n(rf/reg-sub ::user-input-root subs/user-input-root)\n(rf/reg-sub ::config-input :<- [::user-input-root] subs/config-input)\n(rf/reg-sub ::config-mode :<- [::user-input-root] subs/config-mode)\n\n(rf/reg-sub\n ::parsed-config\n :<- [::config-input]\n :<- [::config-mode]\n subs/parsed-config)\n\n(rf/reg-sub\n ::top-level-prop\n :<- [::parsed-config]\n subs/top-level-prop)\n\n;; DS Subs\n(rf/reg-sub ::ds-db subs/ds-db)\n(rf/reg-sub ::mark :<- [::ds-db] subs/mark)\n(rf/reg-sub ::encoding :<- [::ds-db] subs/encoding)\n(rf/reg-sub ::tooltip :<- [::ds-db] subs/tooltip)\n\n\n(rf/reg-sub\n ::config-transform-raw\n :<- [::config-input]\n :<- [::config-mode]\n (fn [[input mode] _]\n   (try\n     (case mode\n       :edn (get (edn/read-string input) :transform)\n       :json (get (js->clj (js/JSON.parse input) :keywordize-keys true) :transform)\n       nil)\n     (catch js/Error _ nil))))\n\n(defn- update-transform-raw [input mode new-transform]\n   (try\n     (case mode\n       :edn (let [data (edn/read-string input)\n                  updated (assoc data :transform new-transform)]\n              (with-out-str (pprint updated)))\n       :json (let [data (js->clj (js/JSON.parse input) :keywordize-keys true)\n                   updated (assoc data :transform new-transform)]\n               (js/JSON.stringify (clj->js updated) nil 2))\n       input)\n     (catch js/Error _ input)))\n\n(rf/reg-event-db\n ::set-config-transform-raw\n (fn [db [_ new-transform]]\n   (let [user-input (get-in db [:user-input :vega-lite :default])\n         mode (::config-mode user-input)\n         input (::config-input user-input)\n         new-input (update-transform-raw input mode new-transform)]\n     (assoc-in db [:user-input :vega-lite :default ::config-input] new-input))))\n\n;; --- Transform Ops Events & Subs ---\n\n(rf/reg-sub\n ::transform-ops\n (fn [db _]\n   (get-in db [:user-input :vega-lite :default ::transform-ops])))\n\n(rf/reg-event-db\n ::add-transform-op\n (fn [db [_ op]]\n   (update-in db [:user-input :vega-lite :default ::transform-ops] conj op)))\n\n(rf/reg-event-db\n ::remove-transform-op\n (fn [db [_ index]]\n   (let [path [:user-input :vega-lite :default ::transform-ops]]\n     (update-in db path (fn [ops]\n                          (let [[before after] (split-at index ops)]\n                            (vec (concat before (rest after)))))))))\n\n(rf/reg-event-db\n ::update-transform-op\n (fn [db [_ index new-op]]\n   (assoc-in db [:user-input :vega-lite :default ::transform-ops index] new-op)))\n\n(rf/reg-event-db\n ::reorder-transform-ops\n (fn [db [_ from-index to-index]]\n   (let [path [:user-input :vega-lite :default ::transform-ops]]\n     (update-in db path (fn [ops]\n                          (let [item (nth ops from-index)\n                                removed (vec (concat (subvec ops 0 from-index)\n                                                     (subvec ops (inc from-index))))]\n                            (vec (concat (subvec removed 0 to-index)\n                                         [item]\n                                         (subvec removed to-index)))))))))\n\n(rf/reg-event-db\n ::set-transform-ops\n (fn [db [_ ops]]\n   (assoc-in db [:user-input :vega-lite :default ::transform-ops] ops)))\n\n\n;; --- View ---\n\n(defn- toolbar [view-mode config-mode]\n  [:div {:class \"flex items-center justify-between p-2 bg-[#2d2d2d] border-b border-gray-700 text-gray-300\"}\n   [:div {:class \"flex space-x-4\"}\n    [:span \"Vega-Lite Configuration\"]\n    [:div {:class \"flex bg-gray-700 rounded p-0.5\"}\n      [:button {:class (str \"px-2 py-0.5 text-xs rounded \" (if (= @view-mode :code) \"bg-blue-600 text-white\" \"text-gray-300\"))\n                :on-click #(reset! view-mode :code)} \"Code\"]\n      [:button {:class (str \"px-2 py-0.5 text-xs rounded \" (if (= @view-mode :ui) \"bg-blue-600 text-white\" \"text-gray-300\"))\n                :on-click #(reset! view-mode :ui)} \"UI Builder\"]]]\n\n   (when (= @view-mode :code)\n      [:div {:class \"flex space-x-2 text-xs\"}\n      [:label {:class \"cursor-pointer flex items-center space-x-1\"}\n        [:input {:type \"radio\" :name \"mode\" :checked (= config-mode :json)\n                :on-change #(rf/dispatch [::set-config-mode :json])}]\n        [:span \"JSON\"]]\n      [:label {:class \"cursor-pointer flex items-center space-x-1\"}\n        [:input {:type \"radio\" :name \"mode\" :checked (= config-mode :edn)\n                :on-change #(rf/dispatch [::set-config-mode :edn])}]\n        [:span \"EDN\"]]])])\n\n(defn- left-panel [view-mode config-mode config-input]\n  [:div {:class \"w-1/2 h-full border-r border-gray-700 flex flex-col bg-[#1e1e1e]\"}\n   [toolbar view-mode config-mode]\n   [:div {:class \"flex-grow relative overflow-hidden\"}\n    (if (= @view-mode :code)\n      [editor/monaco-editor\n       {:value config-input\n        :language (if (= config-mode :edn) \"clojure\" \"json\")\n        :options {:fontSize 15\n                  :fontFamily \"monospace\"\n                  :rulers [80]\n                  :minimap {:enabled false}}\n        :on-change #(rf/dispatch [::set-config-input %])}]\n      [ui-builder/ui-builder-view])]])\n\n(defn- dataset-controls []\n  (r/with-let [url-input (rf/subscribe [::subs/dataset-url-input])\n               dataset-list (rf/subscribe [::subs/dataset-list])]\n    [:div {:class \"p-2 bg-gray-100 border-b border-gray-300 flex items-center gap-2\"}\n     [:div {:class \"flex flex-col flex-grow gap-1\"}\n      [:div {:class \"flex gap-2\"}\n       [:select\n        {:class \"border p-1 text-sm w-32\"\n         :on-change\n         (fn [e]\n           (let [val (-> e .-target .-value)]\n             (when (not-empty val)\n               (let [dataset (some #(when (= (:name %) val) %) @dataset-list)]\n                 (when dataset\n                   (let [url (str \"https://cdn.jsdelivr.net/npm/vega-datasets@3.2.1/data/\" (:path dataset))]\n                     (rf/dispatch [::events/set-dataset-url-input url])\n                     (rf/dispatch [::events/fetch-dataset url])))))))}\n        [:option {:value \"\"} \"Select Dataset...\"]\n        (for [ds (sort-by :name @dataset-list)]\n          ^{:key (:name ds)}\n          [:option {:value (:name ds)} (:name ds)])]\n\n       [:input {:type \"text\"\n                :placeholder \"Dataset URL\"\n                :value @url-input\n                :on-change #(do (rf/dispatch [::events/set-dataset-url-input (-> % .-target .-value)])\n                                (rf/dispatch [::events/fetch-dataset @url-input]))\n                :class \"border p-1 flex-grow text-sm\"}]]\n\n      [:button {:on-click #(rf/dispatch [::events/fetch-dataset @url-input])\n                :class \"bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600\"}\n       \"Load Data\"]]]))\n\n(defn main-view []\n  (r/with-let [view-mode (r/atom :code)]\n    (let [config-input @(rf/subscribe [::config-input])\n          parsed-config @(rf/subscribe [::parsed-config])\n          config-mode @(rf/subscribe [::config-mode])]\n      [:div {:class \"flex h-screen w-screen overflow-hidden\"}\n       [left-panel view-mode config-mode config-input]\n       [:div {:class \"w-1/2 h-full bg-white flex flex-col\"}\n        [dataset-controls]\n        [:div {:class \"flex-grow overflow-auto relative\"}\n         [viz/vega-lite-viz parsed-config]]]])))\n\n\n(defonce react-root (rdomc/create-root (.getElementById js/document \"app\")))\n(defn run [] (rdomc/render react-root [main-view]))\n\n(defn ^:export init []\n  (rf/dispatch-sync [::initialize])\n  (rf/dispatch [::events/fetch-dataset-list])\n  (run))\n\n(defn ^:dev/after-load reload! []\n  (run))\n\n(comment\n\n  (keys (:event @re-frame.registrar/kind->id->handler))\n  (keys (:sub @re-frame.registrar/kind->id->handler))\n\n  )\n"]}