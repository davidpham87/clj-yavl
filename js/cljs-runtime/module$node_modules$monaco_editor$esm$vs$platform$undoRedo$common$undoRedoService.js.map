{
"version":3,
"file":"module$node_modules$monaco_editor$esm$vs$platform$undoRedo$common$undoRedoService.js",
"lineCount":725,
"mappings":"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",
"sources":["node_modules/monaco-editor/esm/vs/platform/undoRedo/common/undoRedoService.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$monaco_editor$esm$vs$platform$undoRedo$common$undoRedoService\"] = function(require,module,exports) {\nObject.defineProperties(exports, {__esModule:{enumerable:true, value:true}, UndoRedoService:{enumerable:true, get:function() {\n  return UndoRedoService;\n}}});\nvar require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_errors_DOT_js = require(\"../../../base/common/errors.js\");\nvar require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_lifecycle_DOT_js = require(\"../../../base/common/lifecycle.js\");\nvar require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_network_DOT_js = require(\"../../../base/common/network.js\");\nvar require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_severity_DOT_js = require(\"../../../base/common/severity.js\");\nvar nls = require(\"../../../nls.js\");\nvar require$_DOT__DOT__SLASH__DOT__DOT__SLASH_dialogs_SLASH_common_SLASH_dialogs_DOT_js = require(\"../../dialogs/common/dialogs.js\");\nvar require$_DOT__DOT__SLASH__DOT__DOT__SLASH_instantiation_SLASH_common_SLASH_extensions_DOT_js = require(\"../../instantiation/common/extensions.js\");\nvar require$_DOT__DOT__SLASH__DOT__DOT__SLASH_notification_SLASH_common_SLASH_notification_DOT_js = require(\"../../notification/common/notification.js\");\nvar require$_DOT__SLASH_undoRedo_DOT_js = require(\"./undoRedo.js\");\nvar default$$require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_severity_DOT_js = require.esmDefault(require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_severity_DOT_js);\nvar __decorate = this && this.__decorate || function(decorators, target, key, desc) {\n  var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") {\n    r = Reflect.decorate(decorators, target, key, desc);\n  } else {\n    for (var i = decorators.length - 1; i >= 0; i--) {\n      if (d = decorators[i]) {\n        r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n      }\n    }\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function(paramIndex, decorator) {\n  return function(target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nconst DEBUG = false;\nfunction getResourceLabel(resource) {\n  return resource.scheme === require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_network_DOT_js.Schemas.file ? resource.fsPath : resource.path;\n}\nlet stackElementCounter = 0;\nclass ResourceStackElement {\n  constructor(actual, resourceLabel, strResource, groupId, groupOrder, sourceId, sourceOrder) {\n    this.id = ++stackElementCounter;\n    this.type = 0;\n    this.actual = actual;\n    this.label = actual.label;\n    this.confirmBeforeUndo = actual.confirmBeforeUndo || false;\n    this.resourceLabel = resourceLabel;\n    this.strResource = strResource;\n    this.resourceLabels = [this.resourceLabel];\n    this.strResources = [this.strResource];\n    this.groupId = groupId;\n    this.groupOrder = groupOrder;\n    this.sourceId = sourceId;\n    this.sourceOrder = sourceOrder;\n    this.isValid = true;\n  }\n  setValid(isValid) {\n    this.isValid = isValid;\n  }\n  toString() {\n    return `[id:${this.id}] [group:${this.groupId}] [${this.isValid ? \"  VALID\" : \"INVALID\"}] ${this.actual.constructor.name} - ${this.actual}`;\n  }\n}\nclass ResourceReasonPair {\n  constructor(resourceLabel, reason) {\n    this.resourceLabel = resourceLabel;\n    this.reason = reason;\n  }\n}\nclass RemovedResources {\n  constructor() {\n    this.elements = new Map();\n  }\n  createMessage() {\n    const externalRemoval = [];\n    const noParallelUniverses = [];\n    for (const [, element] of this.elements) {\n      const dest = element.reason === 0 ? externalRemoval : noParallelUniverses;\n      dest.push(element.resourceLabel);\n    }\n    const messages = [];\n    if (externalRemoval.length > 0) {\n      messages.push(nls.localize({key:\"externalRemoval\", comment:[\"{0} is a list of filenames\"]}, \"The following files have been closed and modified on disk: {0}.\", externalRemoval.join(\", \")));\n    }\n    if (noParallelUniverses.length > 0) {\n      messages.push(nls.localize({key:\"noParallelUniverses\", comment:[\"{0} is a list of filenames\"]}, \"The following files have been modified in an incompatible way: {0}.\", noParallelUniverses.join(\", \")));\n    }\n    return messages.join(\"\\n\");\n  }\n  get size() {\n    return this.elements.size;\n  }\n  has(strResource) {\n    return this.elements.has(strResource);\n  }\n  set(strResource, value) {\n    this.elements.set(strResource, value);\n  }\n  delete(strResource) {\n    return this.elements.delete(strResource);\n  }\n}\nclass WorkspaceStackElement {\n  constructor(actual, resourceLabels, strResources, groupId, groupOrder, sourceId, sourceOrder) {\n    this.id = ++stackElementCounter;\n    this.type = 1;\n    this.actual = actual;\n    this.label = actual.label;\n    this.confirmBeforeUndo = actual.confirmBeforeUndo || false;\n    this.resourceLabels = resourceLabels;\n    this.strResources = strResources;\n    this.groupId = groupId;\n    this.groupOrder = groupOrder;\n    this.sourceId = sourceId;\n    this.sourceOrder = sourceOrder;\n    this.removedResources = null;\n    this.invalidatedResources = null;\n  }\n  canSplit() {\n    return typeof this.actual.split === \"function\";\n  }\n  removeResource(resourceLabel, strResource, reason) {\n    if (!this.removedResources) {\n      this.removedResources = new RemovedResources();\n    }\n    if (!this.removedResources.has(strResource)) {\n      this.removedResources.set(strResource, new ResourceReasonPair(resourceLabel, reason));\n    }\n  }\n  setValid(resourceLabel, strResource, isValid) {\n    if (isValid) {\n      if (this.invalidatedResources) {\n        this.invalidatedResources.delete(strResource);\n        if (this.invalidatedResources.size === 0) {\n          this.invalidatedResources = null;\n        }\n      }\n    } else {\n      if (!this.invalidatedResources) {\n        this.invalidatedResources = new RemovedResources();\n      }\n      if (!this.invalidatedResources.has(strResource)) {\n        this.invalidatedResources.set(strResource, new ResourceReasonPair(resourceLabel, 0));\n      }\n    }\n  }\n  toString() {\n    return `[id:${this.id}] [group:${this.groupId}] [${this.invalidatedResources ? \"INVALID\" : \"  VALID\"}] ${this.actual.constructor.name} - ${this.actual}`;\n  }\n}\nclass ResourceEditStack {\n  constructor(resourceLabel, strResource) {\n    this.resourceLabel = resourceLabel;\n    this.strResource = strResource;\n    this._past = [];\n    this._future = [];\n    this.locked = false;\n    this.versionId = 1;\n  }\n  dispose() {\n    for (const element of this._past) {\n      if (element.type === 1) {\n        element.removeResource(this.resourceLabel, this.strResource, 0);\n      }\n    }\n    for (const element of this._future) {\n      if (element.type === 1) {\n        element.removeResource(this.resourceLabel, this.strResource, 0);\n      }\n    }\n    this.versionId++;\n  }\n  toString() {\n    const result = [];\n    result.push(`* ${this.strResource}:`);\n    for (let i = 0; i < this._past.length; i++) {\n      result.push(`   * [UNDO] ${this._past[i]}`);\n    }\n    for (let i = this._future.length - 1; i >= 0; i--) {\n      result.push(`   * [REDO] ${this._future[i]}`);\n    }\n    return result.join(\"\\n\");\n  }\n  flushAllElements() {\n    this._past = [];\n    this._future = [];\n    this.versionId++;\n  }\n  _setElementValidFlag(element, isValid) {\n    if (element.type === 1) {\n      element.setValid(this.resourceLabel, this.strResource, isValid);\n    } else {\n      element.setValid(isValid);\n    }\n  }\n  setElementsValidFlag(isValid, filter) {\n    for (const element of this._past) {\n      if (filter(element.actual)) {\n        this._setElementValidFlag(element, isValid);\n      }\n    }\n    for (const element of this._future) {\n      if (filter(element.actual)) {\n        this._setElementValidFlag(element, isValid);\n      }\n    }\n  }\n  pushElement(element) {\n    for (const futureElement of this._future) {\n      if (futureElement.type === 1) {\n        futureElement.removeResource(this.resourceLabel, this.strResource, 1);\n      }\n    }\n    this._future = [];\n    this._past.push(element);\n    this.versionId++;\n  }\n  createSnapshot(resource) {\n    const elements = [];\n    for (let i = 0, len = this._past.length; i < len; i++) {\n      elements.push(this._past[i].id);\n    }\n    for (let i = this._future.length - 1; i >= 0; i--) {\n      elements.push(this._future[i].id);\n    }\n    return new require$_DOT__SLASH_undoRedo_DOT_js.ResourceEditStackSnapshot(resource, elements);\n  }\n  restoreSnapshot(snapshot) {\n    const snapshotLength = snapshot.elements.length;\n    let isOK = true;\n    let snapshotIndex = 0;\n    let removePastAfter = -1;\n    for (let i = 0, len = this._past.length; i < len; i++, snapshotIndex++) {\n      const element = this._past[i];\n      if (isOK && (snapshotIndex >= snapshotLength || element.id !== snapshot.elements[snapshotIndex])) {\n        isOK = false;\n        removePastAfter = 0;\n      }\n      if (!isOK && element.type === 1) {\n        element.removeResource(this.resourceLabel, this.strResource, 0);\n      }\n    }\n    let removeFutureBefore = -1;\n    for (let i = this._future.length - 1; i >= 0; i--, snapshotIndex++) {\n      const element = this._future[i];\n      if (isOK && (snapshotIndex >= snapshotLength || element.id !== snapshot.elements[snapshotIndex])) {\n        isOK = false;\n        removeFutureBefore = i;\n      }\n      if (!isOK && element.type === 1) {\n        element.removeResource(this.resourceLabel, this.strResource, 0);\n      }\n    }\n    if (removePastAfter !== -1) {\n      this._past = this._past.slice(0, removePastAfter);\n    }\n    if (removeFutureBefore !== -1) {\n      this._future = this._future.slice(removeFutureBefore + 1);\n    }\n    this.versionId++;\n  }\n  getElements() {\n    const past = [];\n    const future = [];\n    for (const element of this._past) {\n      past.push(element.actual);\n    }\n    for (const element of this._future) {\n      future.push(element.actual);\n    }\n    return {past, future};\n  }\n  getClosestPastElement() {\n    if (this._past.length === 0) {\n      return null;\n    }\n    return this._past[this._past.length - 1];\n  }\n  getSecondClosestPastElement() {\n    if (this._past.length < 2) {\n      return null;\n    }\n    return this._past[this._past.length - 2];\n  }\n  getClosestFutureElement() {\n    if (this._future.length === 0) {\n      return null;\n    }\n    return this._future[this._future.length - 1];\n  }\n  hasPastElements() {\n    return this._past.length > 0;\n  }\n  hasFutureElements() {\n    return this._future.length > 0;\n  }\n  splitPastWorkspaceElement(toRemove, individualMap) {\n    for (let j = this._past.length - 1; j >= 0; j--) {\n      if (this._past[j] === toRemove) {\n        if (individualMap.has(this.strResource)) {\n          this._past[j] = individualMap.get(this.strResource);\n        } else {\n          this._past.splice(j, 1);\n        }\n        break;\n      }\n    }\n    this.versionId++;\n  }\n  splitFutureWorkspaceElement(toRemove, individualMap) {\n    for (let j = this._future.length - 1; j >= 0; j--) {\n      if (this._future[j] === toRemove) {\n        if (individualMap.has(this.strResource)) {\n          this._future[j] = individualMap.get(this.strResource);\n        } else {\n          this._future.splice(j, 1);\n        }\n        break;\n      }\n    }\n    this.versionId++;\n  }\n  moveBackward(element) {\n    this._past.pop();\n    this._future.push(element);\n    this.versionId++;\n  }\n  moveForward(element) {\n    this._future.pop();\n    this._past.push(element);\n    this.versionId++;\n  }\n}\nclass EditStackSnapshot {\n  constructor(editStacks) {\n    this.editStacks = editStacks;\n    this._versionIds = [];\n    for (let i = 0, len = this.editStacks.length; i < len; i++) {\n      this._versionIds[i] = this.editStacks[i].versionId;\n    }\n  }\n  isValid() {\n    for (let i = 0, len = this.editStacks.length; i < len; i++) {\n      if (this._versionIds[i] !== this.editStacks[i].versionId) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\nconst missingEditStack = new ResourceEditStack(\"\", \"\");\nmissingEditStack.locked = true;\nlet UndoRedoService = class UndoRedoService {\n  constructor(_dialogService, _notificationService) {\n    this._dialogService = _dialogService;\n    this._notificationService = _notificationService;\n    this._editStacks = new Map();\n    this._uriComparisonKeyComputers = [];\n  }\n  getUriComparisonKey(resource) {\n    for (const uriComparisonKeyComputer of this._uriComparisonKeyComputers) {\n      if (uriComparisonKeyComputer[0] === resource.scheme) {\n        return uriComparisonKeyComputer[1].getComparisonKey(resource);\n      }\n    }\n    return resource.toString();\n  }\n  _print(label) {\n    console.log(`------------------------------------`);\n    console.log(`AFTER ${label}: `);\n    const str = [];\n    for (const element of this._editStacks) {\n      str.push(element[1].toString());\n    }\n    console.log(str.join(\"\\n\"));\n  }\n  pushElement(element, group = require$_DOT__SLASH_undoRedo_DOT_js.UndoRedoGroup.None, source = require$_DOT__SLASH_undoRedo_DOT_js.UndoRedoSource.None) {\n    if (element.type === 0) {\n      const resourceLabel = getResourceLabel(element.resource);\n      const strResource = this.getUriComparisonKey(element.resource);\n      this._pushElement(new ResourceStackElement(element, resourceLabel, strResource, group.id, group.nextOrder(), source.id, source.nextOrder()));\n    } else {\n      const seen = new Set();\n      const resourceLabels = [];\n      const strResources = [];\n      for (const resource of element.resources) {\n        const resourceLabel = getResourceLabel(resource);\n        const strResource = this.getUriComparisonKey(resource);\n        if (seen.has(strResource)) {\n          continue;\n        }\n        seen.add(strResource);\n        resourceLabels.push(resourceLabel);\n        strResources.push(strResource);\n      }\n      if (resourceLabels.length === 1) {\n        this._pushElement(new ResourceStackElement(element, resourceLabels[0], strResources[0], group.id, group.nextOrder(), source.id, source.nextOrder()));\n      } else {\n        this._pushElement(new WorkspaceStackElement(element, resourceLabels, strResources, group.id, group.nextOrder(), source.id, source.nextOrder()));\n      }\n    }\n    if (DEBUG) {\n      this._print(\"pushElement\");\n    }\n  }\n  _pushElement(element) {\n    for (let i = 0, len = element.strResources.length; i < len; i++) {\n      const resourceLabel = element.resourceLabels[i];\n      const strResource = element.strResources[i];\n      let editStack;\n      if (this._editStacks.has(strResource)) {\n        editStack = this._editStacks.get(strResource);\n      } else {\n        editStack = new ResourceEditStack(resourceLabel, strResource);\n        this._editStacks.set(strResource, editStack);\n      }\n      editStack.pushElement(element);\n    }\n  }\n  getLastElement(resource) {\n    const strResource = this.getUriComparisonKey(resource);\n    if (this._editStacks.has(strResource)) {\n      const editStack = this._editStacks.get(strResource);\n      if (editStack.hasFutureElements()) {\n        return null;\n      }\n      const closestPastElement = editStack.getClosestPastElement();\n      return closestPastElement ? closestPastElement.actual : null;\n    }\n    return null;\n  }\n  _splitPastWorkspaceElement(toRemove, ignoreResources) {\n    const individualArr = toRemove.actual.split();\n    const individualMap = new Map();\n    for (const _element of individualArr) {\n      const resourceLabel = getResourceLabel(_element.resource);\n      const strResource = this.getUriComparisonKey(_element.resource);\n      const element = new ResourceStackElement(_element, resourceLabel, strResource, 0, 0, 0, 0);\n      individualMap.set(element.strResource, element);\n    }\n    for (const strResource of toRemove.strResources) {\n      if (ignoreResources && ignoreResources.has(strResource)) {\n        continue;\n      }\n      const editStack = this._editStacks.get(strResource);\n      editStack.splitPastWorkspaceElement(toRemove, individualMap);\n    }\n  }\n  _splitFutureWorkspaceElement(toRemove, ignoreResources) {\n    const individualArr = toRemove.actual.split();\n    const individualMap = new Map();\n    for (const _element of individualArr) {\n      const resourceLabel = getResourceLabel(_element.resource);\n      const strResource = this.getUriComparisonKey(_element.resource);\n      const element = new ResourceStackElement(_element, resourceLabel, strResource, 0, 0, 0, 0);\n      individualMap.set(element.strResource, element);\n    }\n    for (const strResource of toRemove.strResources) {\n      if (ignoreResources && ignoreResources.has(strResource)) {\n        continue;\n      }\n      const editStack = this._editStacks.get(strResource);\n      editStack.splitFutureWorkspaceElement(toRemove, individualMap);\n    }\n  }\n  removeElements(resource) {\n    const strResource = typeof resource === \"string\" ? resource : this.getUriComparisonKey(resource);\n    if (this._editStacks.has(strResource)) {\n      const editStack = this._editStacks.get(strResource);\n      editStack.dispose();\n      this._editStacks.delete(strResource);\n    }\n    if (DEBUG) {\n      this._print(\"removeElements\");\n    }\n  }\n  setElementsValidFlag(resource, isValid, filter) {\n    const strResource = this.getUriComparisonKey(resource);\n    if (this._editStacks.has(strResource)) {\n      const editStack = this._editStacks.get(strResource);\n      editStack.setElementsValidFlag(isValid, filter);\n    }\n    if (DEBUG) {\n      this._print(\"setElementsValidFlag\");\n    }\n  }\n  createSnapshot(resource) {\n    const strResource = this.getUriComparisonKey(resource);\n    if (this._editStacks.has(strResource)) {\n      const editStack = this._editStacks.get(strResource);\n      return editStack.createSnapshot(resource);\n    }\n    return new require$_DOT__SLASH_undoRedo_DOT_js.ResourceEditStackSnapshot(resource, []);\n  }\n  restoreSnapshot(snapshot) {\n    const strResource = this.getUriComparisonKey(snapshot.resource);\n    if (this._editStacks.has(strResource)) {\n      const editStack = this._editStacks.get(strResource);\n      editStack.restoreSnapshot(snapshot);\n      if (!editStack.hasPastElements() && !editStack.hasFutureElements()) {\n        editStack.dispose();\n        this._editStacks.delete(strResource);\n      }\n    }\n    if (DEBUG) {\n      this._print(\"restoreSnapshot\");\n    }\n  }\n  getElements(resource) {\n    const strResource = this.getUriComparisonKey(resource);\n    if (this._editStacks.has(strResource)) {\n      const editStack = this._editStacks.get(strResource);\n      return editStack.getElements();\n    }\n    return {past:[], future:[]};\n  }\n  _findClosestUndoElementWithSource(sourceId) {\n    if (!sourceId) {\n      return [null, null];\n    }\n    let matchedElement = null;\n    let matchedStrResource = null;\n    for (const [strResource, editStack] of this._editStacks) {\n      const candidate = editStack.getClosestPastElement();\n      if (!candidate) {\n        continue;\n      }\n      if (candidate.sourceId === sourceId) {\n        if (!matchedElement || candidate.sourceOrder > matchedElement.sourceOrder) {\n          matchedElement = candidate;\n          matchedStrResource = strResource;\n        }\n      }\n    }\n    return [matchedElement, matchedStrResource];\n  }\n  canUndo(resourceOrSource) {\n    if (resourceOrSource instanceof require$_DOT__SLASH_undoRedo_DOT_js.UndoRedoSource) {\n      const [, matchedStrResource] = this._findClosestUndoElementWithSource(resourceOrSource.id);\n      return matchedStrResource ? true : false;\n    }\n    const strResource = this.getUriComparisonKey(resourceOrSource);\n    if (this._editStacks.has(strResource)) {\n      const editStack = this._editStacks.get(strResource);\n      return editStack.hasPastElements();\n    }\n    return false;\n  }\n  _onError(err, element) {\n    (0,require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_errors_DOT_js.onUnexpectedError)(err);\n    for (const strResource of element.strResources) {\n      this.removeElements(strResource);\n    }\n    this._notificationService.error(err);\n  }\n  _acquireLocks(editStackSnapshot) {\n    for (const editStack of editStackSnapshot.editStacks) {\n      if (editStack.locked) {\n        throw new Error(\"Cannot acquire edit stack lock\");\n      }\n    }\n    for (const editStack of editStackSnapshot.editStacks) {\n      editStack.locked = true;\n    }\n    return () => {\n      for (const editStack of editStackSnapshot.editStacks) {\n        editStack.locked = false;\n      }\n    };\n  }\n  _safeInvokeWithLocks(element, invoke, editStackSnapshot, cleanup, continuation) {\n    const releaseLocks = this._acquireLocks(editStackSnapshot);\n    let result;\n    try {\n      result = invoke();\n    } catch (err) {\n      releaseLocks();\n      cleanup.dispose();\n      return this._onError(err, element);\n    }\n    if (result) {\n      return result.then(() => {\n        releaseLocks();\n        cleanup.dispose();\n        return continuation();\n      }, err => {\n        releaseLocks();\n        cleanup.dispose();\n        return this._onError(err, element);\n      });\n    } else {\n      releaseLocks();\n      cleanup.dispose();\n      return continuation();\n    }\n  }\n  async _invokeWorkspacePrepare(element) {\n    if (typeof element.actual.prepareUndoRedo === \"undefined\") {\n      return require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_lifecycle_DOT_js.Disposable.None;\n    }\n    const result = element.actual.prepareUndoRedo();\n    if (typeof result === \"undefined\") {\n      return require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_lifecycle_DOT_js.Disposable.None;\n    }\n    return result;\n  }\n  _invokeResourcePrepare(element, callback) {\n    if (element.actual.type !== 1 || typeof element.actual.prepareUndoRedo === \"undefined\") {\n      return callback(require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_lifecycle_DOT_js.Disposable.None);\n    }\n    const r = element.actual.prepareUndoRedo();\n    if (!r) {\n      return callback(require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_lifecycle_DOT_js.Disposable.None);\n    }\n    if ((0,require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_lifecycle_DOT_js.isDisposable)(r)) {\n      return callback(r);\n    }\n    return r.then(disposable => {\n      return callback(disposable);\n    });\n  }\n  _getAffectedEditStacks(element) {\n    const affectedEditStacks = [];\n    for (const strResource of element.strResources) {\n      affectedEditStacks.push(this._editStacks.get(strResource) || missingEditStack);\n    }\n    return new EditStackSnapshot(affectedEditStacks);\n  }\n  _tryToSplitAndUndo(strResource, element, ignoreResources, message) {\n    if (element.canSplit()) {\n      this._splitPastWorkspaceElement(element, ignoreResources);\n      this._notificationService.warn(message);\n      return new WorkspaceVerificationError(this._undo(strResource, 0, true));\n    } else {\n      for (const strResource of element.strResources) {\n        this.removeElements(strResource);\n      }\n      this._notificationService.warn(message);\n      return new WorkspaceVerificationError();\n    }\n  }\n  _checkWorkspaceUndo(strResource, element, editStackSnapshot, checkInvalidatedResources) {\n    if (element.removedResources) {\n      return this._tryToSplitAndUndo(strResource, element, element.removedResources, nls.localize({key:\"cannotWorkspaceUndo\", comment:[\"{0} is a label for an operation. {1} is another message.\"]}, \"Could not undo '{0}' across all files. {1}\", element.label, element.removedResources.createMessage()));\n    }\n    if (checkInvalidatedResources && element.invalidatedResources) {\n      return this._tryToSplitAndUndo(strResource, element, element.invalidatedResources, nls.localize({key:\"cannotWorkspaceUndo\", comment:[\"{0} is a label for an operation. {1} is another message.\"]}, \"Could not undo '{0}' across all files. {1}\", element.label, element.invalidatedResources.createMessage()));\n    }\n    const cannotUndoDueToResources = [];\n    for (const editStack of editStackSnapshot.editStacks) {\n      if (editStack.getClosestPastElement() !== element) {\n        cannotUndoDueToResources.push(editStack.resourceLabel);\n      }\n    }\n    if (cannotUndoDueToResources.length > 0) {\n      return this._tryToSplitAndUndo(strResource, element, null, nls.localize({key:\"cannotWorkspaceUndoDueToChanges\", comment:[\"{0} is a label for an operation. {1} is a list of filenames.\"]}, \"Could not undo '{0}' across all files because changes were made to {1}\", element.label, cannotUndoDueToResources.join(\", \")));\n    }\n    const cannotLockDueToResources = [];\n    for (const editStack of editStackSnapshot.editStacks) {\n      if (editStack.locked) {\n        cannotLockDueToResources.push(editStack.resourceLabel);\n      }\n    }\n    if (cannotLockDueToResources.length > 0) {\n      return this._tryToSplitAndUndo(strResource, element, null, nls.localize({key:\"cannotWorkspaceUndoDueToInProgressUndoRedo\", comment:[\"{0} is a label for an operation. {1} is a list of filenames.\"]}, \"Could not undo '{0}' across all files because there is already an undo or redo operation running on {1}\", element.label, cannotLockDueToResources.join(\", \")));\n    }\n    if (!editStackSnapshot.isValid()) {\n      return this._tryToSplitAndUndo(strResource, element, null, nls.localize({key:\"cannotWorkspaceUndoDueToInMeantimeUndoRedo\", comment:[\"{0} is a label for an operation. {1} is a list of filenames.\"]}, \"Could not undo '{0}' across all files because an undo or redo operation occurred in the meantime\", element.label));\n    }\n    return null;\n  }\n  _workspaceUndo(strResource, element, undoConfirmed) {\n    const affectedEditStacks = this._getAffectedEditStacks(element);\n    const verificationError = this._checkWorkspaceUndo(strResource, element, affectedEditStacks, false);\n    if (verificationError) {\n      return verificationError.returnValue;\n    }\n    return this._confirmAndExecuteWorkspaceUndo(strResource, element, affectedEditStacks, undoConfirmed);\n  }\n  _isPartOfUndoGroup(element) {\n    if (!element.groupId) {\n      return false;\n    }\n    for (const [, editStack] of this._editStacks) {\n      const pastElement = editStack.getClosestPastElement();\n      if (!pastElement) {\n        continue;\n      }\n      if (pastElement === element) {\n        const secondPastElement = editStack.getSecondClosestPastElement();\n        if (secondPastElement && secondPastElement.groupId === element.groupId) {\n          return true;\n        }\n      }\n      if (pastElement.groupId === element.groupId) {\n        return true;\n      }\n    }\n    return false;\n  }\n  async _confirmAndExecuteWorkspaceUndo(strResource, element, editStackSnapshot, undoConfirmed) {\n    if (element.canSplit() && !this._isPartOfUndoGroup(element)) {\n      let UndoChoice;\n      (function(UndoChoice) {\n        UndoChoice[UndoChoice[\"All\"] = 0] = \"All\";\n        UndoChoice[UndoChoice[\"This\"] = 1] = \"This\";\n        UndoChoice[UndoChoice[\"Cancel\"] = 2] = \"Cancel\";\n      })(UndoChoice || (UndoChoice = {}));\n      const {result} = await this._dialogService.prompt({type:default$$require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_severity_DOT_js.default.Info, message:nls.localize(\"confirmWorkspace\", \"Would you like to undo '{0}' across all files?\", element.label), buttons:[{label:nls.localize({key:\"ok\", comment:[\"{0} denotes a number that is \\x3e 1, \\x26\\x26 denotes a mnemonic\"]}, \"\\x26\\x26Undo in {0} Files\", editStackSnapshot.editStacks.length), run:() => UndoChoice.All}, \n      {label:nls.localize({key:\"nok\", comment:[\"\\x26\\x26 denotes a mnemonic\"]}, \"Undo this \\x26\\x26File\"), run:() => UndoChoice.This}], cancelButton:{run:() => UndoChoice.Cancel}});\n      if (result === UndoChoice.Cancel) {\n        return;\n      }\n      if (result === UndoChoice.This) {\n        this._splitPastWorkspaceElement(element, null);\n        return this._undo(strResource, 0, true);\n      }\n      const verificationError1 = this._checkWorkspaceUndo(strResource, element, editStackSnapshot, false);\n      if (verificationError1) {\n        return verificationError1.returnValue;\n      }\n      undoConfirmed = true;\n    }\n    let cleanup;\n    try {\n      cleanup = await this._invokeWorkspacePrepare(element);\n    } catch (err) {\n      return this._onError(err, element);\n    }\n    const verificationError2 = this._checkWorkspaceUndo(strResource, element, editStackSnapshot, true);\n    if (verificationError2) {\n      cleanup.dispose();\n      return verificationError2.returnValue;\n    }\n    for (const editStack of editStackSnapshot.editStacks) {\n      editStack.moveBackward(element);\n    }\n    return this._safeInvokeWithLocks(element, () => element.actual.undo(), editStackSnapshot, cleanup, () => this._continueUndoInGroup(element.groupId, undoConfirmed));\n  }\n  _resourceUndo(editStack, element, undoConfirmed) {\n    if (!element.isValid) {\n      editStack.flushAllElements();\n      return;\n    }\n    if (editStack.locked) {\n      const message = nls.localize({key:\"cannotResourceUndoDueToInProgressUndoRedo\", comment:[\"{0} is a label for an operation.\"]}, \"Could not undo '{0}' because there is already an undo or redo operation running.\", element.label);\n      this._notificationService.warn(message);\n      return;\n    }\n    return this._invokeResourcePrepare(element, cleanup => {\n      editStack.moveBackward(element);\n      return this._safeInvokeWithLocks(element, () => element.actual.undo(), new EditStackSnapshot([editStack]), cleanup, () => this._continueUndoInGroup(element.groupId, undoConfirmed));\n    });\n  }\n  _findClosestUndoElementInGroup(groupId) {\n    if (!groupId) {\n      return [null, null];\n    }\n    let matchedElement = null;\n    let matchedStrResource = null;\n    for (const [strResource, editStack] of this._editStacks) {\n      const candidate = editStack.getClosestPastElement();\n      if (!candidate) {\n        continue;\n      }\n      if (candidate.groupId === groupId) {\n        if (!matchedElement || candidate.groupOrder > matchedElement.groupOrder) {\n          matchedElement = candidate;\n          matchedStrResource = strResource;\n        }\n      }\n    }\n    return [matchedElement, matchedStrResource];\n  }\n  _continueUndoInGroup(groupId, undoConfirmed) {\n    if (!groupId) {\n      return;\n    }\n    const [, matchedStrResource] = this._findClosestUndoElementInGroup(groupId);\n    if (matchedStrResource) {\n      return this._undo(matchedStrResource, 0, undoConfirmed);\n    }\n  }\n  undo(resourceOrSource) {\n    if (resourceOrSource instanceof require$_DOT__SLASH_undoRedo_DOT_js.UndoRedoSource) {\n      const [, matchedStrResource] = this._findClosestUndoElementWithSource(resourceOrSource.id);\n      return matchedStrResource ? this._undo(matchedStrResource, resourceOrSource.id, false) : undefined;\n    }\n    if (typeof resourceOrSource === \"string\") {\n      return this._undo(resourceOrSource, 0, false);\n    }\n    return this._undo(this.getUriComparisonKey(resourceOrSource), 0, false);\n  }\n  _undo(strResource, sourceId = 0, undoConfirmed) {\n    if (!this._editStacks.has(strResource)) {\n      return;\n    }\n    const editStack = this._editStacks.get(strResource);\n    const element = editStack.getClosestPastElement();\n    if (!element) {\n      return;\n    }\n    if (element.groupId) {\n      const [matchedElement, matchedStrResource] = this._findClosestUndoElementInGroup(element.groupId);\n      if (element !== matchedElement && matchedStrResource) {\n        return this._undo(matchedStrResource, sourceId, undoConfirmed);\n      }\n    }\n    const shouldPromptForConfirmation = element.sourceId !== sourceId || element.confirmBeforeUndo;\n    if (shouldPromptForConfirmation && !undoConfirmed) {\n      return this._confirmAndContinueUndo(strResource, sourceId, element);\n    }\n    try {\n      if (element.type === 1) {\n        return this._workspaceUndo(strResource, element, undoConfirmed);\n      } else {\n        return this._resourceUndo(editStack, element, undoConfirmed);\n      }\n    } finally {\n      if (DEBUG) {\n        this._print(\"undo\");\n      }\n    }\n  }\n  async _confirmAndContinueUndo(strResource, sourceId, element) {\n    const result = await this._dialogService.confirm({message:nls.localize(\"confirmDifferentSource\", \"Would you like to undo '{0}'?\", element.label), primaryButton:nls.localize({key:\"confirmDifferentSource.yes\", comment:[\"\\x26\\x26 denotes a mnemonic\"]}, \"\\x26\\x26Yes\"), cancelButton:nls.localize(\"confirmDifferentSource.no\", \"No\")});\n    if (!result.confirmed) {\n      return;\n    }\n    return this._undo(strResource, sourceId, true);\n  }\n  _findClosestRedoElementWithSource(sourceId) {\n    if (!sourceId) {\n      return [null, null];\n    }\n    let matchedElement = null;\n    let matchedStrResource = null;\n    for (const [strResource, editStack] of this._editStacks) {\n      const candidate = editStack.getClosestFutureElement();\n      if (!candidate) {\n        continue;\n      }\n      if (candidate.sourceId === sourceId) {\n        if (!matchedElement || candidate.sourceOrder < matchedElement.sourceOrder) {\n          matchedElement = candidate;\n          matchedStrResource = strResource;\n        }\n      }\n    }\n    return [matchedElement, matchedStrResource];\n  }\n  canRedo(resourceOrSource) {\n    if (resourceOrSource instanceof require$_DOT__SLASH_undoRedo_DOT_js.UndoRedoSource) {\n      const [, matchedStrResource] = this._findClosestRedoElementWithSource(resourceOrSource.id);\n      return matchedStrResource ? true : false;\n    }\n    const strResource = this.getUriComparisonKey(resourceOrSource);\n    if (this._editStacks.has(strResource)) {\n      const editStack = this._editStacks.get(strResource);\n      return editStack.hasFutureElements();\n    }\n    return false;\n  }\n  _tryToSplitAndRedo(strResource, element, ignoreResources, message) {\n    if (element.canSplit()) {\n      this._splitFutureWorkspaceElement(element, ignoreResources);\n      this._notificationService.warn(message);\n      return new WorkspaceVerificationError(this._redo(strResource));\n    } else {\n      for (const strResource of element.strResources) {\n        this.removeElements(strResource);\n      }\n      this._notificationService.warn(message);\n      return new WorkspaceVerificationError();\n    }\n  }\n  _checkWorkspaceRedo(strResource, element, editStackSnapshot, checkInvalidatedResources) {\n    if (element.removedResources) {\n      return this._tryToSplitAndRedo(strResource, element, element.removedResources, nls.localize({key:\"cannotWorkspaceRedo\", comment:[\"{0} is a label for an operation. {1} is another message.\"]}, \"Could not redo '{0}' across all files. {1}\", element.label, element.removedResources.createMessage()));\n    }\n    if (checkInvalidatedResources && element.invalidatedResources) {\n      return this._tryToSplitAndRedo(strResource, element, element.invalidatedResources, nls.localize({key:\"cannotWorkspaceRedo\", comment:[\"{0} is a label for an operation. {1} is another message.\"]}, \"Could not redo '{0}' across all files. {1}\", element.label, element.invalidatedResources.createMessage()));\n    }\n    const cannotRedoDueToResources = [];\n    for (const editStack of editStackSnapshot.editStacks) {\n      if (editStack.getClosestFutureElement() !== element) {\n        cannotRedoDueToResources.push(editStack.resourceLabel);\n      }\n    }\n    if (cannotRedoDueToResources.length > 0) {\n      return this._tryToSplitAndRedo(strResource, element, null, nls.localize({key:\"cannotWorkspaceRedoDueToChanges\", comment:[\"{0} is a label for an operation. {1} is a list of filenames.\"]}, \"Could not redo '{0}' across all files because changes were made to {1}\", element.label, cannotRedoDueToResources.join(\", \")));\n    }\n    const cannotLockDueToResources = [];\n    for (const editStack of editStackSnapshot.editStacks) {\n      if (editStack.locked) {\n        cannotLockDueToResources.push(editStack.resourceLabel);\n      }\n    }\n    if (cannotLockDueToResources.length > 0) {\n      return this._tryToSplitAndRedo(strResource, element, null, nls.localize({key:\"cannotWorkspaceRedoDueToInProgressUndoRedo\", comment:[\"{0} is a label for an operation. {1} is a list of filenames.\"]}, \"Could not redo '{0}' across all files because there is already an undo or redo operation running on {1}\", element.label, cannotLockDueToResources.join(\", \")));\n    }\n    if (!editStackSnapshot.isValid()) {\n      return this._tryToSplitAndRedo(strResource, element, null, nls.localize({key:\"cannotWorkspaceRedoDueToInMeantimeUndoRedo\", comment:[\"{0} is a label for an operation. {1} is a list of filenames.\"]}, \"Could not redo '{0}' across all files because an undo or redo operation occurred in the meantime\", element.label));\n    }\n    return null;\n  }\n  _workspaceRedo(strResource, element) {\n    const affectedEditStacks = this._getAffectedEditStacks(element);\n    const verificationError = this._checkWorkspaceRedo(strResource, element, affectedEditStacks, false);\n    if (verificationError) {\n      return verificationError.returnValue;\n    }\n    return this._executeWorkspaceRedo(strResource, element, affectedEditStacks);\n  }\n  async _executeWorkspaceRedo(strResource, element, editStackSnapshot) {\n    let cleanup;\n    try {\n      cleanup = await this._invokeWorkspacePrepare(element);\n    } catch (err) {\n      return this._onError(err, element);\n    }\n    const verificationError = this._checkWorkspaceRedo(strResource, element, editStackSnapshot, true);\n    if (verificationError) {\n      cleanup.dispose();\n      return verificationError.returnValue;\n    }\n    for (const editStack of editStackSnapshot.editStacks) {\n      editStack.moveForward(element);\n    }\n    return this._safeInvokeWithLocks(element, () => element.actual.redo(), editStackSnapshot, cleanup, () => this._continueRedoInGroup(element.groupId));\n  }\n  _resourceRedo(editStack, element) {\n    if (!element.isValid) {\n      editStack.flushAllElements();\n      return;\n    }\n    if (editStack.locked) {\n      const message = nls.localize({key:\"cannotResourceRedoDueToInProgressUndoRedo\", comment:[\"{0} is a label for an operation.\"]}, \"Could not redo '{0}' because there is already an undo or redo operation running.\", element.label);\n      this._notificationService.warn(message);\n      return;\n    }\n    return this._invokeResourcePrepare(element, cleanup => {\n      editStack.moveForward(element);\n      return this._safeInvokeWithLocks(element, () => element.actual.redo(), new EditStackSnapshot([editStack]), cleanup, () => this._continueRedoInGroup(element.groupId));\n    });\n  }\n  _findClosestRedoElementInGroup(groupId) {\n    if (!groupId) {\n      return [null, null];\n    }\n    let matchedElement = null;\n    let matchedStrResource = null;\n    for (const [strResource, editStack] of this._editStacks) {\n      const candidate = editStack.getClosestFutureElement();\n      if (!candidate) {\n        continue;\n      }\n      if (candidate.groupId === groupId) {\n        if (!matchedElement || candidate.groupOrder < matchedElement.groupOrder) {\n          matchedElement = candidate;\n          matchedStrResource = strResource;\n        }\n      }\n    }\n    return [matchedElement, matchedStrResource];\n  }\n  _continueRedoInGroup(groupId) {\n    if (!groupId) {\n      return;\n    }\n    const [, matchedStrResource] = this._findClosestRedoElementInGroup(groupId);\n    if (matchedStrResource) {\n      return this._redo(matchedStrResource);\n    }\n  }\n  redo(resourceOrSource) {\n    if (resourceOrSource instanceof require$_DOT__SLASH_undoRedo_DOT_js.UndoRedoSource) {\n      const [, matchedStrResource] = this._findClosestRedoElementWithSource(resourceOrSource.id);\n      return matchedStrResource ? this._redo(matchedStrResource) : undefined;\n    }\n    if (typeof resourceOrSource === \"string\") {\n      return this._redo(resourceOrSource);\n    }\n    return this._redo(this.getUriComparisonKey(resourceOrSource));\n  }\n  _redo(strResource) {\n    if (!this._editStacks.has(strResource)) {\n      return;\n    }\n    const editStack = this._editStacks.get(strResource);\n    const element = editStack.getClosestFutureElement();\n    if (!element) {\n      return;\n    }\n    if (element.groupId) {\n      const [matchedElement, matchedStrResource] = this._findClosestRedoElementInGroup(element.groupId);\n      if (element !== matchedElement && matchedStrResource) {\n        return this._redo(matchedStrResource);\n      }\n    }\n    try {\n      if (element.type === 1) {\n        return this._workspaceRedo(strResource, element);\n      } else {\n        return this._resourceRedo(editStack, element);\n      }\n    } finally {\n      if (DEBUG) {\n        this._print(\"redo\");\n      }\n    }\n  }\n};\nUndoRedoService = __decorate([__param(0, require$_DOT__DOT__SLASH__DOT__DOT__SLASH_dialogs_SLASH_common_SLASH_dialogs_DOT_js.IDialogService), __param(1, require$_DOT__DOT__SLASH__DOT__DOT__SLASH_notification_SLASH_common_SLASH_notification_DOT_js.INotificationService)], UndoRedoService);\nclass WorkspaceVerificationError {\n  constructor(returnValue) {\n    this.returnValue = returnValue;\n  }\n}\n(0,require$_DOT__DOT__SLASH__DOT__DOT__SLASH_instantiation_SLASH_common_SLASH_extensions_DOT_js.registerSingleton)(require$_DOT__SLASH_undoRedo_DOT_js.IUndoRedoService, UndoRedoService, 1);\n\n};"],
"names":["shadow$provide","require","module","exports","getResourceLabel","resource","scheme","require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_network_DOT_js","Schemas","file","fsPath","path","Object","defineProperties","__esModule","enumerable","value","UndoRedoService","get","require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_errors_DOT_js","require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_lifecycle_DOT_js","require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_severity_DOT_js","nls","require$_DOT__DOT__SLASH__DOT__DOT__SLASH_dialogs_SLASH_common_SLASH_dialogs_DOT_js","require$_DOT__DOT__SLASH__DOT__DOT__SLASH_instantiation_SLASH_common_SLASH_extensions_DOT_js","require$_DOT__DOT__SLASH__DOT__DOT__SLASH_notification_SLASH_common_SLASH_notification_DOT_js","require$_DOT__SLASH_undoRedo_DOT_js","default$$require$_DOT__DOT__SLASH__DOT__DOT__SLASH__DOT__DOT__SLASH_base_SLASH_common_SLASH_severity_DOT_js","esmDefault","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","stackElementCounter","ResourceStackElement","constructor","actual","resourceLabel","strResource","groupId","groupOrder","sourceId","sourceOrder","id","type","label","confirmBeforeUndo","resourceLabels","strResources","isValid","setValid","toString","name","ResourceReasonPair","reason","RemovedResources","elements","Map","createMessage","externalRemoval","noParallelUniverses","element","push","dest","messages","localize","comment","join","size","has","set","delete","WorkspaceStackElement","invalidatedResources","removedResources","canSplit","split","removeResource","ResourceEditStack","_past","_future","locked","versionId","dispose","result","flushAllElements","_setElementValidFlag","setElementsValidFlag","filter","pushElement","futureElement","createSnapshot","len","ResourceEditStackSnapshot","restoreSnapshot","snapshot","snapshotLength","isOK","snapshotIndex","removePastAfter","removeFutureBefore","slice","getElements","past","future","getClosestPastElement","getSecondClosestPastElement","getClosestFutureElement","hasPastElements","hasFutureElements","splitPastWorkspaceElement","toRemove","individualMap","j","splice","splitFutureWorkspaceElement","moveBackward","pop","moveForward","EditStackSnapshot","editStacks","_versionIds","missingEditStack","_dialogService","_notificationService","_editStacks","_uriComparisonKeyComputers","getUriComparisonKey","uriComparisonKeyComputer","getComparisonKey","_print","console","log","str","group","UndoRedoGroup","None","source","UndoRedoSource","_pushElement","nextOrder","seen","Set","resources","add","editStack","getLastElement","closestPastElement","_splitPastWorkspaceElement","ignoreResources","individualArr","_element","_splitFutureWorkspaceElement","removeElements","_findClosestUndoElementWithSource","matchedElement","matchedStrResource","candidate","canUndo","resourceOrSource","_onError","err","onUnexpectedError","error","_acquireLocks","editStackSnapshot","Error","_safeInvokeWithLocks","invoke","cleanup","continuation","releaseLocks","then","_invokeWorkspacePrepare","prepareUndoRedo","Disposable","_invokeResourcePrepare","callback","isDisposable","disposable","_getAffectedEditStacks","affectedEditStacks","_tryToSplitAndUndo","message","warn","WorkspaceVerificationError","_undo","_checkWorkspaceUndo","checkInvalidatedResources","cannotUndoDueToResources","cannotLockDueToResources","_workspaceUndo","undoConfirmed","verificationError","returnValue","_confirmAndExecuteWorkspaceUndo","_isPartOfUndoGroup","pastElement","secondPastElement","UndoChoice","prompt","default","Info","buttons","run","All","This","cancelButton","Cancel","verificationError1","verificationError2","undo","_continueUndoInGroup","_resourceUndo","_findClosestUndoElementInGroup","undefined","_confirmAndContinueUndo","confirmed","confirm","primaryButton","_findClosestRedoElementWithSource","canRedo","_tryToSplitAndRedo","_redo","_checkWorkspaceRedo","cannotRedoDueToResources","_workspaceRedo","_executeWorkspaceRedo","redo","_continueRedoInGroup","_resourceRedo","_findClosestRedoElementInGroup","IDialogService","INotificationService","registerSingleton","IUndoRedoService"]
}
