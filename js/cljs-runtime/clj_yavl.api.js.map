{"version":3,"sources":["clj_yavl/api.cljc"],"mappings":"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","names":["clj-yavl.api/google-colors","clj-yavl.api/default-config","clj-yavl.api/infer-vl-type","schema-node","t","malli.core.type","fexpr__26625","fexpr__26626","fexpr__26627","fexpr__26628","cljs.core._EQ_","clj-yavl.api/get-field-schema","dataset-schema","field-name","schema","malli.core.schema","map-schema","fexpr__26629","cljs.core/first","malli.core.children","cljs.core/some","p__26630","vec__26631","cljs.core.nth","k","_","v","cljs.core/name","clj-yavl.api/infer-type-for-field","temp__5825__auto__","field-schema","clj-yavl.api/rename-column-values","col-name","mapping","expression","clojure.string.join","cljs.core.concat","cljs.core.map","p__26634","vec__26635","old","new","clj-yavl.api/transform-map","new-col","clj-yavl.api/transform-filter","predicate","clj-yavl.api/tooltip-def","keys","cljs.core/vec","iter__5503__auto__","s__26639","cljs.core/LazySeq","cljs.core/seq","cljs.core/chunked-seq?","c__5501__auto__","size__5502__auto__","cljs.core/count","b__26641","cljs.core/chunk-buffer","i__26640","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__26638","cljs.core/chunk-rest","cljs.core/cons","cljs.core/rest","inferred-type","field-def","cljs.core.assoc","var_args","args__5755__auto__","len__5749__auto__","i__5750__auto__","argseq__5756__auto__","cljs.core/IndexedSeq","clj-yavl.api/deep-merge","seq26642","self__5735__auto__","maps","cljs.core.apply","cljs.core/merge-with","x","y","cljs.core/map?","clj_yavl.api.deep_merge","clj-yavl.api/base-plot","encodings","common-specs","charts-opts","data-schema","processed-encodings","cljs.core/reduce-kv","acc","channel","value","encoding-def","field","and__5023__auto__","cljs.core/not","final-def","G__26646","final-specs","cljs.core.merge","cljs.core/chunk-first"],"sourcesContent":["(ns clj-yavl.api\n  (:require [malli.core :as m]\n            [clojure.string :as str]))\n\n;; Google Corporate Colors\n(def google-colors\n  [\"#4285F4\" \"#DB4437\" \"#F4B400\" \"#0F9D58\"])\n\n(def default-config\n  {:config {:range {:category google-colors}\n            :axis {:labelFontSize 12 :titleFontSize 14}\n            :header {:labelFontSize 12 :titleFontSize 14}\n            :legend {:labelFontSize 12 :titleFontSize 14}\n            :text {:fontSize 12}}\n   :width 400\n   :height 300})\n\n(defn- infer-vl-type\n  \"Infers the Vega-Lite type from a Malli schema node.\"\n  [schema-node]\n  (let [t (m/type schema-node)]\n    (cond\n      (#{'int? 'integer? 'number? 'double? 'float? :int :double :number :float} t) \"quantitative\"\n      (#{'string? :string} t) \"nominal\"\n      (#{'boolean? :boolean} t) \"nominal\"\n      (#{'inst? 'time? :inst :time} t) \"temporal\"\n      (= :enum t) \"nominal\"\n      :else nil)))\n\n(defn- get-field-schema\n  \"Finds the schema for a specific field within a dataset schema.\n   Handles schema being a Map or a Collection of Map.\"\n  [dataset-schema field-name]\n  (let [schema (m/schema dataset-schema)\n        t (m/type schema)\n        ;; Unwrap collection type if present to get to the item schema\n        map-schema (if (#{:vector :sequential :set :list} t)\n                     (first (m/children schema))\n                     schema)]\n    (when (= (m/type map-schema) :map)\n      (some (fn [[k _ v]]\n              (when (= (name k) field-name)\n                v))\n            (m/children map-schema)))))\n\n(defn- infer-type-for-field\n  [dataset-schema field-name]\n  (when-let [field-schema (get-field-schema dataset-schema field-name)]\n    (infer-vl-type field-schema)))\n\n(defn rename-column-values\n  \"Creates a Vega-Lite calculate transform to rename values in a column.\n   Values not in the mapping are left unchanged.\n\n   Args:\n     col-name: The name of the column (string).\n     mapping: A map of {old-value new-value}.\n\n   Returns:\n     A map representing a Vega-Lite calculate transform.\"\n  [col-name mapping]\n  (let [expression (str/join \" : \"\n                             (concat\n                              (map (fn [[old new]]\n                                     (str \"datum['\" col-name \"'] == '\" old \"' ? '\" new \"'\"))\n                                   mapping)\n                              [(str \"datum['\" col-name \"']\")]))]\n    {:calculate expression :as col-name}))\n\n(defn transform-map\n  \"Creates a Vega-Lite calculate transform (map operation).\n\n   Args:\n     new-col: The name of the new column (string).\n     expression: The Vega expression string.\n\n   Returns:\n     A map representing a Vega-Lite calculate transform.\"\n  [new-col expression]\n  {:calculate expression :as new-col})\n\n(defn transform-filter\n  \"Creates a Vega-Lite filter transform.\n\n   Args:\n     predicate: The Vega expression string for filtering.\n\n   Returns:\n     A map representing a Vega-Lite filter transform.\"\n  [predicate]\n  {:filter predicate})\n\n(defn tooltip-def\n  \"Generates a tooltip definition (vector of field definitions) for Vega-Lite.\n\n   Args:\n     keys: A sequence of field names (strings).\n     dataset-schema: The Malli schema of the dataset.\n\n   Returns:\n     A vector of maps, where each map matches StringFieldDef.\"\n  [keys dataset-schema]\n  (vec\n   (for [k keys]\n     (let [inferred-type (infer-type-for-field dataset-schema k)\n           field-def {:field k\n                      :type inferred-type}]\n       (if (= inferred-type \"quantitative\")\n         (assoc field-def :format \"s\")\n         field-def)))))\n\n(defn- deep-merge\n  \"Recursively merges maps.\"\n  [& maps]\n  (apply merge-with (fn [x y]\n                      (if (and (map? x) (map? y))\n                        (deep-merge x y)\n                        y))\n         maps))\n\n(defn base-plot\n  \"Generates a Vega-Lite spec.\n\n   Args:\n   - encodings: map of channel (keyword) to encoding definition (map) or field name (string).\n   - common-specs: TopLevelSpec (map) defining global values (mark, data, etc.).\n   - charts-opts: map with optional keys:\n     - :data-schema -> Malli schema of the dataset.\"\n  [encodings common-specs charts-opts]\n  (let [data-schema (:data-schema charts-opts)\n        processed-encodings\n        (reduce-kv\n         (fn [acc channel value]\n           (let [encoding-def (if (string? value)\n                                {:field value}\n                                value)\n                 field (:field encoding-def)\n                 ;; Infer type if field is present and type is missing\n                 inferred-type (when (and data-schema field (not (:type encoding-def)))\n                                 (infer-type-for-field data-schema field))\n                 final-def (cond-> encoding-def\n                             inferred-type (assoc :type inferred-type))]\n             (assoc acc channel final-def)))\n         {}\n         encodings)\n        ;; Merge defaults into common-specs\n        final-specs (deep-merge default-config common-specs)]\n    (merge final-specs\n           (when (seq processed-encodings)\n             {:encoding processed-encodings}))))\n"]}